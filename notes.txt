------------------------------------------------------------------------------------------- Section 1 ---------------------------------------------------------------------------------------

-- Spring Boot Overview

• Spring in Nutshell
Very popular framework for building Java applications
Provides a large number of helper classes and annotations
The Problem is building a traditional Spring application is really HARD!!!

• Spring Boot Solution
Make it easier to get started with Spring development
Minimize the amount of manual configuration
Perform auto-configuration based on props files and JAR classpath
Help to resolve dependency conflicts (Maven or Gradle)
Provide an embedded HTTP server so you can get started quickly
Tomcat, Jetty, Undertow, ...

• Spring Boot and Spring
Spring Boot uses Spring behind the scenes
Spring Boot simply makes it easier to use Spring


-- Spring Initializer Demo

• Spring Initializer 
Quickly create a starter Spring project by going to http://start.spring.io
Select your dependencies
Creates a Maven/Gradle project
Import the project into your IDE
Eclipse, IntelliJ, NetBeans etc ...

• Quick word on Maven
When building your Java project, you may need additional JAR files
For example: Spring, Hibernate, Commons Logging, JSON etc...
One approach is to download the JAR files from each project web site
Manually add the JAR files to your build path / classpath

• Maven Solution
Tell Maven, the projects you are working with (dependencies) like Spring, Hibernate etc ....
Maven will go out and download the JAR files for those projects for you
And Maven will make those JAR files available during compile/run
Think of Maven as your friendly helper / personal shopper

• Development Process
1. Configure our project at Spring Initializr website http://start.spring.io
2. Download the zip file
3. Unzip the file
4. Import the project into our IDE
5. Give sometime to IDE to download all Maven Dependencies
6. Run the main java file
7. Simple go to localhost:8080 which is intialized and started by Tomcat.


-- Create a REST Controller

• Example for how to create a simple REST Controller
  Project: 01-spring-boot-demo

-- Spring Framework Overview - Part 1

• Goals of Spring
Lightweight development with Java POJOs (Plain-Old-Java-Objects)
Dependency injection to promote loose coupling
Minimize boilerplate Java code


-- What is Maven?

Maven is a Project Management tool. Most popular use of Maven is for build management and dependencies. When building your Java project, 
you may need additional JAR files for example: Spring, Hibernate, Commons Logging, JSON etc. One approach is to download the JAR files from each project web site.
Manually add the JAR files to your build path / classpath. Another approch is tell Maven, the projects you are working with (dependencies) like Spring, Hibernate etc.
Maven will go out and download the JAR files for those projects for you. And Maven will make those JAR files available during compile/run. Think of Maven as your friendly 
helper / personal shopper. 

• Handling JAR Dependencies
When Maven retrieves a project dependency. It will also download supporting dependencies like Spring depends on commons-logging.
Maven will handle this for us automagically

• Building and Running
When you build and run your app ...
Maven will handle class / build path for you
Based on config file, Maven will add JAR files accordingly


-- Maven Project Structure

Normally when you join a new project
Each development team dreams up their own directory structure
Not ideal for new comers and not standardized
Maven solves this problem by providing a standard directory structure

• Standard Directory Structure
Directory			Description
src/mainijava			Your Java source code
src/main/resources		Properties / config files used by your app
src/main/webapp			JSP files and web config files other web assets (images, css, js, etc)
src/test			Unit testing code and properties
target				Destination directory for compiled code. Automatically created by Maven


-- Maven Key Concepts

• POM File - pom.xml
POM Stands for Project Object Model File
It is the configuration file for our project
It is always located in the root for our project
THe pom.xml file consist of three things: project meta data, dependencies and plug-ins.
project meta data: Project name, version and Output file type: JAR, WAR, ...
dependencies:      List of projects we depend on Spring, Hibernate, etc
plug ins:	   Additional custom tasks to run: generate JUnit test reports etc


• Project Coordinates
Project Coordinates uniquely identify a project
Similar to GPS coordinates for your house: latitude / longitude
Precise information for finding your house (city, street, house #)

Example:
<groupId>com.springboot.demo</groupId>
<artifactId>myFirstApp</artifactId>
<version>0.0.1-SNAPSHOT</version>


-- Exploring Spring Boot Project Files - Part 1

• Maven Standard Directory Structure
Directory			Description
src/mainijava			Your Java source code
src/main/resources		Properties / config files used by your app
src/test/java			Unit testing source code

• Maven Wrapper files
mvnw allows you to run a Maven project. There is no need to have Maven installed or present on your path. If correct version of Maven is NOT found on your computer
it automatically downloads correct version and runs Maven.
There are two files that are already provided: 
mvnw.cmd for MS Windows	to run commands like	-->	mvnw clean comiple test
mvnw.sh for Linux/Mac	to run commands like	-->	./mvnw clean comiple test

• Maven POM file
pom.xml includes info that you entered at Spring Initializr website. 
It includes: Spring Boot Starters (A collection of Maven dependencies)
             Spring Boot Maven plugin which is used to To package executable jar or war archive. And it can also easily run the app(./mvnw package) (-/mvnw spring-boot:run)

• Java Source Code
The Java Source Code includes:
Main Spring Boot application class
RestController that we created in an earlier video


-- Exploring Spring Boot Project Files - Part 2

• Application Properties
By default, Spring Boot will load properties from: application.properties.
The file 'application.properties' happens to be empty at the beginning.
We can add spring boot properties:	
server.port=8585
We can also add our own custom properties:  
coach.name=Mickey Mouse
team.name=The Mouse Crew

Now to make use of all those custom properties which we created into our 'application.properties', we can do with below code
@RestController
public class FunRestController {

 @Value ("${coach.name}")
 private String coachName;

 @value ("${team.name}")
 private String teamName;
 
 ...
} 

• Static Content
By default, Spring Boot will load static resources from "/static" directory
Examples of static resources are HTML files, CSS, JavaScript, images etc.


• Unit Tests
It includes Spring Boot unit test class where we can add unit tests to the file.


-- Spring Boot Starters

• What is Spring Boot Starters?
A curated list of Maven dependencies
A collection of dependencies grouped together
Tested and verified by the Spring Development team
Makes it much easier for the developer to get started with Spring
Reduces the amount of Maven configuration

Spring Boot provides 'spring-boot-started-web' which is a collection of dependencies.
It contain dependencies such as spring-web, spring-webmvc, hibernate-validator, json, tomcat etc.

There are 30 plus Spring Boot Starters from the Spring Development team.
Name				Description
spring-boot-starter-web 	Building web apps, includes validation, REST. Uses Tomcat as default embedded server
spring-boot-starter-securty	Adding spring security support
spring-boot-starter-data-jpa	Spring database support with JPA and Hibernate
...				...


-- Spring Boot Parents for Starters

Spring Boot provides a "Starter Parent"
This is a special starter that provides Maven defaults
<parent>
 <groupId>org.springframework.boot</groupId>
 <artifactId>spring-boot-starter-parent</artifactId>
 <version>3.@.Q-RC1</version>
 <relativePath/> <!/-- lookup parent from repository -->
</parent>


• Benefits of the Spring Boot Starter Parent
Default Maven configuration: Java version, UTF-encoding etc
Dependency management
 Use version on parent only
 spring-boot-starter-* dependencies inherit version from parent
Default configuration of Spring Boot plugin


-- Spring Boot Dev Tools - Overview

Automatically restarts your application when code is updated
Simply add the dependency to your POM file
No need to write additional code :-)
For IntelliJ, need to set additional configurations.

When we add the dependency to our POM file. It will automatically restarts your application when code is updated
<dependency>
<groupId>org.springframework .boot</groupId>
<artifactId>spring-boot-devtools</artifactId>
</dependency> 

• Development Process
Steps:
1. Apply IntelliJ configurations
2. Edit pom.xml and add spring-boot-devtools
3. Add new REST endpoint to our app
4. Verify the app is automatically reloaded


-- Spring Boot Dev Tools - Coding
• Example for how to set devtools
  Project: 02-dev-tools-demo 


-- Spring Boot Actuator - Overview

Exposes endpoints to monitor and manage your application
You easily get DevOps functionality out-of-the-box
Simply add the dependency to your POM file
REST endpoints are automatically added to your application
No need to write additional code!
You get new REST endpoints for FREE!

Once we add the dependency to your POM file. It enables Spring Boot Actuator.
<dependency>
    <groupId>org.springframework .boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>

Automatically exposes endpoints for metrics out-of-the-box
Endpoints are prefixed with: /actuator
Name 		Description
/health 	Health information about your application

• Health Point
/health checks the status of your application
Normally used by monitoring apps to see if your app is up or down

• Info Point
By default, It is empty
The /info endpoint can provide information about your application
To expose /info: we need to make below changes
File: src/main/resources/application.properties
management.endpoints.web.exposure.include=health,info
management.info.env.enabled=true

we also need to update application.properties with your app info
File: src/main/resources/application.properties
info.app.name=My Super Cool App
info.app.description=A crazy and fun app, yoohoo!
info.app.version=1.0.0

Properties starting with "info." will be used by /info

• Other Spring Boot Actuator Endpoints
There are 10+ Spring Boot Actuator endpoints:
Name 			Description
/auditevents 		Audit events for your application
/beans 			List of all beans registered in the Spring application context
/mappings 		List of all @RequestMapping paths


• How to make use of all Spring Boot Actuator Endpoints
By default, only /health is exposed
To expose all actuator endpoints over HTTP
File: src/main/resources/application.properties
# Use wildcard "*" to expose all endpoints
# Can also expose individual endpoints with a comma-delimited list
management.endpoints.web.exposure.include=*		

Above one line of code exposes all endpoints


• Get a list of beans
Access http://localhost:8080/actuator/beans

• Development Process
Steps:
1. Edit pom.xml and add spring-boot-starter-acuator
2. View actuator endpoints for: /health
3. Edit application .properties to customize /info


-- Spring Boot Actuator - Accessing Endpoints - Part 1
• Example for how to set actuator
  Project: 03-actuator-demo


-- Spring Boot Actuator - Securing Endpoints - Overview

• What about Security?
We may NOT want to expose all of this information
Add Spring Security to project and endpoints are secured. Below code enables Spring Security
<dependency>
    <groupid>org.springframework .boot</groupId>
    <artifactId>spring-boot-starter-security</artifactid>
</dependency>

• Secured Endpoints
Once we put above dependency, and than if we access: /actuator/beans
Spring Security will prompt for login where the 
user name: user 
Password: it will automatically generate into our terminal

There is also one more way to set user name and password:
We can override default user name and generated password
File: src/main/resources/application.properties
spring.security.user.name=scott
spring.security.user.password=tiger

• Customizing Spring Security
We can customize Spring Security for Spring Boot Actuator
Use a database for roles, encrypted passwords etc ...

• Exclude endpoints 
We can also exclude endpoints.
To exclude /health and /info
File: src/main/resources/application.properties
# Exclude individual endpoints with a comma-delimited list
management.endpoints.web.exposure.exclude=health, info

• Development Process
1. Edit pom.xml and add spring-boot-starter-security
2. Verify security on actuator endpoints for: /beans etc
3. Disable endpoints for /health and /info


-- Spring Boot Actuator - Securing Endpoints - Coding
• Example for how to secure actuator endpoints
  Project: 04-actuator-security-demo


-- Run Spring Boot apps from the Command Line - Overview

• Running from the Command-Line
When running from the command-line. There is no need to have IDE open/running
Since we using Spring Boot, the server is embedded in our JAR file. There is no need to have separate server installed / running
Because Spring Boot apps are self-contained.

Two options for running the app from the command line:
Option 1: Use 				-->	java -jar appName.jar(if you already have the jar file of your application)
Option 2: Use Spring Boot Maven plugin	-->	1. mvnw package(this will create a jar file of our application)		2. mvnw spring-boot: run
Remember the JAR file gets created in the 'target' subdirectory.

•  Development Process
1. Exit the IDE
2. Package the app using mvnw package
3. Run app using java -jar
4. Run app using Spring Boot Maven plugin, mvnw spring-boot: run


-- Run Spring Boot apps from the Command Line - Demo
For This Example, I simply did below steps:
1. Open my Bash Terminal into the application folder directly which is '05-command-line-demo'
2. On the Git Bash Terminal, I run: ./mvnw package
3. Now the above command creates a JAR file of our application into the 'target' folder.
4. So I run: cd target to go inside the target folder.
5. Now to run our application, I run the command: ava -jar  myFirstApp-0.0.1-SNAPSHOT.jar(which is the actual name of our application)
 

-- Injecting Custom Application Properties - Overview

• Application Properties File
By default, Spring Boot reads information from a standard properties file which is located at: src/main/resources/application. properties
We can define ANY custom properties in this Standard Spring Boot file.
Once we write custom properties, Spring Boot app can access those properties using @Value.
And there is no additional coding or configuration required.

• Development Process
Steps:
1. Define custom properties in application.properties
We can give ANY custom property names and as many as we want.
File: src/main/resources/application.properties:
# Define custom properties
coach.name=Mickey Mouse
team.name=The Mouse Club

2. Inject properties into Spring Boot application using @Value
@RestController
public class FunRestController {

// inject properties for: coach.name and team.name
@Value ("${coach.name}")
private String coachName;

@Value ("${team.name}")
private String teamName;

...
}

-- Injecting Custom Application Properties - Coding
• Example for inject custom application properties into a java file
  Project: 06-properties-demo


-- Configuring the Spring Boot Server - Overview
Spring Boot can be configured in the application. properties file
Server port, context path, actuator, security etc.
Spring Boot has over 1000 properties.
The properties are roughly grouped into the following categories:
Core, Web, Security, Data, Actuator, Integration, DevTools, Testing


• Core Properties
File: src/main/resources/application.properties
# Log levels severity mapping
# Set logging levels based on package names
logging.level.org.springframework=DEBUG
logging.level.org.hibernate=TRACE
logging.level.com. luv2code=INFO
# Log file name
logging.file=my-crazy-stuff.log

• Web Properties
File: src/main/resources/application.properties
# HTTP server port, The default server local host is 8080
server.port=7070
# Context path of the application, The default context path is '/'
server.servlet.context-path=/my-silly-app
# Default HTTP session time out, The default session time out is 30min.
server.servlet.session.timeout=15m

• Actuator Properties
File: src/main/resources/application.properties
# Endpoints to include by name or wildcard
management.endpoints.web.exposure.include=*
# Endpoints to exclude by name or wildcard
management.endpoints.web.exposure.exclude=beans,mapping
# Base path for actuator endpoints
Management.endpoints.web.base-path=/actuator

• Security Properties
File: src/main/resources/application.properties
# Change default user name
spring.security.user.name=admin
# Chaneg password for default user
spring.security.user.password=topsecret

• Data Properties
File: srcimain/resources/application. properties
# JDBC URL of the database
spring.datasource.url=jdbc:mysql: //localhost :3306/ecommerce
# Login username of the database
spring.datasource.username=scott
# Login password of the database
spring.datasource.password=tiger

• Development Process
Steps:
1. Configure the server port
2. Configure the application context path



------------------------------------------------------------------------------------------- Section 2 ---------------------------------------------------------------------------------------

-- What is Inversion of Control?
Inversion of Control (IoC) is a design pattern in object-oriented programming where the control of object creation 
and management is inverted from the application code to an external framework.

• Spring Container
Primary functions: 
 Create and manage objects (Inversion of Control)
 Inject object dependencies (Dependency Injection)

• Configuring Spring Container: 3 ways
XML configuration file (legacy)
Java Annotations (modern) 
Java Source Code (modern)


-- Defining Dependency Injection - Overview - Part 1

• Dependency Injection
The dependency inversion principle.
The client delegates to another object the responsibility of providing its dependencies.

• Injection Types
There are multiple types of injection with Spring
The two recommended types of injection: 
Constructor Injection
 Use this when you have required dependencies
 Generally recommended by the spring.io development team as first choice
Setter Injection
 Use this when you have optional dependencies
 If dependency is not provided, your app can provide reasonable default logic

• What is Spring AutoWiring
For dependency injection, Spring can use autowiring
Spring will look for a class that matches by type: class or interface
Spring will inject it automatically ... hence it is autowired

• @Component annotation
@Component marks the class as a Spring Bean
A Spring Bean is just a regular Java class that is managed by Spring
@Component also makes the bean available for dependency injection


-- Defining Dependency Injection - Overview - Part 1
• Example Application
Web Browser	---- /dailyWorkout ---->		DemoController		---- getDailyWorkout() ---->		Coach
Web Browser	---- Practice Fast Bowling ---->	DemoController		---- "Practice Fast Bowling" ---->	Coach

• Development Process - Constructor Injection
1. Define the dependency interface and class
2. Create Demo REST Controller
3. Create a constructor in your class for injections
4. Add @GetMapping for /dailyworkout


-- Constructor Injection - Coding - Part 1
Generating A Maven Project through https://start.spring.io/


-- Constructor Injection - Coding - Part 2
• Example for how to use constructor injection 
  Project: 01-constructor-injection


--  Constructor Injection - Behind the Scenes

• How Spring Process our application
// All bellow code is happening behind the scenes:
Coach theCoach = new CricketCoach();	
DemoController demoController = new DemoController(theCoach); 		<-- Constructor Injection


--  Component Scanning - Overview

• Scanning for Component Classes
Spring will scan your Java classes for special annotations
 @Component, etc...
It will automatically register the beans in the Spring container
In the project: 01-constructor-injection, 
we have a Main Spring Boot Class: SpringcoredemoApplicaiton.java which is is created by Spring Initializer: https://start.spring.io/
Now this file imports: org.springframework.boot.autoconfigure.SpringBootApplication
because of which we were able to put the annotation: @SpringBootApplication
Now this annotation enables: Auto configuration, Component scanning, Additional configuration
Behind the Scenes, The @SpringBootApplication composed of @EnableAutoConfiguration, @ComponentScan and @Configuration annotations.

• Annotations
@SpringBootApplication is composed of the following annotations:

Annotation 			Description
@EnableAutoConfiguration 	Enables Spring Boot's auto-configuration support
@ComponentScan			Enables component scanning of current package. Also recursively scans sub-packages
@Configuration			Able to register extra beans with @Bean or import other configuration classes

• About SpringApplication.run
Here the ' SpringApplication.run ' bootstraps our spring boot application.
And in ' SpringApplication.run(SpringcoredemoApplication.class, args); ', we have to write the actual name of our class to
give a reference.
Behind the Scenes, This both above lines will create the application context, registers all beans and starts the embedded serve.

• More on Component Scanning
By default, Spring Boot starts component scanning
 From same package as your main Spring Boot application
 Also scans sub-packages recursively
This implicitly defines a base search package
 Allows you to leverage default component scanning
 No need to explicitly reference the base package name

• Explicitly list base packages to scan
@springBootApplication(
scanBasePackages={"com.practice.springcoredemo",
                  "com.practice.util",
                  “org.acme.cart",
                  "edu.cmu.srs"})
public class SpringcoredemoApplication {
    ...	
}


-- Component Scanning - Coding - Part 1
-- Component Scanning - Coding - Part 2
• Example for how to list baseScanPackages in Main Application and let spring boot component scan outsider packages
  Project: 02-component-scanning


-- Setter Injection - Overview

• Autowiring Example
First we will inject a Coach implementation. Than spring will scan for @Components and finds if there is any class that implements the Coach interface.
If yes there is one, it will inject it. For example: CricketCoach.

• Injection Types - Which one to use?
Constructor Injection
 Use this when you have required dependencies
 Generally recommended by the spring.io development team as first choice
Setter Injection
 Use this when you have optional dependencies
 If dependency is not provided, your app can provide reasonable default logic

• Development Process - Setter Injection
1. Create setter method(s) in your class for injections
2. Configure the dependency injection with @Autowired Annotation

• Example for how to use setter injection
  Project: 03-setter-injection


-- Field Injection

• Spring Injection Types
Recommended by the spring.io development team
 Constructor Injection: required dependencies
 Setter Injection: optional dependencies
Not recommended by the spring.io development team
Field Injection

• Why Field Injection is no longer in use?
In the early days, field injection was popular on Spring projects
 In recent years, it has fallen out of favor
In general, it makes the code harder to unit test
As a result, the spring.io team does not recommend field injection
 However, you will still see it being used on legacy projects

• How it works?
Field Injection is the idea of injecting in dependencies by setting the values on your class directly, even on private fields
and this is accomplished by Java Reflection.

Steps:
1. Configure the dependency injection with Autowired Annotation
File: DemoController.java
import org.springframework.beans.factory.annotation.Autowired;
@RestController
public class DemoController {
    @Autowired
    private Coach myCoach; 		// we have autowired the field here so that is why it is Field injection
    // no need for constructors or setters

   @GetMapping(" /dailyworkout")
   public String getDailyWorkout() {
       return myCoach.getDailyWorkout();
   } 
}


-- Qualifiers - Overview

• Autowiring Example
First we will inject a Coach implementation. Than spring will scan for @Components and finds if there is any class that implements the Coach interface.
If yes, but this time there are multiple of them, So spring will make use of Qualifiers to find one class that we wanted it to get injected.

• How it Works?
In our project, we have an interface 'Coach' and only one class 'CricketCoach' that implements 'Coach'. So it easy straight forward for spring to inject 
dependency if there is only one class that is implementing 'Coach'. 
Now consider that we have multiple classes that is implementing 'Coach' interface, Now how spring will know which class to choose.

If we have classes such as 'CricketCoach', 'BaseballCoach', 'TrackCoach' and 'TenisCoach', The Spring will show us below error when we run it:
 Parameter 0 of constructor in com.luv2code.springcoredemo.rest.DemoController
 required a single bean, but 4 were found:
 baseballCoach
 cricketCoach
 tennisCoach
 trackCoach

Now the solution here is to make use of ' @Qualifier("className") ' in the autowired constructor or setter function.
// File: DemoController.java (Constructor Example)
@Autowired
public DemoController(@Qualifier("cricketCoach") Coach theCoach) {// here we are telling spring tha make use of 'cricketCoach' class as the injection. While implementing 'Coach' interface. 
myCoach = theCoach;
}

// File: DemoController.java (Setter Example)
@Autowired
public void setMyCoach(@Qualifier("cricketCoach") Coach theCoach) {// here we are telling spring tha make use of 'cricketCoach' class as the injection. While implementing 'Coach' interface. 
myCoach = theCoach;
}


-- Qualifiers - Coding - Part 1
-- Qualifiers - Coding - Part 2

• Example for how to use Qualifier Annotaion
  Project: 04-qualifiers


-- Primary - Overview
 
• Resolving issue with Multiple Coach implementations
In the case of multiple Coach implementations. We resolved it using @Qualifier that is by specifing a coach by name
However there is also an Alternate solution.

• How it works?
Instead of putting the 'Qualifier' Annotation and specifing which class should be used.
We can just put the 'Primary' Annotation right above the Class which we wanted to be get used.
Example:
// File: TrackCoach.java
import org.springframework.context .annotation.Primary;
import org.springframework.stereotype.Component;
@Component
@Primary						// with this annotation, the spring will know that it has to use this class as an injection.
public class TrackCoach implements Coach {
    @override
    public String getDailyWorkout() {
    return "Run a hard 5k!";
    }
}

• If 'Primary' Annotation used more than once
The Primary Annotation can only be used once in case of Multiple Impletation.
If we try to mark multiple classes with Primary Annotation, we will get below error:
Unsatisfied dependency expressed through constructor parameter 0:
No qualifying bean of type 'com.luv2code.springcoredemo.common.Coach' available:
more than one ‘primary' bean found among candidates:
[baseballCoach, cricketCoach, tennisCoach, trackCoach]

• Mixing @Primary and @Qualifier
Firstly we can use both annotations at same time. But you might have to be careful which to use when.
Secondly, @Qualifier has higher priority that is if we used @Qualifier for 'CricketCoach' and @Primary for 'TrackCoach', Than Spring will go and use 'CricketCoach'.

• Which one: @Primary or @Qualifier?
@Primary leaves it up to the implementation classes
 Could have the issue of multiple @Primary classes leading to an error
@Qualifier allows to you be very specific on which bean you want
In general, I recommend using @Qualifier
 It is more specific.
 It has higher priority.


-- Primary - Coding
• Example for how to use Primary Annotaion
  Project: 05-primary


-- Lazy Initialization - Overview

• Initialization
By default, when our application starts, all beans are initialized so it will scan for all components such as @Component and those components will instialized. 
So spring will create an instance of each and make them available.

Now to see that all beans have been initialized on the start of our application, we can put a println statement which prints each class's name:
// File: CricketCoach.java
public CricketCoach() {
    System.out.println("In constructor: " + getClass().getSimpleName());
}

// File: BaseballCoach.java
public BaseballCoach() {
    System.out.println("In constructor: " + getClass().getSimpleName());
}

// File: TennisCoach.java
public TennisCoach() {
    System.out.println("In constructor: " + getClass().getSimpleName());
}

// File: TrackCoach.java
public TrackCoach() {
    System.out.println("In constructor: " + getClass().getSimpleName());
} 

Now once we run the application, all the beans that is our classes which spring converts them into beans once we put the '@Component' will get initialized 
and the terminal will show below lines:
In constructor: BaseballCoach
In constructor: CricketCoach
In constructor: TennisCoach
In constructor: TrackCoach

Now there is usually not need of all beans to get intialized at time of application start.
Now to resolve that, we can make use of 'Lazy Initialization' Annotation.

• Lazy Initialization
Instead of creating all beans up front, we can specify lazy initialization
A bean will only be initialized in the following cases:
 It is needed for dependency injection
 Or itis explicitly requested
Add the @Lazy annotation to a given class
Example:
// File: TrackCoach
import org.springframework.context annotation.Lazy;
import org.springframework.stereotype.Component;
@Component
@Lazy						// this will implement Lazy Initialization to this class.
public class TrackCoach implements Coach {
    public TrackCoach() {
        System.out.println("In constructor: " + getClass().getSimpleName());
    }
}


• Lazy Iniitialization - Global configuration
We can also use this Annotation on all our beans at one time which is with the help of 'application.properties' file.
File: application.properities
spring.main.lazy-initialization=true

Now with above line of declaration, All beans are lazy, no beans will get created untill needed, including our DemoController.
If we consider our Coach project, So once we access our REST endpoint of '/dailyworkout', then spring will determine the dependencies
for the DemoController. And for the dependency resolution, spring will create instance of 'CricketCoach' first then create instance
of 'DemoController' and injects the 'CricketCoach'.
 
• Advantages of using Lazy Initialization
Only create objects as needed
May help with faster startup time if you have large number of components

• Disadvantages
If you have web related components like @RestController, not created until requested
May not discover configuration issues until too late
Need to make sure you have enough memory for all beans once created


-- Lazy Initialization - Coding - Part 1
-- Lazy Initialization - Coding - Part 2
• Example for how to use Lazy Initialization Annotaion
  Project: 05-lazy-initialization


-- Bean Scopes - Overview
Scope refers to the lifecycle of a bean such as:  How long does the bean live? How many instances are created? How is the bean shared?

• Singleton Scope
Now the default scope is singleton.
Singleton means that by default, the Spring Container creates only one instance of the bean. It is catched in memory. And all dependency injections
for the bean will reference the same bean.(Single item that is created in memory and shared amongst different other items.) 
Singleton Example:
@RestController
public class DemoController {
    // Here we have created two references and both will point at the same instance.
    private Coach myCoach;			
    private Coach anotherCoach;

    @Autowired
    public DemoController(
                  @Qualifier("cricketCoach") Coach theCoach,			// first reference points at the 'CricketCoach' instance.
                  @Qualifier("cricketCoach") Coach theAnotherCoach) {		// Second reference also points at the same above 'CricketCoach' instance.
        myCoach = theCoach;
        anotherCoach = theAnotherCoach;
    }
}

• Explicitly Specify Bean Scope
import org.springframework.beans.factory.config.ConfigurableBeanFactory;
import org.springframework.context.annotation. Scope;
import org.springframework.stereotype.Component;

@Component
@Scope (ConfigurableBeanFactory.SCOPE_SINGLETON)				// this is how we can explicitly specify bean scope
public class CricketCoach implements Coach {
    ...
}

• Additional Spring Bean Scopes
Scope		Description
singleton	Create a single shared instance of the bean. Default scope.
prototype	Creates a new bean instance for each container request.
request		Scoped to an HTTP web request. Only used for web apps.
session		Scoped to an HTTP web session. Only used for web apps.
global-session	Scoped to a global HTTP web session. Only used for web apps.


• Prototype Scope Example: a new object instance is created for each injection
// File: CricketCoach.java
import org.springframework.beans.factory.config.ConfigurableBeanFactory;
import org.springframework.context.annotation. Scope;
import org.springframework.stereotype.Component;

@Component
@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)		// we have to specify the scope here in 'CricketCoach' class.
public class CricketCoach implements Coach {
    ...
}

// File: DemoController.java
@RestController
public class DemoController {
    // Here we have created two references and both will point at the two different instances.
    private Coach myCoach;
    private Coach anotherCoach;

    @Autowired
    public DemoController(
		  // Here we have done two injections of same class 'CricketCoach', as we have specified 'Prototype' scope, a new object instance is created for each injection
                  @Qualifier("cricketCoach") Coach theCoach,			// first reference will point at one instance of 'CricketCoach'
                  @Qualifier("cricketCoach") Coach theAnotherCoach) {	        // second reference will point at second instance of 'CricketCoach'
        myCoach = theCoach;
        anotherCoach = theAnotherCoach;
    }
}


-- Bean Lifecyle Methods - Overview 

• Bean Lifecycle
Spring Container Started --> beans are instantiated --> dependencies are injected --> internal spring processing occurs --> excutes our custom initialization method
After method gets execute --> Bean is ready to use --> once we use it --> Spring Container gets shutdown --> executes our custom destroy method.																	

• Bean Lifecycle Methods / Hooks
You can add custom code during bean initialization
 Calling custom business logic methods
 Setting up handles to resources (db, sockets, file etc)
You can add custom code during bean destruction
 Calling custom business logic method
 Clean up handles to resources (db, sockets, files etc)

• Initialization of Method configuration
@Component
public class CricketCoach implements Coach {
    public CricketCoach() {
        System.out.println("In constructor: “ + getClass().getSimpleName());
    }

    @PostConstruct	// With the help of this annotation, we have added our own custom initialization code, once the bean has been constructed.
    public void doMyStartupStuff() {
    System.out.println("In doMyStartupStuff(): " + getClass().getSimpleName());
    }

    @PreDestroy		// With the help of this annotation, we have added our own custom cleanup code, which will run just before the bean gets destructed.
    public void doMyCleanupStuff() {
    System.out.println("In doMyStartupStuff(): " + getClass().getSimpleName());
    }
}
 
• Development Process
1. Define your methods for init and destroy
2. Add annotations: @PostConstruct and @PreDestroy


-- Special Note about Prototype Scope - Destroy Lifecycle Method and Lazy Initializ
• Prototype Beans and Destroy Lifecycle
There is a subtle point you need to be aware of with "prototype" scoped beans.
For "prototype" scoped beans, Spring does not call the destroy method. Gasp!

In contrast to the other scopes, Spring does not manage the complete lifecycle of a prototype bean: the container instantiates, configures, 
and otherwise assembles a prototype object, and hands it to the client, with no further record of that prototype instance.
Thus, although initialization lifecycle callback methods are called on all objects regardless of scope, in the case of prototypes, configured 
destruction lifecycle callbacks are not called. The client code must clean up prototype-scoped objects and release expensive resources that 
the prototype bean(s) are holding.

• Prototype Beans and Lazy Initialization
Prototype beans are lazy by default. There is no need to use the @Lazy annotation for prototype scopes beans.


-- Java Config Bean - Overview

In this is program, we will create a new Class 'SwimCoach' and we will not use any special annotations like '@Component' to configure it as bean.
Instead we will configure it using @Bean annotation.

• Development Process
1. Create @Configuration class
package com. luv2code.springcoredemo.config;
import org.springframework.context.annotation.Configuration;
@configuration								// With this annotation, we are declaring 'SportConfig' a configuration class for configuring spring.
public class SportConfig {
    ...
}

2. Define @Bean method to configure the bean
package com. luv2code.springcoredemo.config;
import com. luv2code.springcoredemo.common.Coach;
import com. luv2code.springcoredemo.common.SwimCoach;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
@Configuration
public class SportConfig {
    @Bean
    public Coach swimCoach() {		// The bean id defaults to the method name, So this bean will have a bean id of SwimCoach.
        return new SwimCoach();		// returing a new instance of SwimCoach. Here we are manually constructing the object and returning to given caller. 
    }
}

3. Inject the bean into our controller
import com.practice.springcoredemo.common.Coach;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
@RestController
public class DemoController {
    private Coach myCoach;
    @autowired
    public DemoController(@Qualifier("swimCoach") Coach theCoach) {			// here we made use of the bean id 'swimCoach' to inject it.
        System.out.println("In constructor: " + getClass().getSimpleName());
        myCoach = theCoach;
    }
}


• Use case for @Bean
Make an existing third-party class available to Spring framework
You may not have access to the source code of third-party class
However, you would like to use the third-party class as a Spring bean

• Real-World Project Example
Our project used Amazon Web Service (AWS) to store documents
 Amazon Simple Storage Service (Amazon S3)
 Amazon S3 is a cloud-based storage system
 can store PDF documents, images etc
We wanted to use the AWS S3 client as a Spring bean in our app
The AWS S3 client code is part of AWS SDK
 We can’t modify the AWS SDK source code
 We can’t just add @Component
However, we can configure it as a Spring bean using @Bean


------------------------------------------------------------------------------------------- Section 3 ---------------------------------------------------------------------------------------

-- Hibernate / JPA Overview
• What is Hibernate?
A framework for persisting / saving Java objects in a database
Our Java	-->	Hibernate	-->	Database
App		<-- 			<--

• Benefits of Using Hibernate
Hibernate handles all of the low-level SQL
Minimizes the amount of JDBC code you have to develop
Hibernate provides the Object-to-Relational Mapping (ORM)

• What is Object-To-Relational Mapping (ORM)
The developer defines mapping between Java class and database table

Example:
Java Class		-->	HIBERNATE		-->	Database Table
Student			<--	(Middleware)		<--	Student
id: int								id INT
firstName: String						first_name VARCHAR(45)
lastName: String						last_name VARCHAR(45)
email: String							email VARCHAR(45)

As you can see in above example, On the far left side we have our Java Class 'Student'. On the far right side, we have our Database Table 'Student'.
Now the Hibernate works as a Middleware, It will set a one-to-one mapping between the fields of our java class and the actual columns in database.
We can set up this mapping via configuration file via XML or through Java Annotations.

• What is JPA?
JPA stands for Jakarta Persistence API(JPA), previously known as Java Persistence API.
It is a standard API for Object-to-Relational-Mapping (ORM)
It is only a specification which defines a set of interfaces and requires an implementation to be useable.

• JPA - Vendor Implementations
One of the most popular implementations for JPA is 'Hibernate'.
Just like Java Coding, It take those interfaces and it provides an implementation of those given interfaces.

• Benefits of Using JPA
By having a standard API, you are not locked to vendor's implementation
Maintain portable, flexible code by coding to JPA spec (interfaces)
Can theoretically switch vendor implementations
 For example, if Vendor ABC stops supporting their product
 You could switch to Vendor XYZ without vendor lock in

• Example for JPA - Vendor Implementations
Suppose, we have an application 'MyBizApp' and we are writing our DAO code based on the JPA spec.
Now in one version of our project, we are using 'EclipseLink' as our vendor implementation, and in second version of our project, we want to 
change our vendor implementation to 'Hibernate'. Now this swapping of JPA Vendor Application is easily possible. We only will have to make 
minimal code changes as we are writing code to the standard specification. That is we simply have to tell our configuration to which vendor 
to use.   
 
• Saving a Java Object with JPA
Student theStudent = new Student("aum", "soni", “aumsoni2002@gmail.com");	// create Java object
entityManager.persist (theStudent);						// save it to database, 'entityManager' is a special JPA helper object.
With above lines of code, the data will get stored in the database.

• Retrieving a Java Object with JPA
Student theStudent = new Student("aum", "soni", “aumsoni2002@gmail.com");	// create Java object
entityManager.persist (theStudent);						// save it to database, 'entityManager' is a special JPA helper object.

// the database will automatically give our first object the id '1'. And with the help of that id, we can retrieve that object from database. 
int theId = 1;									// now retrieve from database using the primary key
Student myStudent = entityManager.find(Student.class, theId);			// 1st Parameter: NameOfTable.class, 2nd Parameter: id in integer to find a particular object.

• Querying for Java Objects
Let us retrieve/Query all students object from the 'Student' database table

TypedQuery<Student> theQuery = entityManager.createQuery("from Student", Student.class); // here we are saving a list of all student objects into 'theQuery'.
List<Student> students= theQuery.getResultList();					 // Now to retrieve all those objects, we have to make use of 'getResultList()'.


-- Hibernate, JPA and JDBC
• How does Hibernate/JPA relate to JDBC?
Hibernate/JPA uses JDBC in the background for all database communications
Hibernate/JPA is just an another layer of abstraction on top of JDBC.
So when our application uses the Hibernate/JPA framework, our app will actually store and retrieve the objects using the JPA API.
Hibernate/JPA does a lot of the low-level work for you, but in the background, it all goes through the standard JDBC API.


-- Setting up Development Enviornment
• MySQL Database
In this learning, we will use the MySQL Database
MySQL includes two components 
 MySQL Database Server
 MySQL Workbench

• MySQL Database Server
The MySQL Database Server is the main engine of the database
Stores data for the database
Supports CRUD features on the data

• MySQL Workbench
MySQL Workbench is a client GUI for interacting with the database
Create database schemas and tables
Execute SQL queries to retrieve data
Perform insert, updates and deletes on data
Handle administrative functions such as creating users

• Setting up Database Table - Overview
For this learning/project, we will be using two database scripts:
File: 01-create-user.sql
This file creates a new MySQL user for our application with user-id: springstudent and password: springstudent

File: 02-student-tracker.sql
This file creates a new database table: student
And four fields in it: id, first_name, last_name and email


-- Setting Up Database Table - Coding
Steps:
1. Open MySQL Workbench
2. Open the 'root' MySQL Connections which you created while doing installation process.
3. Goto: File --> Open SQL Script --> open '01-create-user.sql'
4. Now to create a new user: Run the above opened sql file by clicking on the golden thunder sign on workbench.
5. We have successfully created a new user. 
6. Now we have to create a new user for that newly created user.
7. Goto: Home Page --> Click on plus button which is right after 'MySQL Connections' --> Enter 'Connection name' and 'username' 
8. --> Click 'Test Connection' --> Enter password --> Click ok 
9. Now we have created a new connection.
10. Goto: Open 'springstudent' connection --> File --> Open SQL Script --> open '02-student-tracker.sql'
11. Now to create a new schemas: Run the above opened sql file by clicking on the golden thunder sign on workbench.
12. Goto: Schemas --> Refresh --> You will find 'student_tracker'


-- Setting Up Spring Boot Project - Overview

• Automatic Data Source Configuration
In Spring Boot, Hibernate is the default implementation of JPA
EntityManager is main component for creating queries etc
EntityManager is from Jakarta Persistence API (JPA)
Based on configs, Spring Boot will automatically create the beans: DataSource, EntityManager, ...
We can then inject these into our app, for example our DAO

• Setting up Project with Spring Initialzr
At Spring Initializr website, start.spring.io
Add dependencies
 MySQL Driver: mysql-connector-j
 Spring Data JPA: spring-boot-starter-data-jpa

• Spring Boot - Auto configuration
Spring Boot will automatically configure our data source for us.
Based on entries from Maven pom file
 JDBC Driver: mysql-connector-j
 Spring Data (ORM): spring-boot-starter-data-jpa
Spring boot reads DB connection info from application .properties

File: application.properties
spring.datasource.url=jdbc:mysql://localhost:3306/student_tracker
spring.datasource.username=springstudent
spring.datasource.password=springstudent

No need to give JDBC driver class name Spring Boot will automatically detect it based on URL.

• Creating Spring Boot - Command Line App
We will create a Spring Boot - Command Line App
This will allow us to focus on Hibernate / JPA
Later in the learning, we will apply this to a CRUD REST API

Example:
import org. springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot. autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
@SpringBootApplication
public class Cruddemoapplication {
    public static void main(String[] args) {
        SpringApplication.run(CruddemoApplication.class, args);
    }

   @Bean
   public CommandLineRunner commandlineRunner(String[] args) {
       return runner -> {
          System.out.println("Hello world");
       }; 
   }
}

This above CommandLineRunner is from the Spring framework, which is basically  a hook that allows us to execute code
after the Spring Beans have been loaded into the application context.
Inside it, we have a return statement 'runner' which is a Lambda Expression where we can basically add our custom code to interact with the database.

 
-- Setting Up Spring Boot Project - Coding - Part 1
-- Setting Up Spring Boot Project - Coding - Part 2
• Example for how to setup project for making use of Hibernate/JPA for crud operations
  Project: 01-cruddemo-student


-- JPA Annotations - Overview

• JPA Dev Process - To Do List
1. Annotate Java Class
2. Develop Java Code to perform database operations

• Terminology
Entity Class: It is just a Java Class that is mapped to a database table.

• Object-To-Relational Mapping (ORM)
We have our Java class called 'Student' that has four fields, id, firstName, lastName, and email, we'll make use of JPA, 
and we'll map it to a given database table called 'Student' that has four columns, id, first_name, last_name, and email.
So we need to kind of provide mappings between the two.

As we know, Hibernate is the default JPA implementation in Spring Boot.
Example:
Java Class		-->	HIBERNATE/JPA		-->	Database Table
Student			<--	(Middleware)		<--	Student
id: int								id INT
firstName: String						first_name VARCHAR(45)
lastName: String						last_name VARCHAR(45)
email: String							email VARCHAR(45)

• Entity Class
At a minimum, the Entity class: 
Must be annotated with @Entity
Must have a public or protected no-argument constructor. The class can also have other constructors.

• Java Annotations
Step 1: Map class to database table
@Entity					// here we are declaring our 'Student' java class as an Entity Class. 
@Table(name="student")			// here we are mapping our java class to the database table 'student'. (name="tableName")
public class Student{
    ...
}

Step 2: Map fields to database columns
@Entity
@Table(name="student")
public class Student{
    @id
    @Column(name="id")			// here we are mapping our 'id' field of java class to the 'id' column of the Database table.
    private int id;

    @Column(name="first_name")		// here we are mapping our 'firstName' field of java class to the 'first_name' column of the Database table.
    private String firstName;
}

• @Column and @Table - Optional
the use of @Column is optional.
If you do not want to specify @Column then the column name must be same name as Java field.
Same goes with the @Table too. 	

• Terminology
Primary Key: Uniquely identifies each row in a table. Must be a unique value. Cannot contain NULL values

• MySQL - Auto Increment
In the MySQL database, we can make use of an auto increment. We can define our primary key, and then we can specify that it's an auto increment.
So In below code, we have a little snippet here, create table student.
We have this column id which of type int, we delcare here that it will never be null, and then we specify auto increment.
Behind the scenes, MySQL will keep track by automatically incrementing this id, and making sure it's a unique value.
We also specify that our given column id is the primary key for this given table.
MySQL Code:
CREATE TABLE student (
  id int NOT NULL AUTO_INCREMENT,			// here we are declaring that id cannot be null and we specify auto increment on it.
  first_name varchar(45) DEFAULT NULL,
  last_name varchar(45) DEFAULT NULL,
  email varchar(45) DEFAULT NULL,
  PRIMARY KEY (id)					// here we are declaring our 'id' column as the primary key of this table.
}

• JPA Identity - Primary Key
Once we specify auto increment into our database table, we also need to declare it into our Java Code with @Id annotation
@Entity
@Table(name="student")
public class Student{
    @Id							// here we are declaring our 'id' field as the Unique Identifier of this Entity Class
    @GeneratedValue(strategy=GenerationType.IDENTITY)	// here what we are saying is that this id value will be generated by the database and managed by the database. 
							// There's no need for our code to manually try and keep track of that given id.
    @Column(name="id")					// here we are mapping our 'id' field of java class to the 'id' column of the Database table.
    private int id;
}

• ID Generation Strategies
Name				Description
GenerationType.AUTO		Pick an appropriate strategy for the particular database
GenerationType.IDENTITY		Assign primary keys using database identity column
GenerationType.SEQUENCE		Assign primary keys using a database sequence
GenerationType.TABLE		Assign primary keys using an underlying database table to ensure uniqueness

• Custom generation strategy
We can define your own CUSTOM generation strategy :-)
Create implementation of org. hibernate.id.IdentifierGenerator
Override the method: public Serializable generate(...)


-- JPA Annotations - Coding
• Example for how to create an Entity Class, Map that class to database table and map class's fields to database table's columns
  Project: 01-cruddemo-student-create


-- Saving a Java Object with JPA - Overview
• Sample App Features
For this project, we will be doing CRUD operation on student object.
Create a new Student
Read a Student
Update a Student
Delete a Student


• Student Data Access Object
The Data Access object(DAO) is responsible for interacting with the database.
cruddemo App	<--->	Student DAO	<--->	database

Our DAO needs a JPA Entity Manager
JPA Entity Manager is the main component for saving / retrieving entities
Student DAO	Entity Manager	<--->	data source	<--->	database

• DAO Methods
save(...)
findById(...)
findAll()
findByLastName(...)
update(...)
delete(...)
deleteAll()

• JPA Entity Manager
Now as far as the other supporting components, our JPA entity manager needs a data source.
So the data source basically defines the database connection information and the JPA entity manager and the data source
are automatically created by Spring Boot, based on information from our native pom file, and also information from our application properties
such as the URL, user ID, and password. It'll actually connect to the database. And then we can auto wire or inject the JPA entity manager into our student DAO.	

• @Transactional Annotation
The @Transactional annotation in JPA (Java Persistence API) is used to define the transactional boundaries for a method or a class. 
When this annotation is applied to a method, it indicates that a transaction will be initiated before the method is executed and 
committed or rolled back after the method completes. When applied to a class, it applies to all the public methods of the class. 
This annotation is used to manage transactions in JPA and ensures that the database is kept in a consistent state in case of any 
errors during the execution of the method.

• @Repository Annotation
This annotation is a sub-annotation of @Component annotation.
So this annotation is applied to DAO implementations and Spring will automatically register the DAO implementation, thanks to component scanning.
And then Spring will provide translation of any JDBC related exceptions.
So here when we say translation, meaning that if we have any checked JDBC exceptions and then Spring will translate these two unchecked
exceptions basically it makes the coding a bit easier here for interfacing with a given database.

• Student DAO:		Student DAO	Entity Manager	<--->	data source	<--->	database
Steps:
1. Define DAO interface
import com.practice.cruddemo.entity.Student;
public interface StudentDAO {				// Creating an Interface by the name 'StudentDAO'. 
    void save(Student theStudent);			// defining a method 'save' which takes an object of type 'Student' as an argument.
}

2. Define DAO implementation. Than Inject the entity manager
import com.practice.cruddemo.entity.Student;
import jakarta.persistence.EntityManager;
import org.springframework.beans.factory.annotation.Autowired;

@Repository
public class StudentDAOImpl implements StudentDAO {	// creating a class 'StudentDAOImpl' which implements 'StudentDAO' interface to use the method 'save'.
    private EntityManager entityManager;		// creating a field 'entityManager' of type 'EntityManager' which will be assigned an instance of type 'EntityManager' through constructor 

    @Autowired
    public StudentDAOImpl(EntityManager theEntityManager) {	// here we have created a constructor which take an object(instance) of type 'EntityManager' as an argument
        entityManager = theEntityManager;		// here we are saving the coming new instance to the field 'entityManager'
    }
    
    @Override
    @Transactional					// when a method does create, update or delete within the database through a method, That method should have this annotation
    public void save(Student theStudent){		
	entityManager.persist(theStudent);    		// here we are overriding the 'save' method with saving the new Student object into our database table.
    }
}
 
3. Update main app
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;

@SpringBootApplication
public class CruddemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(CruddemoApplication.class, args);
    }

    @Bean
    public CommandLineRunner commandlineRunner(StudentDAO studentDAO) { // here we are injecting an object 'studentDAO' of type 'StudentDAO' to use this interface's methods
        return runner -> {
            createStudent(studentDAO);		// here we are sending the same object to the method 'createStudent' as an argument. 
        };
    }
	
    private void createStudent(StudentDAO studentDAO){
       // create the student object
       System.out.println("Creating new student object...");
       Student newStudent = new Student("aum", "soni", "aumsoni2002@gmail.com");

       // save the student object
       System.out.println("Saving student object...");
       studentDAO.save(newStudent);

       // display id of the saved student
       System.out.println("The student is saved. The generated ID is: " + newStudent.getId()); 
    }
}


-- Saving a Java Object with JPA - Coding - Part 1
-- Saving a Java Object with JPA - Coding - Part 2
• Example for how to create a new student object into our MySQL Database table
  Project: 01-cruddemo-student-create


-- Changing Index of MySQL Auto Increment
• Changing the start index value of 'id' to 3000 in our database table
Workbench: SQL File
ALTER TABLE student_tracker.student AUTO_INCREMENT=3000;

• Reset the AUTO_INCREMENT value to 1
Workbench: SQL File
TRUNCATE student_tracker.student		// The 'TRUNCATE' will remove all data from the database table and reset AUTO_INCREMENT to start with 1.



-- Reading Objects with JPA - Overview
• Read/Retrieve
// retrieve/read from database using the primary key
// in this example, retrieve Student with primary key: 1
Student myStudent = entityManager.find(Student.class, 1);

• Development Process
1. Add new method to DAO interface
import com.practice.cruddemo.entity.Student;
public interface StudentDAO {
    ...
    Student findById(Integer id);	// defining a method 'findById' which takes 'id' of type 'Integer' as an argument and returns an object of type student
}

2. Add new method to DAO implementation
@Repository
public class StudentDAOImpl implements StudentDAO {
    private EntityManager entityManager;

    // inject entity manager using constructor injection
    @Autowired
    public StudentDAOImpl(EntityManager theEntityManager) {    
        entityManager = theEntityManager;        
    }

    @Override
    @Transactional                    
    public void save(Student theStudent) {
        entityManager.persist(theStudent);  
    }
 
    @override
    public Student findById(Integer id){		// here we are creating a method 'findById' that will take 'id' of type Integer as an argument.
    	return entityManager.find(Student.class, id);	// here we will send the above 'id' and the 'Student' class as argument to find the data which has the same id. 
    }
}

3. Update main app
public class CruddemoApplication {

    ...

    private void readStudent(StudentDAO studentDAO) {
        // create the student object
        System.out.println("Creating new student object...");
        Student secondStudent = new Student("shivang", "soni", "shivangsoni1998@gmail.com");

        // save the student object
        System.out.println("Saving student object...");
        studentDAO.save(secondStudent);

        // display id of the saved student
        System.out.println("The student is saved. The generated ID is: " + secondStudent.getId());

        // Now that a new student will get created with above steps lets retrieve that student and print it in terminal

        // Retrieve student based on its id
        System.out.println("Retrieving student with id: " + secondStudent.getId());

        // here we are calling the 'findById' method of 'StudentDAO' interface which will find the student object from database table and return it
        Student readSecondStudent = studentDAO.findById(secondStudent.getId());

        // Printing the returned student Object
        System.out.println("Found the student: " + readSecondStudent);
    }
}


-- Reading Objects with JPA - Coding
• Example for how to read a single student from the MySQL database table
  Project: 02-cruddemo-student-read


-- Querying Objects with JPA - Overview
• JPA Query Language(JPQL)
JPA has the JPA query language or JPQL. It's a query language for retrieving objects. It's similar in concept to SQL,
where you can select from a given table and grab some data accordingly.
You can also make use of constraints/selectors like 'where', 'like'. You can order the data, join, so and so forth.
However, the difference here is that JPQL is based on the entity name and entity fields as opposed to the direct 
table names and table columns. So when you use JPQL, by default, you make use of the entity name and entity fields.

• Retrieving all Students
In below code, the 'Student' in 'FROM Student' is our Entity Class which we created into our entity package. It is not the name of our database table
We have to use the Entity name here because all JPQL syntax is based on entity name and entity fields
TypedQuery<Student> theQuery = entityManager.createQuery("FROM Student", Student.class);
List<Student> students = theQuery.getResultList(); 

• Retrieving Students where lastName='aum'
As all JPQL syntax is based on entity name and entity fields, In below code we made use of 'lastName' entity field
TypedQuery<Student> theQuery = entityManager.createQuery("FROM Student WHERE lastName='soni'", Student.class);
List<Student> students = theQuery.getResultList();

• Retrieving Students using 'OR'
TypedQuery<Student> theQuery = entityManager.createQuery("FROM Student WHERE lastName='soni' OR firstName='aum'", Student.class);
List<Student> students = theQuery.getResultList();

• Retrieving Students using 'LIKE'
// Match email address that ends with '@gmail.com'
TypedQuery<Student> theQuery = entityManager.createQuery("FROM Student WHERE email LIKE '%@gmail.com'", Student.class);
List<Student> students = theQuery.getResultList();

• JPQL Named Parameters
public List<Student> findByLastName(String theLastName) { // here we are creating a method 'firdByLastName' which takes 'theLastName' of type String as an argument
    // Now in below code, we are just getting a student with its lastName but we are using ':theData' which gets swap with the comming 'lastName'.  
     TypedQuery<Student> theQuery = entityManager.createQuery("FROM Student WHERE lastName=:theData", Student.class); 
    theQuery.setParameter("theData", theLastName) ; // The swapping part is done here with this syntax.
    return theQuery.getResultList();	// here we are just returing the list.
}

• Development Process
1. Add new method to DAO interface
public interface StudentDAO {               
    ...
    List<Student> findAll();	// here we are creating method 'findAll' which will return list of students
}

2. Add new method to DAO implementation
@Repository
public class StudentDAOImpl implements StudentDAO {
    private EntityManager entityManager;

    // inject entity manager using constructor injection
    @Autowired
    public StudentDAOImpl(EntityManager theEntityManager) {    
        entityManager = theEntityManager;        
    }

    @Override
    @Transactional                    
    public void save(Student theStudent) {
        entityManager.persist(theStudent);  
    }
 
    @Override
    public Student findById(Integer id){		
    	return entityManager.find(Student.class, id);
    }

    @Override
    public List<Student>findAll(){
	TypedQuery<Student> theQuery = entityManager.createQuery("FROM Student", Student.class); // retrieving all student objects from the database table
        return theQuery.getResultList(); 							 // returning the list of all student objects
    }
}

3. Update main app
@SpringBootApplication
public class CruddemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(CruddemoApplication.class, args);
    }

    @Bean
    public CommandLineRunner commandlineRunner(StudentDAO studentDAO) { // here we are injecting an object 'studentDAO' of type 'StudentDAO' to use this interface's methods
        return runner -> {
            queryAllStudents(studentDAO);
        };
    }

    private void queryAllStudents(StudentDAO studentDAO) {
        // here we are calling 'findAll' method of 'StudentDAO' interface which will find the all student objects from database table and return it
        List<Student> allStudents = studentDAO.findAll();

        // Printing all student objects through enhanced for loop
        for (Student eachStudent : allStudents) {
            System.out.println(eachStudent);
        }
    }
}


-- Querying Objects with JPA - Coding - Part 1
• Example for how to query all student objects
Project: 03-cruddemo-student-query-findAll


-- Querying Objects with JPA - Coding - Part 2
• Example for how to query a student by its last name
Project: 03-cruddemo-student-query-findByLastName


-- Updating Objects with JPA - Overview
• Update a Student
Student theStudent = entityManager.find(Student.class, 1);	// first we find the student object through its 'id'
myStudent.setFirstName( "amit" ); 				// Second, we change first name to "amit"
entityManager.merge(theStudent); 				// Lastly, we update the student object's first_name which has id=1 in our database table.

• Update the last name for all students
In below code, we are updating all student object's last name to 'Tester'. The total number of updated rows will be saved in 'numOfRowsUpdated'
int numOfRowsUpdated = entityManager.createQuery (“UPDATE Student SET lastName='Tester'”).executeUpdate();

• Development Process
1. Add new method to DAO interface
public interface StudentDAO {               
    ...
    void update(Student theStudent)	// here we are creating method 'update' which will take an object 'theStudent' of type 'Student'.
}

2. Add new method to DAO implementation
@Repository
public class StudentDAOImpl implements StudentDAO {
    private EntityManager entityManager;

    // inject entity manager using constructor injection
    @Autowired
    public StudentDAOImpl(EntityManager theEntityManager) {    
        entityManager = theEntityManager;        
    }

    @Override
    @Transactional				// when a method does create, update or delete within the database through a method, That method should have this annotation
    public void update(Student theStudent){
	entityManager.merge(theStudent);
    }
}

3. Update main app
@SpringBootApplication
public class CruddemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(CruddemoApplication.class, args);
    }

    @Bean
    public CommandLineRunner commandlineRunner(StudentDAO studentDAO) { // here we are injecting an object 'studentDAO' of type 'StudentDAO' to use this interface's methods
        return runner -> {
            updateStudent(studentDAO);
        };
    }

    private void updateStudent(StudentDAO studentDAO) {
        int studentId = 1;
	System.out.println("Getting student with id: " + studentId);
	Student toBeUpdatedStudent = studentDAO.findById(studentId);	// finding a student object with id equals to 1.
        System.out.println("Getting student with id: " + studentId);

        System.out.println("Updating student...");
        myStudent.setFirstName("amit");					// change first name to "amit"
        studentDAO.update(toBeUpdatedStudent);				// updating new changes into our database.
       
        System.out.println("Updated student: + toBeUpdatedStudent);	// display updated student
    }
}



-- Deleting Objects with JPA - Overview
• Delete a Student
int id = 1;
Student theStudent = entityManager.find(Student.class, id);	// first we find the student object through its 'id'
entityManager.remove (theStudent);				// Lastly, we remove that student object from our database table.

• Delete based on a condition
// here we are deleting all those student objects which have 'soni' as their last name. And it will save total number of deleted rows in 'numRowsDeleted'
int numRowsDeleted = entityManager.createQuery("DELETE FROM Student WHERE lastName='soni'").executeUpdate();

• Delete All Students
int numRowsDeleted = entityManager.createQuery("DELETE FROM Student").executeUpdate();

• Development Process
1. Add new method to DAO interface
public interface StudentDAO {               
    ...
    void delete(Integer id)	// here we are creating method 'delete' which will take 'id' of type 'Integer' as an argument.
}

2. Add new method to DAO implementation
@Repository
public class StudentDAOImpl implements StudentDAO {
    private EntityManager entityManager;

    // inject entity manager using constructor injection
    @Autowired
    public StudentDAOImpl(EntityManager theEntityManager) {    
        entityManager = theEntityManager;        
    }

    @Override
    @Transactional				// when a method does create, update or delete within the database through a method, That method should have this annotation
    public void delete(Integer id){
	Student theStudent = entityManager.find(Student.class, id);
	entityManager.remove(theStudent);
    }
}

3. Update main app
@SpringBootApplication
public class CruddemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(CruddemoApplication.class, args);
    }

    @Bean
    public CommandLineRunner commandlineRunner(StudentDAO studentDAO) { // here we are injecting an object 'studentDAO' of type 'StudentDAO' to use this interface's methods
        return runner -> {
            deleteStudent(studentDAO);
        };
    }

    private void deleteStudent(StudentDAO studentDAO) {
        int studentId = 1;
	System.out.println("deleting student with id: " + studentId);
	studentDAO.delete(studentId);   
    }
}


-- Create Database Tables from Java Code - Overview
• Create database tables: student
JPA / Hibernate provides an option to auto-magically create database tables. It creates tables based on Java code with JPA/ Hibernate annotations
and it is useful for development and testing.
We have our Java code with the annotations, we run it through this Hibernate tool, and then it'll actually generate the SQL
and also execute that SQL. Then it applies that on the given database. So there's no need for us to write any of the SQL.
Java code	-->	JPA/Hibernate	-->	SQL	-->	Database

• Configuration
In the Hibernate configuration file, we will set up a property as shown below and we give a property value.
Here we'll call it create. So when we run our application, Hibernate will drop the tables and then create them again from scratch.
And this is all based on the JPA/Hibernate annotations that are in our Java code.
In Spring Boot configuration file: application.properties
spring.jpa.hibernate.ddl-auto=create

• Creating Table based on Java Code
In our 'Student' class, we have put '@Table' with table name to let Spring Boot know that this class is what going to be mapped with the database table 'student'.
We also have put '@Columns' for all fields that we consider them as column in database table.
Now If the 'student' table in our database does not exist, what JPA/Hibernate tool will do is, it will create a sql query based on annotations we used and execute that
query to create a table with same table name and columns with same field names in the database. 

• Configuration - application.properties
spring.jpa.hibernate.ddl-auto=PROPERTY-VALUE
Property Value 		Property Description
none 			No action will be performed
create-only 		Database tables are only created
drop 			Database tables are dropped
create 			Database tables are dropped followed by database tables creation
create-drop 		Database tables are dropped followed by database tables creation. On application shutdown, drop the database tables
validate 		Validate the database tables schema
update 			Update the database tables schema

• Use Case of using: spring.jpa.hibernate.ddl-auto=create
Automatic table generation is useful for
 Database integration testing with in-memory databases
 Basic, small hobby projects 


-- Create Database Tables from Java Code - Coding - Part 1
-- Create Database Tables from Java Code - Coding - Part 2
• Example for how to create database table by only making use of Java Code and zero use of sql queries
Project: 08-cruddemo-create-db-tables-automatically


------------------------------------------------------------------------------------------- Section 4 ---------------------------------------------------------------------------------------
-- What are REST Services - Part 1

• Business Problem
Build a client app that provides the weather report for a city
Need to get weather data from an external service

• Application Architecture

My Weather App		---- Pass city name as string ----->		Weather Service(external)
app that we are								Provided by External Third
creating(CLIENT)        <--- Send back Weather Report ------		Party (SERVER)


• Requirements
How will we connect to the Weather Service?
 We can make REST API calls over HTTP
 REST: REpresentational State Transfer
 Lightweight approach for communicating between applications

What programming language do we use?
 REST is language independent
 The client application can use ANY programming language
 The server application can use ANY programming language

What is the data format?
 REST applications can use any data format
 Commonly see XML and JSON
 JSON is most popular and modern
 JSON Stands for JavaScript Object Notation 

Possible Solution
 Use online Weather Service API provided by: openweathermap.org
 Provide weather data via an API
 Data is available in multiple formats: JSON, XML etc ...


Call Weather Service
 The API documentation gives us the following:
 Pass in the city name
 api.openweathermap.org/data/2.5/weather?q={city name}
 OR
 api.openweathermap.org/data/2.5/weather?q={city name},{country code}

Response - Weather Report
 The Weather Service responds with JSON
{
   ...
   "temp": 14,
   "temp_min": 11,
   "temp_max": 17,
   "humidity": 81,
   "name": "London"
   ...
}


-- What are REST Services - Part 2

• Example: Customer Relationship Manager(CRM) App
CRM	----- Get Customers ----->	CRM Service		(In this Project, we will create this CRM Service which will pass back customer data as json.)
App	<---- Customer List ------	(spring-rest)


-- JSON Basics
• What is JSON?
JavaScript Object Notation is just a plain text data
Lightweight data format for storing and exchanging data ... plain text
Language independent, not just for JavaScript 
Can use with any programming language: Java, C#, Python etc ...
 
• Simple JSON Example
Curley braces define objects in JSON
Object members are name:value pairs and they are delimited by colons
Name is always in double-quotes
In below example, the name is id, firstName, lastName and active.
		  the value is 14, Mario, Rossi and true
{
   "id": 14,
   “firstName": "Mario",
   “lastName": "Rossi",
   "active": true
}


-- Spring Boot REST HTTP Basics

• REST over HTTP
Most common use of REST is over HTTP
Leverage HTTP methods for CRUD operations

HTTP Method 		CRUD Operation
POST 			Create a new entity
GET 			Read a list of entities or single entity
PUT 			Update an existing entity
DELETE 			Delete an existing entity

• HTTP Messages
My CRM App	--- HTTP Request Message --->		CRM REST Service
(Client)        <-- HTTP Response Message ---		(Server)

• HTTP Request Message
The HTTP Request Message contain mainly 3 things:
Request line: the HTTP command
Header variables: request metadata
Message body: contents of message

• HTTP Response Message
Response line: server protocol and status code
Header variables: response metadata
Message body: contents of message

• HTTP Response - Status Codes
Code Range 		Description
100 - 199 		Informational
200 - 299 		Successful
300 - 399 		Redirection 
400 - 499 		Client error
500 - 599		Server error

• MIME Content Types
The message format is described by MIME content type stands for Multipurpose Internet Mail-Extension
Basic Syntax: type/sub-type
Examples
 text/html, text/plain
 application/json, application/xml, ...

• Client Tool
We need a client tool to send HTTP requests to the REST Web Service / API
Plenty of tools available: curl, Postman, etc ...


-- Spring Boot REST Controller - Overview - Part 1

• Spring REST Hello World
REST		--- /test/hello --->		Rest		(we will write code to create this Rest Service)	
Client          <--- Hello World ---		Service

• Spring REST Controller
@RestController				// here this adds REST Support
@RequestMapping("/test")
public class DemoRestController {
 @GetMapping ("/hello")			// Access the REST endpoint at /test/hello
 public String sayHello() {
  return "Hello World!";		// Returns content to client 
 }
}


-- Spring Boot REST Controller - Overview - Part 2
• Development Process
1. Add Maven dependency for Spring Boot Starter Web
File: pom.xml
<!-- Add Spring Boot Starter Web -->
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-web</artifactId>
</dependency>

2.Create Spring REST Service using @RestController
@RestController				// here this adds REST Support
@RequestMapping("/test")
public class DemoRestController {
 @GetMapping ("/hello")			// Handles HTTP GET requests so we can access the REST endpoint at /test/hello 
 public String sayHello() {
  return "Hello World!";		// Returns content to client 
 }
}


-- JSON Jackson Data Binding
• what is Java JSON Data Binding
Data binding is the process of converting JSON data to a Java POJO.

JSON   <---->   Java POJO
Here we are starting over on the left with JSON data and then we have our Java POJO. And so we can use data binding to convert from JSON
over to a Java POJO. So it will read the contents of that JSON string or file and then populate the Java object with that given data.
Or you can go the other way. You can start with the Java POJO and then send it down to an actual JSON string or JSON file.
Now this whole process is called data binding.

• Java JSON Data Binding using Jackson
Spring uses the Jackson Project behind the scenes
Jackson handles data binding between JSON and Java POJO
Spring Boot Starter Web automatically includes dependency for Jackson.

• Jackson Data Binding
By default, Jackson will call the appropriate getter/setter methods when it handles the conversions.
So if you're converting from JSON to POJO it will call up given setter methods.
When you go from POJO to JSON it will call the getter methods.
Here on the left hand side, I have this JSON object for id, first name, last name, and active. And then over on the right hand side,
i have this Java POJO for a student. And so what will happen here is that we will actually do the conversion
between JSON going to a Java POJO or starting with a Java POJO, like a student object, and then actually sending it down to a JSON string.
So Jackson can help us with all of this processing. And again, the important thing here is that it will actually use the getter and setter methods
for handling some of this processing.
{
  "id": 14,
  “firstName": "Mario",		------>		Java POJO
  "lastName": "Rossi",		<------		Student
  "active": true
}

• JSON to Java POJO
Convert JSON to Java POJO, Jackson will call setter methods on POJO.
Converting JSON to Java POJO. Jackson is gonna call the setter methods on the POJO.
So starting over here on the left hand side with this JSON object then we have this POJO, again, plain old JAVA class student.
We have some fields defined and we have the getter/setter methods.
So the important thing here, again, is that Jackson's gonna call the setter methods on the POJO.
So for ID, they're gonna call set ID. All right, and so, Jackson will actually do this work for you.
For first name it's gonna call set first name. For last name it's gonna call set last name.
And for active it's gonna call set active. So you see the pattern in here, right?
They basically use the name from the actual JSON. They call set. They take the first character of that name, make it cap,
and then use that to make the actual method call.
Now, again, I really wanna emphasize here. Jackson calls the setter methods. So it doesn't access any
of the internal private fields directly on the POJO. It'll only call the given setter methods.
So you have to make sure that you have those setter methods defined,
and in this case, making sure that they match up accordingly for this given example
{
  "id": 14,
  “firstName": "Mario",		Call setter methods		Java POJO
  "lastName": "Rossi",		------------------>		Student
  "active": true		Jackson will do this work
}

• Java POJO to JSON
Convert Java POJO to JSON, Jackson will call getter methods on POJO.
{
  "id": 14,
  “firstName": "Mario",		Call getter methods		Java POJO
  "lastName": "Rossi",		<------------------		Student
  "active": true		Jackson will do this work
}

• Spring and Jackson Support
When building Spring REST applications:
Spring will automatically handle Jackson Integration
JSON data being passed to REST controller is converted to POJO
Java object being returned from REST controller is converted to JSON
All these Happens automatically behind the scenes.


-- Spring Boot REST POJO - Overview
• Create a new Service
Returns a list of students
GET Method: /api/students  -- by entering this URL, it will make a GET request which will return a list of students.


• Spring REST Service
REST		--- /api/students 			       -->	REST 
Client		<--- returns a list of students in JSON format --- 	Service (we will write the code for service)

Our REST Service will return List<Student>
So we need to convert List<Student> to JSON
Jackson can help us out with this ...

• Behind the scenes
REST		--- /api/students 			       -->	Spring REST + Jackson		--->		REST 
Client		<--- returns a list of students in JSON format ---	Jackson will convert 		<--- 		Service (we will write the code for service)
								        List<Student> to JSON				returns List<Student>

-- Development Process
1. Create Java POJO class for Student
File: Student.java
public class Student{
   private String firstName;
   private String lastName;

   public Student(String firstName, String lastName){
      this.firstName = firstName;
      this.lastName = lastName;
   }
  
   public String getFirstName() {
      return firstName;
   }

   public void setFirstName (String firstName) {
      this.firstName = firstName;
   }

   public String getLastName() {
      return lastName;
   }

   public void setLastName (String lastName) {
      this.lastName= lastName;
   } 
}

2.Create Spring REST Service using @RestController
File: StudentRestController.java 
@RestController
@RequestMapping ("/api")
public class Student RestController {
   // define endpoint for "/students" return list of students
   @GetMapping ("/students")
   public List<Student> getStudents() {
      List<Student> theStudents = new ArrayList<>();		// here we are creating a new ArrayList of type 'Student'. 

      theStudents.add(new Student ("Poornima", "Patel"));	// here we are adding new members/elements/students in the above created ArrayList.(Hard Coded) 
      theStudents.add(new Student ("Mario", "Rossi"));
      theStudents.add(new Student ("Mary", "Smith"));

      return theStudents;					// here Jackson will convert List<Student> to JSON Format String and then return it. 
   }
}


-- Spring Boot REST POJO - Coding - Part 1
-- Spring Boot REST POJO - Coding - Part 2
Example: how to use Jackson for data binding between REST Client and REST Services
Project: 02-spring-boot-rest-crud-students-list-base


-- Spring Boot REST Path Variables - Overview
• Path Variables
Retrieve a single student by id.
GET Method: /api/students/{studentId}	-- by entering this URL, it will make a GET request which will return a single student which has studen id written in URL.
	    /api/students/0		-- Now this last digit is the studend id and it is known as path variable.
            /api/students/1
            /api/students/2...		so on

• Spring REST Service
REST		--- /api/students/{studentId}     -->	REST
Client  	<-- JSON Formatted single student ---	Service (we will write the code for service)

• Behind the scenes
REST		--- /api/students/{studentId} 		       -->	Spring REST + Jackson		--->		REST 
Client		<--- returns a single student in JSON format   ---	Jackson will convert 		<--- 		Service (we will write the code for service)
								        Student to JSON					returns a Student
• Developement Process
1. Add request mapping to Spring REST Service
   Bind path variable to method parameter using @PathVariable
File: StudentRestController.java
@RestController
@RequestMapping ("/api")
public class StudentRestController {

   // define endpoint for "/students/{studentId}" return student at index
   @GetMapping ("/students/{studentId}")			// here it is neccessary to mention the path variable name in curly braces to let spring know that, it will vary.
   public Student getStudent (@PathVariable int studentId) {	// Now this annotation is letting spring know that the name 'studentId' is going to be use as index value and must be same as above name
      List<Student> theStudents = new ArrayList<> ();

      // populate theStudents
      theStudents.add(new Student ("Poornima", "Patel"));	// here we are adding new members/elements/students in the above created ArrayList.(Hard Coded) 
      theStudents.add(new Student ("Mario", "Rossi"));
      theStudents.add(new Student ("Mary", "Smith"));

     return theStudents.get(studentId);
   }
}


-- Spring Boot REST Exception Handling - Overview - Part 1
-- Spring Boot REST Exception Handling - Overview - Part 2
• Problem
When a user enters an studentId which is out of the array length. Then the spring throws below error:
status: 500
error: Internal Server Error

• Solution
Now we can handle such problem with Spring Boot REST Exception handling through which we can return a JSON formatted customized String such as below:
status: 404
message: "Student with id 9999 is not found." 

• Bigger Picture
REST		--- /api/students/9999 -->	REST SERVICE + 
Client          <-- exception error message --	Exception Handler


• Development Process
1. Create a custom error response class
   The custom error response class will be sent back to client as JSON
   We will define the custom error response class as Java Class(POJO)	[Class name: StudentErrorResponse, it will have 3 private fields: status, message, timeStamp]
   Jackson will handle converting it to JSON:	{"status": 404, "message": "Student with id 9999 is not found.", "timeStamp": 123456789}   
File: StudentErrorResponse.java
public class StudentErrorResponse {
   private int status;
   private String message;
   private long timestamp;
   // constructors

   // getters / setters

}

2. Create a custom exception class
   The custom student exception will used by our REST service
   In our code, if we can't find student, then we'll throw an exception
   Need to define a custom student exception class: StudentNotFoundException
File: StudentNotFoundException
public class StudentNotFoundException extends RuntimeException { // Here we are making use of inheritance, so that we can make use of fields and methods of RuntimeException class
   public StudentNotFoundException(String message) {
      super (message); // this will call the constructor of the super class which is the RuntimeException class and we are sending the 'message' as argument.			
   }
}

3. Update REST service to throw exception if student not found
File: StudentRestController.java
@RestController
@RequestMapping ("/api")
public class StudentRestController {

   // define endpoint for "/students/{studentId}" return student at index
   @GetMapping ("/students/{studentId}")			// here it is neccessary to mention the path variable name in curly braces to let spring know that, it will vary.
   public Student getStudent (@PathVariable int studentId) {	// Now this annotation is letting spring know that the name 'studentId' is going to be use as index value and must be same as above name
      List<Student> theStudents = new ArrayList<> ();

      // populate theStudents
      theStudents.add(new Student ("Poornima", "Patel"));	// here we are adding new members/elements/students in the above created ArrayList.(Hard Coded) 
      theStudents.add(new Student ("Mario", "Rossi"));
      theStudents.add(new Student ("Mary", "Smith"));

      // check the studentId against the length of array
      if(studentId >= theStudents.size() || (studentId < 0)){
         throw new StudentNotFoundException("Student with id " + studentId + "is not found.");
      }
     return theStudents.get(studentId);
   }
}

4. Add an exception handler method using @ExceptionHandler
   Define exception handler method(s) with @ExceptionHandler annotation
   Exception handler will return a ResponseEntity
   ResponseEntity is a wrapper for the HTTP response object
   ResponseEntity provides fine-grained control to specify: HTTP status code, HTTP headers and Response body
File: StudentRestController.java
@RestController
@RequestMapping("/api")
public class StudentRestController {

   @ExceptionHandler	// This annotation is used to let spring know that below method is used in Exception handling
   public ResponseEntity<StudentErrorResponse> handleException (StudentNotFoundException exc) { // this exception handling method is of type 'StudentErrorResponse' 
      StudentErrorResponse error = new StudentErrorResponse();
      error.setStatus (HttpStatus.NOT_FOUND.value());
      error.setMessage (exc.getMessage());
      error.setTimeStamp (System.currentTimeMillis()); 
      return new ResponseEntity<> (error, HttpStatus. NOT_FOUND);
   } 
}


-- Spring Boot REST Global Exception Handling - Overview
• Problems with having normal Exception Handler
Exception handler code is only for the specific REST controller.
It cannot be re-used by other controllers, if having multiple controllers in one project.

• PROS of having Global Exception handlers
It promotes reusablity.
It centralizes exception handling. 

• Spring @ControllerAdvice
@controllerAdvice is similar to an interceptor / filter
Pre-process requests to controllers
Post-process responses to handle exceptions
Perfect for global exception handling

• Bigger Picture
REST		--- /api/students/9999 	    -->		Controller Advice(pre-processing request)		----------------------->	REST SERVICE
Client          <-- exception error message ---	        Global Exception handling(post-processing response)	<--- Throw Exception ---	

• Development Process
1. Create new @ControllerAdvice
File: StudentRestExceptionHandler.java
@ControllerAdvice
public class StudentRestExceptionHandler{

} 

2.Refactor REST service ... remove exception handling code
In this step, we are going to cut the code from 'StudentRestController.java' file and so that we can paste it into the controller advice.

3. Add exception handling code to @ControllerAdvice
File: StudentRestExceptionHandler.java
@ControllerAdvice	// With the help of this annotation, it makes the below exception handling code available on a global basis, for a given application. 
public class Student RestExceptionHandler {
   @ExceptionHandler
   public ResponseEntity<StudentErrorResponse> handleException (StudentNotFoundException exc) {
      StudentErrorResponse error = new StudentErrorResponse();
      error.setStatus (HttpStatus. NOT_FOUND.value());
      error.setMessage (exc.getMessage());
      error.setTimeStamp (System.currentTimeMillis());
      return new ResponseEntity<>(error, HttpStatus. NOT_FOUND);
   }
}

-- Spring Boot REST Global Exception Handling - Coding
Example: How to write code for Global Exception Handling
Project: 06-spring-boot-rest-crud-students-global-exception-handling


-- Spring REST API Design
• REST API Design
Few things, we need to keep in mind before creating REST API in real-time projects:
Who will use our API?
How will they use our API?
Now design the API based on such requirements.

• API Design Process
1. Review API requirements
 Create a REST API for the Employee Directory
 REST clients should be able to	full CRUD operations including all below
  Get a list of employees
  Get a single employee by id
  Add a new employee
  Update an employee
  Delete an employee

2. Identify main resource/entity
To identify main resource/entity, look for the most prominent "noun"
For our project, it is "employee"
Convention is to use plural form of resource/entity: employees
So the endpoint of this application can be: /api/employees

3. Use HTTP methods to assign action on resource
HTTP Method 		CRUD Action
POST 			Create a new entity
GET 			Read a list of entities or single entity
PUT 			Update an existing entity
DELETE 			Delete an existing entity

• Employee Real-time Project
HTTP Method 	Endpoint 			CRUD Action
POST 		/api/employees 			Create a new employee
GET 		/api/employees 			Read a list of employees
GET 		/api/employees/{employeeId} 	Read a single employee
PUT 		/api/employees 			Update an existing employee
DELETE 		/api/employees/{employeeId} 	Delete an existing employee


-- Spring Boot REST API Design - API Design of Real-Time Projects (PayPal, Github and SalesForce)
• More API Examples
  Paypal: Invoicing API: https://developer.paypal.com/api/rest/
  POST 	 -- Create draft Invoice -- /v1/invoicing/invoices
  PUT  	 -- Update Invoice	 -- /v1/invoicing/invoices/{invoice_id}
  GET	 -- List Invoices	 -- /v1/invoicing/invoices
  GET	 -- show Invoice details -- /v1/invoicing/invoices/{invoice_id}
  DELETE -- Delete draft Invoice -- /v1/invoicing/invoices/{invoice_id}

  GitHub: Repository API: https://docs.github.com/en/rest/repos?apiVersion=2022-11-28#repositories
  POST   -- Create a new repository -- /user/repos
  GET    -- List all repositories   -- /user/repos
  GET    -- Get a repository        -- /repos/:owner/:repo
  DELETE -- Delete a repository     -- /repos/:owner/:repo

  SalesForce: Industries REST API: https://developer.salesforce.com/docs/atlas.en-us.api_rest_industries.meta/api_rest_industries/put.htm
  POST	 -- Create an Individual     -- /services/apexrest/clinic01/vl/individual/
  PUT    -- Update an Individual     -- /services/apexrest/clinic01/vl/individual/
  GET    -- Retrieve all Individuals -- /services/apexrest/vl/individual/
  GET    -- Retrieve one Individual  -- /services/apexrest/vl/individual/{individual_id}


-- Spring Boot REST Project Overview
• About what we will create in this Project
REST API with Spring Boot that connects to a database

• API requirements
Create a REST API for the Employee Directory
 REST clients should be able to	full CRUD operations including all below
  Get a list of employees
  Get a single employee by id
  Add a new employee
  Update an employee
  Delete an employee

• REST API
HTTP Method 	Endpoint 			CRUD Action
POST 		/api/employees 			Create a new employee
GET 		/api/employees 			Read a list of employees
GET 		/api/employees/{employeeId} 	Read a single employee
PUT 		/api/employees 			Update an existing employee
DELETE 		/api/employees/{employeeId} 	Delete an existing employee

• Development Process
1. Set up Database Dev Environment
2. Create Spring Boot project using Spring Initializr
3. Get list of employees
4. Get single employee by ID
5. Add a new employee
6. Update an existing employee
7. Delete an existing employee

• Application Architecture
Employee REST Controller   <---->   Employee Service   <---->   Employee DAO   <---->   Database 


-- Spring Boot REST Setup Sample Data
• employee.sql
1. File: employee.sql, 
2. Create a new database table: employee
3. Load table with sample data

Run the sql file on MySQL Workbench.
Step 1: Set up Database Dev Environment -- Completed


-- Spring Boot REST Create Project
Go to: https://start.spring.io/
 Project: Maven
 Spring Boot: 3.0.6
 Project Metadata: As per you
 Packaging: Jar
 Java: 17
 Dependencies:
  Spring Web [WEB]: Build web, including RESTful, applications using Spring MVC. Uses Apache Tomcat as the default embedded container.
  Spring Data JPA [SQL]: Persist data in SQL stores with Java Persistence API using Spring Data and Hibernate.
  Spring Boot DevTools [DEVELOPER TOOLS]: Provides fast application restarts, LiveReload, and configurations for enhanced development experience.
  MySQL Driver [SQL]: MySQL JDBC driver.

Generate it, run it on Intellij and we have created our project.
Step 2: Create Spring Boot project using Spring Initializr -- Completed


-- Spring Boot REST DAO
• Application Architecture
Employee REST Controller   <---->   Employee Service   <---->   Employee DAO   <---->   Database
                                                              (Standard JPA API)
• DAO Impl
@Repository
public class EmployeeDAOJpaImpl implements EmployeeDAO {	// The 'EmployeeDAO' must have same interface for consistent API
   private EntityManager entityManager;				// Creating private field of type EntityManager

   @Autowired
   public EmployeeDAOJpaImpl (EntityManager theEntityManager) { // This is constructor injection and the 'theEntityManager' is created automatically by Spring Boot
      entityManager = theEntityManager;				// saving it into our private field, so that we can do CRUD operations with it.
   }

   ...
}

• Get a List of Employees
@Override
public List<Employee> findAll() {
   // create a query
   TypedQuery<Employee> theQuery = entityManager.createQuery("from Employee", Employee.class);

   // execute query and get result list
   List<Employee> employees = theQuery.getResultList();

   // return the results
   return employees;
}

• Development Process
1. Update db configs in application.properties
2. Create Employee entity
3. Create DAO interface
4. Create DAO implementation
5. Creat REST controller to use DAO


-- Spring Boot REST DAO - Coding - Part 1
-- Spring Boot REST DAO - Coding - Part 2
-- Spring Boot REST DAO - Coding - Part 3
Example: how to do below 5 stesp
         1. Update db configs in application.properties
         2. Create Employee entity
         3. Create DAO interface
         4. Create DAO implementation
         5. Creat REST controller to use DAO
Project: 20-spring-boot-rest-crud-employee-list-employees


-- Spring Boot Define Service Layer - Overview
• Refactor: Adding a Service Layer
Employee Rest Controller  <---->  Employee Service  <---->  Employee DAO  <----> Database 

• Purpose of Service Layer
It is actually an implementation of the Service Facade design pattern.
It is an intermediate layer for your custom business logic.
And we can also use it to integrate data from multiple sources.

• Integrate Multiple Data Sources
					↱          <---->  Employee DAO   <---->  Database
Employee Rest Controller  <---->  Employee Service <---->  Skills DAO     <---->  Database
                                        ↳          <---->  Payroll DAO    <---->  Database
Provide controller with a single view of the data that we integrated from multiple backend datasources

• Specialized Annotation for Services
Spring provides the @Service annotation
@Service applied to Service implementations
Spring will automatically register the Service implementation, thanks to component-scanning

• Development Process
1. Define Service Interface
public interface EmployeeService {
   List<Employee> findAll();
}

2. Define Service implementation: Inject the EmployeeDAO
@Service
public class EmployeeServicelmpl implements EmployeeService {
   // inject EmployeeDAO ...
   @Override
   public List<Employee> findAll() {
      return employeeDAO.findAll();
   }
}


-- Spring Boot Define Service Layer - Coding
Example: How to add an Employee Service Layer 
Project: 21-spring-boot-rest-crud-employee-refactored-service-layer
Step 3: Get list of employees -- completed

-- Spring Boot DAO: Add, Update, Delete - Overview
• Service Layer - Best Practice
Best practice is to apply transactional boundaries at the service layer
It is the service layer’s responsibility to manage transaction boundaries
For implementation code
 Apply @Transactional on service methods
 Remove @Transactional on DAO methods if they already exist

• DAO: Get a Single Employee
@Override
public Employee findById(int theId){
   // get employee
   Employee theEmployee = entityManager.find(Employee.class, theId);
  
   // return employee
   return theEmployee;
}

• DAO: Add or Update employee
@Override
public Employee save(Employee theEmployee){
   // save or update the employee
   Employee dbEmployee = entityManager.merge(theEmployee);	// here if the id of 'theEmployee' is equal to 0, then it is saved as a new employee(add). If not then it has updated an existing one. 

   // return the updated or saved employee
   return dbEmployee;
} 

• DAO: Delete an existing employee
@Override
public void deleteById(int theId){
   // find the employee by id
   Employee theEmployee = entityManager.find(Employee.class, theId);
  
   // return employee
   entityManager.remove(theEmployee);
} 


-- Spring Boot DAO: Add, Update, Delete - Coding
Example: Adding Remaming CRUD Methods on DAO
Project: 22-spring-boot-rest-crud-employee-dao-find-add-update-delete


-- Spring Boot Service: Add, Update, Delete - Coding
Example: Adding Remaming CRUD Methods on Service
Project: 22-spring-boot-rest-crud-employee-service-find-add-update-delete

-- Spring Boot REST: Get Single Employee - Overview
• Read a Single Employee
REST	---- GET /api/employees/{employeeId} ---->	Employee 	 
Client  <---- employee information in JSON   -----	REST Controller

• Sending JSON to Spring REST Controllers
When sending JSON data to Spring REST Controllers
For controller to process JSON data, need to set a HTTP request header
Content-type: application/json
Need to configure REST client to send the correct HTTP request header

• Postman - Sending JSON in Request Body
Must set HTTP Request Header in Postman
Body: raw, JSON


-- Spring Boot REST: Get Single Employee - Coding
Example : Adding REST Controller method for getting a single employee
Project: 24-spring-boot-rest-crud-employee-rest-controller-get-single-employee 


-- Spring Boot REST: Add Employee - Coding 
Example : Adding REST Controller method for adding a single employee
Project: 25-spring-boot-rest-crud-employee-rest-controller-add-employee 


-- Spring Boot REST: Update Employee - Coding
Example : Adding REST Controller method for updating a single employee
Project: 26-spring-boot-rest-crud-employee-rest-controller-update-employee-and-delete-employee 


-- Spring Boot REST: Delete Employee - Coding
Example : Adding REST Controller method for deleting a single employee
Project: 26-spring-boot-rest-crud-employee-rest-controller-update-employee-and-delete-employee 


-- Spring Boot REST: Spring Data JPA - Overview
• The Problem 
We saw how to create a DAO for Employee: EmployeeDAO and EmployeeDAOJpaImpl
What if we need to create a DAO for another entity? such as Customer, Student, Product, Book...
Do we have to repeat all of the same code again???

• Creating a DAO
We may have noticed a pattern with creating DAOs.
Mose of the code is the same.
The only difference is the entity type and primary key type.

• Spring Data JPA - Solution
Spring Data JPA is the solution!!!
Create a DAO and just plug in your entity type and primary key
Spring will give you a CRUD implementation for FREE
It helps to minimize boiler-plate DAO code.
More than 70% reduction in code is possible, depending on use case

• JpaRepository
Spring Data JPA provides the interface: JpaRepository
Exposes methods (some by inheritance from parents)
Now we will be able to access methods such as: findAll(), findById(...), save(...), deleteById(...) and many others.
Now using this interface, we only have to plugin the 'Entity' and 'Primary Key'.
And they can be of any type, such as:
Entity: Product,	Primary Key type: Integer
Entity: Customer,	Primary Key type: Integer
Entity: Student,	Primary Key type: Integer

• Development Process
1. Extend JpaRepository interface
public interface EmployeeRepository extends JpaRepository<Employee, Integer> {	// here we are mentioning the Entity type as 'Employee' and Primary Key type as 'Integer' which is necessary
  // that's it ... no need to write any code LOL! and still we will have access to methods like findAll(), findById(...), save(...), deleteById(...) and many others.
}

2. Use your Repository in your app (No need for an Implementation class)
@Service
public class EmployeeServiceImpl implements EmployeeService {
   private EmployeeRepository employeeRepository;

   @Autowired
   public EmployeeServiceImpl (EmployeeRepository theEmployeeRepository) {
      employeeRepository = theEmployeeRepository;
   }

   @Override
   public List<Employee> findAll(){
      return employeeRepository.findAll();
   }
}

• Advacned Features
Advanced features available for
 Extending and adding custom queries with JPQL
 Query Domain Specific Language (Query DSL)
 Defining custom methods (low-level coding)


-- Spring Boot REST: Spring Data JPA - Coding - Part 1
-- Spring Boot REST: Spring Data JPA - Coding - Part 2
Example: Using Spring Data JPA to Perform CRUD Operations.
Project:30-spring-boot-rest-crud-employee-with-spring-data-jpa


-- Spring Boot REST: Spring Data REST - Overview
• The Problem
We saw how to create a REST API for Employee: EmployeeRestController, EmployeeService and EmployeeServiceImpl
What if we need to create REST API for another entity? such as: Customer, Student, Product, Book...
Do we have to repeat all of the same code again???

• Spring Data REST - Solution
Spring Data REST is the solution!!!
Leverages your existing JpaRepository
Spring will give you a REST CRUD implementation for FREE .... like MAGIC
It helps to minimize boiler-plate REST code!!!
And no new coding required!!!

• REST API
Spring Data REST will expose these endpoints for free!
HTTP Method 	Endpoint 			CRUD Action
POST 		/api/employees 			Create a new employee
GET 		/api/employees 			Read a list of employees
GET 		/api/employees/{employeeId} 	Read a single employee
PUT 		/api/employees 			Update an existing employee
DELETE 		/api/employees/{employeeId} 	Delete an existing employee

• Spring Data REST - How Does It Work?
Spring Data REST will scan your project for JpaRepository
Expose REST APIs for each entity type for your JpaRepository

• REST Endpoints
By default, Spring Data REST will create endpoints based on entity type
It will provide simple pluralized form:
 First character of Entity type is lowercase
 Then just adds an 's' to the entity
 So for Employee, it will be /employees

• Development Process
1. Add Spring Data REST to your Maven POM file
<dependency>
   <groupId>org.springframework.boot</groupId>
   <artifactId>spring-boot-starter-data-rest</artifactId>
</dependency>

That is it, Absolutely NO CODING required!!
Spring Data REST will scan our project for JpaRepository
Spring Data REST will create endpoints based on entity type 
Spring Data REST will expose these endpoints for free!

• In a Nutshell
For Spring Data REST, you only need 3 items
1. Your entity: Employee
2. JpaRepository: EmployeeRepository extends JpaRepository
3. Maven POM dependency for: spring-boot-starter-data-rest

• Application Architechture
Spring Data REST	<---->		Employee Repository	<---->		Database
/employees                              Spring Data JPA	

• HATEOAS
Spring Data REST endpoints are HATEOAS compliant
HATEOAS: Hypermedia as the Engine of Application State
Hypermedia-driven sites provide information to access REST interfaces
Think of it as meta-data for REST data
For a collection, meta-data includes page size, total elements, pages etc.
HATEOAS uses Hypertext Application Language (HAL) data format

• Advanced Features
Spring Data REST advanced features
 Pagination, sorting and searching
 Extending and adding custom queries with JPQL
 Query Domain Specific Language (Query DSL)


-- Spring Boot REST: Spring Data REST - Coding - Part 1
-- Spring Boot REST: Spring Data REST - Coding - Part 2
Example: Using Spring Data REST to Perform CRUD Operations.
Project:30-spring-boot-rest-crud-employee-with-spring-data-jpa

• Spring Data REST Properties
To change base path: spring.data.rest.base-path=/magic-api


-- Spring Boot REST: Spring Data REST Configs and Sorting - Overview
• The Problem 
Spring Data REST does not handle complex pluralized forms such as: Goose-Geese, Person-People, Syllabus-Syllabi. In this case, you need to specify plural name.
What if we want to expose a different resource name? Instead of /employees ... use /members

• Solution
Specify plural name/path with an annotation:
@RepositoryRestResource(path="members")
public interface EmployeeRepository extends JpaRepository<Employee, Integer> {	
}   
Now it will make use /members in the url: http://localhost:8080/members

• Pagination
By default, Spring Data REST will return the first 20 elements
 Page size = 20
You can navigate to the different pages of data using query param
 http: //localhost: 8080/employees?page=0 (Pages are zero-based)
 http: //localhost: 8080/employees?page=1 
 ...

• Spring Data REST Configuration
File: applicaiton.properties
Name 					Description
spring.data.rest.base-path 		Base path used to expose repository resources
spring.data.rest.default-page-size 	Default size of pages
spring.data.rest.max-page-size 		Maximum size of pages

• Sample Configuration
File: applicaiton.properties
spring.data.rest.base-path=/magic-api   // http://localhost:8080/magic-api/employees
spring.data.rest.default-page-size=50	// it will return 50 elements per page

• Sorting
You can sort by the property names of your entity
 In our Employee example, we have: firstName, lastName and email
 Sort by last name (ascending is default): http://localhost:8080/employees?sort=lastName
 Sort by first name, descending: http://localhost:8080/employees?sort=firstName, desc
 Sort by last name, then first name, ascending: http://localhost:8080/employees?sort=lastName,firstName,asc 


------------------------------------------------------------------------------------------- Section 5 ---------------------------------------------------------------------------------------
-- Spring Boot REST API Security Overview
• We will learn how to
Secure Spring Boot REST APIs
Define users and roles
Protect URLs based on role
Store users, passwords and roles in DB (plain-text -> encrypted)

• Spring Security Model
Spring Security defines a framework for security
Implemented using Servlet filters in the background
Two methods of securing an app: declarative and programmatic

• Spring Security with Servlet Filters
Servlet Filters are used to pre-process / post-process web requests
Servlet Filters can route web requests based on security logic
Spring provides a bulk of security functionality with servlet filters

• Spring Security Overview
We have a web browser on the left, and then on the right, we have this protected web resource
like /mytopsecretstuff. The browser's attempting to access our top-secret information and get the results.
Now, this is where Spring Security comes into play. These Spring Security filters will intercept those requests,
pre-process them, and then see if the user can actually access that protected resource.
Spring Security will look at our application security configuration.
And then, it'll also look at the user's passwords and roles that are in our database
to see if this user's authenticated and also if they're authorized to access this web resource.
And this all happens in the background, thanks to Spring Security.

Web browser <----> Spring Security Filters <----> Protected Web Resource(/mytopsecretstuff)
                            |----> checks our app security configuration <----> check users passwords roles 

• Spring Security in action (pseudo code)
Step 1: Spring Security Filters
Step 2: Is Web Resource Protected?
        a. Yes: Go to Step 3
        b. No : Go to Step 9 
Step 3: Is user Authenticated?
        a. Yes: Go to Step 7 
        b. No : Go to Step 4
Step 4: Send to Login Form
Step 5: Show Login Form
Step 6: Authenticate user id & password than go to step 3
step 7: Is user Authorized?
        a. Yes: Go to Step 9
        b. No : Go to step 8 
Step 8: Access Denied
Step 9: Show Resource 

• Spring Security Concepts
Authentication: Check user id and password with credentials stored in app / db 
Authorization : Checks to see if the user has an authorized role.

• Declarative Security 
Define application’s security constraints in configuration. All Java config: @Configuration
Provides separation of concerns between application code and security
 
• Programmatic Security
Spring Security provides an API for custom application coding
Provides greater customization for specific app requirements

• Enabling Spring Security
1. Edit pom.xml by adding spring-boot-starter-security
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-security</artifactId>
</dependency>

2. This will automagically secure all endpoints for application
  
• Secured Endpoints
When we access our application, Spring Security will prompt for login
Default username: user
Default password: check console logs for autogenerated password 

• Spring Security Configuration
We can always override default username and generated password
File: application.properties
spring.security.user.name=aumsoni
spring.security.user.password=aum123

• Authentication and Authorization
There are different techniques for defining users, passwords, and roles.
We can make use of in-memory authentication. We can also use JDBC to define users,
passwords, and roles in a database. There's support for LDAP.
We can also use our own custom plugin, our own authentication, and authorization coding,
and there's plenty of others out there.
In-memory, JDBC ,LDAP ,Custom / Pluggable, others

In this section, we'll actually cover the in-memory authentication.
And then, we'll also cover password storage in the database using JDBC.
We will see how to store our passwords using plain text, and we'll also 
look at how to encrypt the passwords in the database.


-- Spring Boot REST API Security - Coding - Part 1
-- Spring Boot REST API Security - Coding - Part 2
Example: Injecting spring-boot-rest-security dependency in pom.xml and setting user & password in application.properties
Project: 01-spring-boot-rest-security-default-security


-- Spring Boot REST API Security - Basic Configuration - Overview
• Our Users
User Id		Password	Roles
john 		test123 	EMPLOYEE
mary 		test123 	EMPLOYEE, MANAGER
susan 		test123 	EMPLOYEE, MANAGER, ADMIN

• Spring Security Password Storage
In Spring Security, passwords are stored using a specific format as shown below
{id}encodedpassword: In the curly braces, we give the actual id and then we have the encoded password.

The idea here is that we have the encoding algorithm that's being used for this password.
In this example, we have noop, means no operation. That's just for plain text passwords, meaning no encryption,
no hashing, no nothing, just plain text and then we have bcrypt and that's for BCrypt password hashing.
Basically, that's one-way hashing or one-way encryption. We take the password and we hash it using a given 
BCrypt algorithm and it's stored in that fashion.
ID		Description
noop		Plain text passwords
bcrypt 		BCrypt password hashing 

• Password Example
1. {noop}test123: no operation example
{noop}  = The encoding algorithm id. Here we are writting 'noop' to let Spring Security know that we are using 'noop' that is the passwords are stored as plain text.
test123 = This is just our password.

• Development Process
1. Create Spring Security Configuration (@Configuration)
File: DemoSecurityConfig.java
import org.springframework.context.annotation.Configuration;
@configuration
public class DemoSecurityConfig {
  // add our security configurations here ...
}

2. Add users, passwords and roles
File: DemoSecurityConfig.java
import org.springframework.context.annotation.Configuration;
@configuration
public class DemoSecurityConfig {
    @Bean
    public InMemoryUserDetailsManager userDetailsManager() {
        UserDetails john = User.builder()
                .username("john")
		.password("{noop}test123")
		.roles("EMPLOYEE")
		.build();

	UserDetails mary = User.builder()
		.username("mary")
		.password("{noop}test123")
		.roles("EMPLOYEE", "MANAGER")
		.build();

	UserDetails susan = User.builder()
		.username("susan")
		.password("{noop}test123")
		.roles("EMPLOYEE", "MANAGER", "ADMIN")
		.build();

	return new InMemoryUserDetailsManager (john, mary, susan);
     }
}	


-- Spring Boot REST API Security - Basic Configuration - Coding
Example: How to create Spring Security Configuration (@Configuration) and add users, passwords and roles in it.
Project: 00-spring-boot-rest-security-employee-starter-code
Postman: Authorization -> type: Basic Auth -> Username & Password


-- Spring Boot REST API Security - Restrict URLs based on Roles - Overview 
• Restrict URLs based on Roles Example
HTTP Method 	Endpoint 			CRUD Action 	Role
GET 		/api/employees 			Read all 	EMPLOYEE
GET 		/api/employees/{employee Id} 	Read single 	EMPLOYEE
POST 		/api/employees 			Create 		MANAGER
PUT 		/api/employees 			Update 		MANAGER
DELETE 		/api/employees/{employeId} 	Delete 		ADMIN

• Restricting Access to Roles
In the below syntax: 
We have to add 2 things inside requestMatchers
1. HTTP Method = We have to add a HTTP Method such as 'GET', 'POST', 'PUT' or any other HTTP Method.
2. Path        = We have add a path such as '/api/employees' to provide access

Than we have to add 1 thing inside hasRole
1. Authorized Role =  We have to add a role such as 'ADMIN' to whom the access should be provided. And There must be only 1 role defined here

General Syntax: For 1 HTTP Method, 1 Path and 1 Authorized role
requestMatchers(<<add HTTP Method to match on>>, << add path to match on >>)	
       .hasRole(<< authorized role, must be only 1 >>)	        				

General Syntax: For 1 HTTP Method, 1 Path and 1 or more Authorized role
requestMatchers(<<add HTTP Method to match on>>, << add path to match on >>)	
       .hasAnyRole(<< authorized role, can be 1 or more than 1 with comma-delimited >>)

• Authorize Requests for EMPLOYEE Role
requestMatchers(HttpMethod.GET, "/api/employees").hasRole("EMPLOYEE")	 // Giving access to all 'Employees' for CRUD Action: Read all 
requestMatchers(HttpMethod.GET, "/api/employees/**").hasRole("EMPLOYEE") // Giving access to all 'Employees' for CRUD Action: Read single [the ** matches on all sub-paths]

• Authorize Requests for MANAGER Role
requestMatchers(HttpMethod.POST, "/api/employees").hasRole("MANAGER")	 // Giving access to all 'Managers' for CRUD Action: Create a single Employee 
requestMatchers(HttpMethod.PUT, "/api/employees").hasRole("MANAGER")	 // Giving access to all 'Managers' for CRUD Action: Update a single Employee 

• Authorize Requests for ADMIN Role
requestMatchers(HttpMethod.DELETE, "/api/employees/**").hasRole("ADMIN") // Giving access to all 'Admins' for CRUD Action: Delete single [the ** matches on all sub-paths]

• Pull It Together
@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http.authorizeHttpRequests(configurer ->
                configurer
                        .requestMatchers(HttpMethod.GET, "/api/employees").hasRole("EMPLOYEE")
                        .requestMatchers(HttpMethod.GET, "/api/employees/**").hasRole("EMPLOYEE")
                        .requestMatchers(HttpMethod.POST, "/api/employees").hasRole("MANAGER")
                        .requestMatchers(HttpMethod.PUT, "/api/employees").hasRole("MANAGER")
                        .requestMatchers(HttpMethod.DELETE, "/api/employees/**").hasRole("ADMIN"));
    // use HTTP Basic authentication
    http.httpBasic();

    // disable Cross Site Request Forgery
    http.csrf().disable();   
 
    return http.build();
}

• Cross-Site Request Forgery (CSRF)
Spring Security can protect against CSRF attacks
Embed additional authentication data/token into all HTML forms
On subsequent requests, web app will verify token before processing
Primary use case is traditional web applications (HTML forms etc ...)

• When to use CSRF Protection
The Spring Security team recommends:
 Use CSRF protection for any normal browser web requests
 Traditional web apps with HTML forms to add/modify data
If you are building a REST API for non-browser clients, you may want to disable CSRF protection
In general, not required for stateless REST APIs, That use POST, PUT, DELETE and/or PATCH


-- Spring Boot REST API Security - Restrict URLs based on Roles - Coding - Part 1
-- Spring Boot REST API Security - Restrict URLs based on Roles - Coding - Part 2
-- Spring Boot REST API Security - Restrict URLs based on Roles - Coding - Part 3
Example: How to provide access to URLs based on user roles and testing them through Postman.
Project: 03-spring-boot-rest-security-restrict-access-based-on-roles


-- Spring Boot REST API Security - JDBC Authentication - Plain Text - Overview
• Database Access
So far, our user accounts were hard coded in Java source code
In this section, We will add user accounts into the database and will access those user accounts from it.
It is an Advanced feature of Spring Security.

• Database Support in Spring Security
Spring Security can read user account info from database. By default, we have to follow Spring Security’s predefined table schemas
But the nice thing about it is that by following their schemas, and then Spring Security includes all of the JDBC code
to actually read information from the database. There's very little Java code we have to write as far as JDBC code
for reading information from the database. All we have to do is simply set up the configuration, create the appropriate tables,
and Spring Security will do all the heavy lifting for us in the background.
Spring Security <----> JDBC Code <----> Database

• Customize Database Access with Spring Security
Now we also have the option of customizing the table schemas. This is very useful if we have custom tables specific to your given project.
The only thing that we will be responsible for is developing the code to access the data. 
In this scenario, we will have to write the low-level JDBC code or Hibernate code to read the data from the appropriate tables.
We will have to read the account information and also read the user roles.

• Default Spring Security Database Schema
Spring Security has a default database schema, so we need to provide two tables,
one called 'users' and another one called 'authorities'. And we have to use these exact table names.
And also the tables need to have these specific columns, username, password, and enabled for the 'users' table.
And then also username and authority for the 'authorities' table. We need to have the exact same table names
and columns as shown here. 
Tables:
users       : username, password, enabled
authorities : username, authority

• Development Process
1. Develop SQL Script to set up database tables
CREATE TABLE `users` (
  `username` varchar(50) NOT NULL,
  `password` varchar(50) NOT NULL,
  `enabled` tinyint NOT NULL,
  
  PRIMARY KEY (`username`)

) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO `users`
VALUES
('john','{noop}test123',1),
('mary','{noop}test123',1),
('susan','{noop}test123',1) ;

CREATE TABLE `authorities` (
  `username` varchar (50) NOT NULL,
  `authority` varchar (50) NOT NULL,

  UNIQUE KEY `authorities_idx_1` (`username`,`authority`),

  CONSTRAINT `authorities ibfk l`
  FOREIGN KEY (`username`)
  REFERENCES `users` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO `authorities`
VALUES
('john','ROLE_EMPLOYEE'),
('mary','ROLE_EMPLOYEE'),
('mary','ROLE_MANAGER'),
('susan','ROLE_EMPLOYEE'),
('susan','ROLE_MANAGER'),
('susan','ROLE_ADMIN');

2. Add database support to Maven POM file
<!-- MySQL -->
<dependency>
 <groupId>com.mysql</groupId>
 <artifactId>mysql-connector-j</artifactId>
 <scope>runtime</scope>
</dependency>

3.Create JDBC properties file
File: applicaiton.properties
# JDBC connection properties
spring.datasource.url=jdbc:mysql://localhost:3306/employee_directory
spring.datasource.username=springstudent
spring.datasource.password=springstudent

4. Update Spring Security Configuration to use JOBC
@Configuration
public class DemoSecurityConfig {
    @Bean
    public UserDetailsManager userDetailsManager(DataSource dataSource) { // here we are injecting DataSource, so that JDBC Authentication can make use of it. 
        return new JdbcUserDetailsManager (dataSource) ;  // here we are telling spring to make use of JDBC Authentication with our datasource.
    }
}


-- Spring Boot REST API Security - JDBC Authentication - Plain Text - Coding Part 1
-- Spring Boot REST API Security - JDBC Authentication - Plain Text - Coding Part 2
-- Spring Boot REST API Security - JDBC Authentication - Plain Text - Coding Part 3
Example: Exceuting SQL Queries to create Database tables for putting user's information and writting code for accessing those user information from those database
Project: 04-spring-boot-rest-security-jdbc-plain-text


-- Spring Boot REST API Security - BCrypt Encryption - Overview - Part 1
• Password Storage - Best Practice
The best practice is to store passwords in an encrypted format
username 	password  								enabled
john 		{bcrypt}$2a$10$qeSOHEh7urweMojsnwNAR.vcXJeXR1 UcMRZ2WcGQI9YeuspUdgF.q 	1
mary 		{bcrypt}$2a$10$qeSOHEh7urweMojsnwNAR.vcXJeXR1 UcMRZ2WcGQI9YeuspUdgF.q 	1
susan 		{bcrypt}$2a$10$qeSOHEh7urweMojsnwNAR.vcXJeXR1 UcMRZ2WcGQI9YeuspUdgF.q 	1

• Spring Security Team Recommendation
Spring Security recommends using the popular bcrypt algorithm
bcrypt
 Performs one-way encrypted hashing
 Adds a random salt to the password for additional protection
 Includes support to defeat brute force attacks

• How to Get a Bcrypt password
We have a plaintext password and you want to encrypt using bcrypt
 Option 1: Use a website utility to perform the encryption
           Visit: www. luv2code.com/generate-bcrypt-password
           Enter your plaintext password
           The website will generate a bcrypt password for you
 Option 2: Write Java code to perform the encryption


-- Spring Boot REST API Security - BCrypt Encryption - Overview - Part 2           
• Spring Security Password Storage Rules
The password column must be at least 68 chars wide
{bcrypt} - 8 chars
encodedPasswords - 60 chars
Modify DDL for password field, length should be 68 - `password` char(68) NOT NULL

• Development Process
1. Run SQL Script that contains encrypted passwords
INSERT INTO `users` 
VALUES 
('john','{bcrypt}$2a$10$qeS0HEh7urweMojsnwNAR.vcXJeXR1UcMRZ2WcGQl9YeuspUdgF.q',1),
('mary','{bcrypt}$2a$10$qeS0HEh7urweMojsnwNAR.vcXJeXR1UcMRZ2WcGQl9YeuspUdgF.q',1),
('susan','{bcrypt}$2a$10$qeS0HEh7urweMojsnwNAR.vcXJeXR1UcMRZ2WcGQl9YeuspUdgF.q',1);   

• Spring Security Login Process
REST Client <-- User enters plain text password --> Spring Security Filters <----> Database(containing user information)
How Spring Security Filter will work:
1. Retrieve password from db for the user
2. Read the encoding algorithm id (bcrypt etc)
3. For case of bcrypt, encrypt plaintext password from login form (using salt from db password)
4. Compare encrypted password from login form WITH encrypted password from db (the password from db is never decrypted, because bcrypt is a one-way encryption algorithm)
5. If there is a match, login successful
6. If no match, login NOT successful


-- Spring Boot REST API Security - BCrypt Encryption - Coding
Example: Exceuting SQL Queries to create Database tables for putting user's information and writting code for accessing those user information from those database
Project: 05-spring-boot-rest-security-jdbc-bcrypt


-- Spring Boot REST API Security - JDBC Authentication - Custom Tables - Overview
• Making use of Custom Tables to store user information
Till now we made use of default Spring Security Database Schema.
We can also make use of Custom tables as per our need.
But to do that that is to do Security Schema Customization we must have to provide below following things:
Tell Spring how to query your custom tables
Provide query to find user by user name
Provide query to find authorities / roles by user name


• Development Process
1. Create our custom tables with SQL
Custom tables:
members	     : user_id, pw, active	 
roles        : user_id, role

2. Update Spring Security Configuration
   Provide query to find user by user name
   Provide query to find authorities / roles by user name
@Configuration
public class DemoSecurityConfig {
    @Bean
    public UserDetailsManager userDetailsManager(DataSource dataSource) { 
        JdbcUserDetailsManager theUserDetailManager = new JdbcUserDetailsManager(dataSource);
 
         theUserDetailManager
            .setUsersByUsernameQuery("select user_id, pw, active from members where user_id=?");
 
         theUserDetailManager
            .setAuthoritiesByUsernameQuery("select user_id, role from roles where user_id=?");
         
        return new JdbcUserDetailsManager(dataSource);  
    }
}


-- Spring Boot REST API Security -Custom Tables - Coding - Part 1
-- Spring Boot REST API Security -Custom Tables - Coding - Part 2
-- Spring Boot REST API Security -Custom Tables - Coding - Part 3
Example: Executing Queries to create Custom Tables, Updating Spring Security Configuration and testing through Postman
Project: 06-spring-boot-rest-security-jdbc-bcrypt-custom-table-names


------------------------------------------------------------------------------------------- Section 6 ---------------------------------------------------------------------------------------
-- Spring Boot - Spring MVC with Thymeleaf - Overview
• What is Thymeleaf? (www.thymeleaf.org)
Thymeleaf is a Java templating engine
Commonly used to generate the HTML views for web apps
However, it is a general purpose templating engine
we can use Thymeleaf outside of web apps
It is a separate project unrelated to spring.io
We can create Java Apps with Thymeleaf, There is no need for spring to do that.
But there is a lot of synergy between the two projects.

• What is a Thymeleaf template?
It can be an HTML page with some Thymeleaf expressions
It includes dynamic content from Thymeleaf expressions

• Where is the Thymeleaf template processed?
In a web app, Thymeleaf is processed on the server.
Results included in HTML returned to browser.
The web browser sends a request over to Spring MVC controller. The controller adds some data to the model,
sends it over to the template, and then the template sends back HTML to the web browser.
Web Browser ---1---> Spring MVC Controller ---2 [Model]---> Thymeleaf Template ---3---> Web Browser

• Where to place Thymeleaf templat?
In Spring Boot, your Thymeleaf template files go in: src/main/resources/templates
For web apps, Thymeleaf templates have a .html extension

• Additional Features 
Looping and conditionals
CSS and JavaScript integration
Template layouts and fragments

• Development Process
1. Add Thymeleaf to Maven POM file
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-thymeleaf</artifactId>
</dependency>

2. Develop Spring MVC Controller
File: DemoController.java
@Controller
public class DemoController {
  @GetMapping("/")
  public String sayHello(Model theModel){
    theModel.addAttribute("theDate", new java.util.Date());	// this attribute 'theDate' will be accessed by Thymeleaf HTML Template from this Spring MVC Model
    return "helloworld"; // As we inject Thymeleaf dependency in Maven POM, Spring will auto-configure to use Thymeleaf and look for 'helloworld.html' file in src/main/resources/templates/
  }
}

3. Create Thymeleaf template
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">	<!-- To use Thymeleaf expressions -->
<head> ... </head>

<body>
    <p th:text="'Time on the server is ' + ${theDate}" />	<!-- This is our Thymeleaf Expressions 'th:text...' -->
</body>

</html>


-- Spring Boot - Spring MVC with Thymeleaf - Coding - Part 1
-- Spring Boot - Spring MVC with Thymeleaf - Coding - Part 2
Example: Creating our first Web application with using Spring MVC Model and Thymeleaf
Project: 01-thymeleafdemo-helloworld


-- Spring Boot - Spring MVC with Thymeleaf and CSS - Overview
• Using CSS with Thymeleaf Templates
You have the option of using
 Local CSS files as part of your project
 Referencing remote CSS files

• Other Search Directories
Spring Boot will search following directories for static resources under: /src/main/resources
/META-INF/resources
/resources
/static
/public

• 3rd Party CSS Libraries - Bootstrap
Option 1: Local Installation
          Download Bootstrap file(s) and add like shown: src/main/resources/static/css/bootstrap.min.css
          So we can reference it in our template as shown: <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
Option 2: Remote Files
          We can access the Bootstrap files remotely on the internet.
          So we can reference it in our template with 'href' tag as shown: <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">

• Development Process
1. Create CSS file
Spring Boot will look for all static resources in the: src/main/resources/static folder.
We will create a file named 'demo.css' inside a sub-directory 'css' in the src/main/resources/static folder.
We can create as many sub-directories as we want with any custom name inside 'static' folder. But it always should be inside 'static' folder.
File: src/main/resources/static/css/demo.css
.funny{
  font-style: italic;
  color: green;
}

2. Reference CSS in Thymeleaf template
<head>
    <title>Thymeleaf Demo</title>
    <link rel="stylesheet" th:href="@{/css/demo.css}">	<!-- This is how we reference css in Thymeleaf template -->
</head>

3. Apply CSS style
<body>
<p th:text="'Time on the server is ' + ${theDate}" class="funny"/>    <!-- This is how we apply css class to our HTML tags -->
</body>


-- Spring Boot - Spring MVC with Thymeleaf and CSS - Coding
Example: Adding CSS to our created ThymeleafDemoApplication
Project: 02-thymeleafdemo-helloworld-css
 

-- Spring Boot - Spring MVC Validation - Overview
here we will perform validation on a form input fields

• The Need for Validation
Check the user input form for required fields, valid numbers in a range, valid format (postal code), custom business rule ad so on.

• Java's Standard Bean Validation API: http://www.beanvalidation.org
Java has a standard Bean Validation API
Defines a metadata model and API for entity validation
Spring Boot and Thymeleaf also support the Bean Validation API

• Validation Annotations
Annotation		Description
@NotNull		Checks that the annotated value is not null
@Min			Must be a number >= value
@Max                    Must be a number <= value
@Size			Size must match the given size
@Pattern                Must match a regular expression pattern
@Future / @Past         Date must be in future or past of given date
others...
 
• Our Road Map: what we are going to do moving forward
1. set up our development environment
2. required field
3. validate number range: min, max
4. validate using regular expression (regexp)
5. custom validation


-- Spring Boot - Spring MVC Validation - Setup Dev Environment
Video: 164


-- Spring Boot - Spring MVC Validation - Required Fields - Overview
• Require Fields
here we will create a HTML page in which we will put two fields firstname nad lastname  in our form for users to fill. 
We will make the lastname input field as required. So if the user is submitting the form without entering the lastname,
we will show the user an error message saying 'Lastname is required'.

• Pulling It All Together  
There are going to be two fields firstname and lastname, and a submit button in our 'customer-form.html'. When the user clicks on submit button, we will send the 
customer object which contains the user entered data to our customer controller. Now the customer controller performs validation and if the validation passes the user
will be redirected to a new page or if the validation fails the user will be redirected back to the 'customer-form.html' page.

customer-form.html  -- Customer Object -->  Customer Controller  -- Passes Validation --> New Page
                 <-- Fails Validation --            |  

• Thymeleaf Properties
th:action="@{/processForm}" -- here we are telling spring to exactly where we want the form to be submitted.
th:object="${customer}"     -- here we are telling spring to use 'customer' model attribute which we added in the CustomerController before returing the HTML Page.
th:field="*{firstName}"     -- as we are using object 'customer' which contains an instance of the class 'Customer', now this class has two fields firstName and lastName which we can use. 
th:field="*{lastName}"      -- as we are using object 'customer' which contains an instance of the class 'Customer', now this class has two fields firstName and lastName which we can use. 
th:if="${#fields.hasErrors('lastName')} -- here we are saying that if the field 'lastName' has any errors than only show the error text. 
th:errors="*{lastName}"     -- here we are saying that show the error message which we have put on the lastName field in the Customer class.  

• Development Process
1. Create Customer class and add validation rules
File: Customer.java
public class Customer {

    private String firstName;

    @NotNull(message = "is required")
    @Size (min=1, message = "is required")
    private String lastName;
     
    // getter/setter methods ...
}

2. Add Controller code to show HTML form
File: CustomerController.java
@Controller
public class CustomerController {
    @GetMapping("/")
    public String showForm(Model theModel) { // the model allows us to share information between Controllers and View Pages(Thymeleaf) 
        theModel.addAttribute("customer", new Customer()); // now we can access the 'customer' attribute into our HTML Page 
        return "customer-form";
    }
}
3. Develop HTML form and add validation support
File: customer-form.html
form th:action="@{/processForm}" th:object="${customer}" method="POST">
    First Name: <input type="text" th:field="*{firstName}"/>
    <br><br>
    Last Name (*): <input type="text" th:field="*{lastName}"/>
    <!--    Show error message if the field last name has any error-->
    <!--    th:if="${#fields.hasErrors('lastName')}}" check if there are any error messages for last name-->
    <!--    th:errors="*{lastName}" this will show the error message -->
    <span th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}" class="error"></span>
    <br><br>
    <input type="submit" value="Submit" />
</form>

4. Perform validation in the Controller class
File: CustomerController.java
@Controller
public class CustomerController {
    ...
    @PostMapping("/processForm") // @Valid is for telling spring mvc to perform validations on the object 'customer'. the 'theBindingResult' will have the result of validation 
    public String processForm(@Valid @ModelAttribute("customer") Customer theCustomer, BindingResult theBindingResult) {
        if (theBindingResult.hasErrors()) { // here we are checking if theBindingResult has any errors
          return "customer-form";
        }     
        else {
	  return "customer-confirmation";
        }
    }
}

5. Create confirmation page
File: customer-confirmation.html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
The customer is confirmed: <span th:text="${customer.firstName + ' ' + customer.lastName}" />
</body>
</html>


-- Spring Boot - Spring MVC Validation - Required Fields - Coding - Part 1
-- Spring Boot - Spring MVC Validation - Required Fields - Coding - Part 2
-- Spring Boot - Spring MVC Validation - Required Fields - Coding - Part 3
-- Spring Boot - Spring MVC Validation - Required Fields - Coding - Part 4
Example: Making input fields required with spring mvc validation 
Project: 03-validationdemo-required-fields


-- Spring Boot - Spring MVC Validation - @InitBinder - Overview
• White Space
Our previous example had a problem with white space.
If we put white space(s) in the last name field, it gets passed, which it should not. 
We need to trim whitespace from input fields

• @InitBinder
We will make use of this annotation called @InitBinder. This annotation works as a pre-processor.
So for every web request that comes through our controller, this code will execute first.
So we will actually create a method, and we'll annotate it with the @InitBinder annotation.
So all requests coming in are pre-processed. Now, this is actually an advanced annotation.

• Method for resolving white spaces issue
We will use this method for writing code to trim Strings that is to remove leading and trailing white space.
And If String only has white spaces then we will trim it to null.
This will resolve our validation problem.	

• Register Custom Editor in Controller
File: CustomerController.java
@InitBinder	// with this annotation, it will pre-process all web requests coming into our controller with below method.
public void initBinder (WebDataBinder dataBinder) {
  // StringTrimmerEditor is a predefined class in the Spring API which removes white spaces - leading and trailing 
  StringTrimmerEditor stringTrimmerEditor = new StringTrimmerEditor(true); // true - if there are only white spaces then trim till the value gets null 
  // here we are saying that for every string from data, bind this stringTrimmerEditor so that it removes the white spaces on every input field 
  dataBinder.registerCustomEditor(String.class, stringTrimmerEditor); 
}


-- Spring Boot - Spring MVC Validation - @InitBinder - Coding
Example: Adding a method with @InitBinder annotation which pre-process every String from data.
Project: 04-validationdemo-init-binder-trim

-- Spring MVC Validation - Validate a Number Range - Overview
• Validate a Number Range
Add a new input field on our form for: Free Passes
Users can only enter a number between 0-10

• Development Process
1. Add validation rule to Customer class
File: Customer.java
public class Customer {
  @Min(value=0, message="must be greater than or equal to zero")
  @Max(value=10, message="must be less than or equal to 10")
  private int freePasses;

  // Getter/Setter methods  
}

2. Display error messages on HTML form
File: customer-form.html
...
<br><br>
Free Passes: <input type="text" th:field="*{freePasses}"/>
<!--    Show error message if the field freePasses has any error-->
<!--    th:if="${#fields.hasErrors('freePasses')}}" checks if there are any error messages for freePasses-->
<!--    th:errors="*{freePasses}" this will show the error message -->
<span th:if="${#fields.hasErrors('freePasses')}" th:errors="*{freePasses}" class="error"></span>
<br><br>
...

3. Perform validation in the Controller class
File: CustomerController.java
No changes needed for processForm Method

4. Update confirmation page
File: customer-confirmation.html
<br><br>
Free Passes: <span th:text="${customer.freePasses}"/>
 

-- Spring Boot - Spring MVC Validation - Validate a Number Range - Coding
Example: Adding a new input field 'Free Passes' and putting a validation of type number range on it.
Project: 05-validationdemo-number-ranges


-- Spring Boot - Spring MVC Validation - Applying Regular Expressions - Overview
• Regular Expressions
A sequence of characters that define a search pattern
This pattern is used to find or match strings

• Validate a Postal Code
Add a new input field on our form for: Postal Code
User can only enter 5 chars digits
Apply Regular Expression

• Development Process
1. Add validation rule to Customer class
File: Customer.java
public class Customer {
  @Pattern(regexp="^[a-zA-Z0-9]{5}", message="only 5 chars/digits")
  private String postalCode;

  // Getter/Setter methods  
}

2. Display error messages on HTML form
File: customer-form.html
<br><br>
Postal Code: <input type="text" th:field="*{postalCode}"/>
<!--    Show error message if the field postalCode has any error-->
<!--    th:if="${#fields.hasErrors('postalCode')}}" checks if there are any error messages for postalCode-->
<!--    th:errors="*{postalCode}" this will show the error message -->
<span th:if="${#fields.hasErrors('postalCode')}" th:errors="*{postalCode}" class="error"></span> 
<br><br>

3. Update confirmation page
File: customer-confirmation.html
<br><br>
Postal Code: <span th:text="${customer.postalCode}"/>


-- Spring Boot - Spring MVC Validation - Applying Regular Expressions - Coding
Example: Applying Regex Pattern to input field 'postalCode'
Project: 06-validationdemo-regular-expressions


-- Spring Boot - Spring MVC Validation - Make Integer Fields Required
Example: Making the freePasses integer field required.
Project: 07-validationdemo-make-integer-fields-required

• Changes
File: Customer.java
public class Customer {
    @NotNull(message = "is required")
    @Min(value = 0, message = "must be greater than or equal to zero")
    @Max(value = 10, message = "must be less than or equal to 10")
    // Integer is a special wrapper class in java, now that StringTrimmerEditor will also work on this field too.
    // StringTrimmerEditor will remove all empty spaces and make it null
    private Integer freePasses;

    public Integer getFreePasses() {
        return freePasses;
    }

    public void setFreePasses(Integer freePasses) {
        this.freePasses = freePasses;
    }
}


-- Spring Boot - Spring MVC Validation - Strings for Int Fields and Custom Messages
Example: Adding a Validation and custom message on Integer Field which gets triggered on entering non-number characters. 
Project: 08-validationdemo-handle-strings-for-integer-fields

• Development Process
1. Create custom error message under src/resources/messages.properties
File: src/resources/messages.properties
# This is a special file that Spring MVC make use of during performing validation. Exact file location is very important.
typeMismatch.customer.freePasses=Invalid number

# typeMismatch   -- this is the type of error which is 'Mismatch'
# customer       -- this is our spring model attribute name
# freePasses     -- this is our field name of the above 'customer' attribute
# Invalid Number -- this is our custom message to show when user enters non number characters


-- Spring Boot - Spring MVC Validation - Debugging Tips for Custom Error Names 
To check how validation works, we can simply console log theBindingResult
File: CustomerController.java
public class CustomerController {
    @PostMapping("/processForm")
    // @Valid is for telling spring mvc to perform validations on those fields which have been set with constraints such as lastName.
    // the 'theBindingResult' will have the result of validation, so that we can know if a field has any error or not.
    public String processForm(@Valid @ModelAttribute("customer") Customer theCustomer, BindingResult theBindingResult) {

        System.out.println("Last Name: |" + theCustomer.getLastName() + "|");
        System.out.println("The Binding Results are: " + theBindingResult.toString());
        if (theBindingResult.hasErrors()) { // here we are checking if theBindingResult has any errors
            return "customer-form";
        } else {
            return "customer-confirmation";
        }
    }
} 


-- Spring Boot - Spring MVC Validation - Custom Validation - Overview - Part 1
-- Spring Boot - Spring MVC Validation - Custom Validation - Overview - Part 2

• Custom Validation
Perform custom validation based on our business rules
Our example: Course Code must start with "AUM"
Spring MVC calls our custom validation
Custom validation returns boolean value for pass/fail (true/false)

• Create a custom Java Annotation from scratch
For our custom validation, we will create a Custom Java Annotation: @CourseCode (the annotation name can be anything)
@CourseCode(value="AUM", message="must start with AUM") // the value of courseCode must start with 'AUM'. And an error message will be shown if validation fails. 
private String courseCode;

• Development Process
1. Create custom validation rule
   a. Create @CourseCode annotation: to put this annotation, first we need to create it with below syntax
   File: CourseCode.java
   @Constraint(validatedBy = CourseCodeConstraintValidator.class) // here we have to give it a helper class that contains actual business/validation logic for validating this process
   @Target( {ElementType.METHOD, ElementType.FIELD} ) // here we are saying that this annotation can be used on methods and fields
   @Retention(RetentionPolicy.RUNTIME) // process it at runtime
   public @interface CourseCode {
     // define default value parameter's value
     // the value() here is to declare that the annotation will have a parameter 'value'. 
     // if the value parameter is not used while using putting this annotation, the default value will be 'AUM' 
     public String value() default "AUM";

     // define default error message
     // the message() here is to declare that the annotation will have a parameter 'message'. 
     // if the message parameter is not used while using putting this annotation, the default error message will be 'must start with AUM'
     public String message() default "must start with AUM";  
   }
   
   b. Create CourseCodeConstraintValidator (this is where we will write our own custom business logic for validation)
   CourseCodeConstraintValidator.java
   public class CourseCodeConstraintValidator implements ConstraintValidator<CourseCode, String> { // CourseCode is our annotation and String is the type of data that we are validating against
     private String coursePrefix;
     
     @Override
     public void initialize(CourseCode theCourseCode) {
       coursePrefix = theCourseCode.value(); 	// here we are setting the actual default value so that we can use it to validate against the data that user enters 
     }

     @Override
     public boolean isValid (String theCode, ConstraintValidatorContext theConstraintValidatorContext) { // here theCode is the data that is entered by user, ConstraintValidatorContext is just an helper class that is added for additional error messages
       boolean result;
       if(theCode != null) { // if theCode is not null, it will go in this if statement.
           result = theCode.startsWith(coursePrefix); // here it checks that if theCode starts with the coursePrefix that is 'AUM', it will return true or it will return false.
       }
       else {
          result = true; // if theCode is null, it will return false as the field Course Code is not required.	
       }
       return result; 
     }
   }

2. Add validation rule to Customer class
File: Customer.java
public class Customer {
    @CourseCode
    private String courseCode;
 
    public String getCourseCode() {
        return courseCode;
    }

    public void setCourseCode(String courseCode) {
        this.courseCode = courseCode;
    }
}
3. Display error messages on HTML form
File: customer-form.html
<br><br>
Course Code: <input type="text" th:field="*{courseCode}"/>
<!--    Show error message if the field courseCode has any error-->
<!--    th:if="${#fields.hasErrors('courseCode')}}" checks if there are any error messages for courseCode-->
<!--    th:errors="*{courseCode}" this will show the error message -->
<span th:if="${#fields.hasErrors('courseCode')}" th:errors="*{courseCode}" class="error"></span>
<br><br>

4. Update confirmation page
File: customer-confirmation.html
<br><br>
Course Code: <span th:text="${customer.courseCode}"/>


-- Spring Boot - Spring MVC Validation - Custom Validation - Coding - Part 1
-- Spring Boot - Spring MVC Validation - Custom Validation - Coding - Part 2
-- Spring Boot - Spring MVC Validation - Custom Validation - Coding - Part 3
-- Spring Boot - Spring MVC Validation - Custom Validation - Coding - Part 4
-- Spring Boot - Spring MVC Validation - Custom Validation - Coding - Part 5
Example: Creating a custom validator and adding it to an input field
Project: 09-validationdemo-custom-validation-rule

------------------------------------------------------------------------------------------- Section 7 ---------------------------------------------------------------------------------------
-- Spring Boot - Thymeleaf - CRUD Database Project - Overview
• Application Requirements
Create a Web UI for the Employee Directory
Users should be able to
 Get a list of employees
 Add a new employee
 Update an employee
 Delete an employee

• Big Picture
Web Browser --> Employee Controller <--> Employee Service <--> Employee Repository <--> Database
     |                  |
     |      <-- Thymeleaf Templates        

• Application Architecture
Employee Controller <--> Employee Service <--> Employee Repository <--> Database

• Development Process - Big Picture
1. Get list of employees
2. Add a new employee
3. Update an existing employee
4. Delete an existing employee


-- Spring Boot - Thymeleaf - CRUD Database Project - Set up
Setting up Project: 07-spring-boot-spring-mvc-crud


-- Spring Boot - Thymeleaf - CRUD Database Project - Get Employees - Coding
Example: Getting Employee List from the MySQl Database and showing it on screen through Thymeleaf Template
Project: 00-thymeleaf-demo-employees-list


-- Spring Boot - Thymeleaf - CRUD Database Project - Add Employees - Overview
• Thymeleaf and Spring MVC Data Binding
Thymeleaf has special expressions for binding Spring MVC form data
Automatically setting / retrieving data from a Java object

• Thymeleaf Expressions
Thymeleaf expressions can help you build the HTML form :-)

Expression	Description
th:action 	Location to send form data
th:object 	Reference to model attribute
th: field	Bind input field to a property on model attribute
More...

• Development Process
1. New Add Employee button for list-employees.html
File: list-employees.html
<a th:href="@{/employees/showFormForAdd}"
 class="btn btn-primary btn-sm mb-3">
 Add Employee
</a>

File: EmployeeController.java
@Controller
@RequestMapping("/employees")
public class EmployeeController {
  @GetMapping("/showFormForAdd")
  public String showFormForAdd (Model theModel) {
    // create model attribute to bind form data (before we show the form, we must have to add a model attribute which is an object that will hold the form data for the data-binding)
    Employee theEmployee = new Employee();	         
    theModel.addAttribute("employee", theEmployee);
    return "employees/employee-form"; 			// here it will look for src/main/resources/templates/employees/employee-form.html
  }
}

2. Create HTML form for new employee
File: employee-form.html
<form action="#" th:action="@{/employees/save}" th:object="${employee}" method="POST"> <!-- the 'employee' in the th:object is the same model that is mentioned in EmployeeController.java -->

  <!--the 'firstName' in th:field is wired/referenced with the 'employee' of th:object-->
  <input type="text" th:field="*{firstName}" placeholder="First Name" class="form-control mb-4 w-25"> 
  <input type="text" th:field="*{lastName}" placeholder="Last Name" class="form-control mb-4 w-25">   
  <input type="text" th:field="*{email}" placeholder="Email" class="form-control mb-4 w-25">
  <button type="submit" class="btn btn-info col-2">Submit</button>  

</form>

<!--	 
When the form is first loaded, it will call the getter method such as employee.getFirstName(), employee.getLastName()... to populate the form fields initially.
When the form is submitted, it will call the setter method such as employee.setFirstName(), employee.setLastName()... to populate Java Object with form data. 
-->

3. Process form data to save employee
File: EmployeeController.java
@Controller
@RequestMapping("/employees")
public class EmployeeController {
  private EmployeeService employeeService;
  public EmployeeController(EmployeeService theEmployeeService) { // Constructor Injection
      employeeService = theEmployeeService;
  }
  @PostMapping("/save")
  public String saveEmployee(@ModelAttribute("employee") Employee theEmployee) {
  // Save the Employee
  employeeService.save(theEmployee);

  // use a redirect to prevent duplicate submissions
  return "redirect:/employees/list";
  }
}


-- Spring Boot - Thymeleaf - CRUD Database Project - Add Employee - Coding - Part 1
-- Spring Boot - Thymeleaf - CRUD Database Project - Add Employee - Coding - Part 2
-- Spring Boot - Thymeleaf - CRUD Database Project - Add Employee - Coding - Part 3
Example: Adding a new Employee through an 'Add Employee' button, an 'Employee Form' and a 'Save' button 
Project: 02-thymeleaf-demo-employees-add


-- Spring Boot - Thymeleaf - CRUD Database Project - Update Employee - Overview
• Development Process
1. "Update" button
File: list-employee.html
<tr th:each="tempEmployee : ${employees}"> <!-- Saving each employee into the 'tempEmployee' to show their information at new iteration -->
    ...
    <td>
      <a th:href="@{/employees/showFormForUpdate(employeeId=${tempEmployee.id})}" 
         class="btn btn-info btn-sm"> <!-- the URL will be: "http://localhost:8080/employees/showFormForUpdate?employeeId=1" -->
        Update
      </a>
    </td>
</tr> 

2. Pre-populate the form
@Controller
@RequestMapping("/employees")
public class EmployeeController {
    private EmployeeService employeeService;

    public EmployeeController(EmployeeService theEmployeeService) { // Constructor Injection
        employeeService = theEmployeeService;
    }

    @GetMapping("/showFormForUpdate")
    public String showFormForUpdate(@RequestParam("employeeId") int theId, Model theModel) { // here we access to /ShowFormForUpdate's parameters with which we can know the id.
        // Get the Employee with id 'theId' from the service
        Employee theEmployee = employeeService.findById(theId);

        // Set 'theEmployee' as a Model Attribute to pre-populate the form
        theModel.addAttribute("employee", theEmployee);

        // send over to the form
        return "employees/employee-form";
    }
}

File: employee-form.html
<form action="#" th:action="@{/employees/save}" th:object="${employee}" method="POST">
    <!-- Hidden form field is required for updates as this binds to the model attribute that tells your app which employee to update -->
    <input type="hidden" th:field="*{id}" />
</form>

3. Process form data
Once we are on the 'employee-form' HTML page, The code to save an employee has already written by us.
No need to write anything for this step.
   

-- Spring Boot - Thymeleaf - CRUD Database Project - Update Employee - Coding
Example: updating an existing Employee through an 'Update' button, an 'Pre-Populated Employee Form' and a 'Save' button 
Project: 03-thymeleaf-demo-employees-update


-- Spring Boot - Thymeleaf - CRUD Database Project - Delete Employee - Overview
• Development Process
1. Add “Delete” button/link on page
File: list-employees.html
<tr th:each="tempEmployee : ${employees}">
    ...

    <td>
        <a th:href="@{/employees/delete(employeeId=${tempEmployee.id})}"
           class="btn btn-danger btn-sm"
           onclick="if (!(confirm('Are you sure you want to delete this Employee?'))) return false">
            Delete
        </a>
    </td>

</tr>

2. Add controller code for “Delete”
File: EmployeeController.java
@Controller
@RequestMapping("/employees")
public class EmployeeController {
    ...  
 
    // add mapping for "/delete"
    @GetMapping("/delete")
    public String delete(@RequestParam("employeeId") int theId) {
        // delete the employee
        employeeService.deleteById(theId);

        // use a redirect to prevent duplicate submissions
        return "redirect:/employees/list";
    }
}

-- Spring Boot - Thymeleaf - CRUD Database Project - Delete Employee - Coding
Example: delete an existing Employee through a 'Delete' button, a 'Confirm Click Function' and a 'delete' GetMapping 
Project: 04-thymeleaf-demo-employees-delete

------------------------------------------------------------------------------------------- Section 8 ---------------------------------------------------------------------------------------
-- Spring MVC Security - Overview
• We will learn how to ...
Secure Spring MVC Web Apps
Develop login pages (default and custom)
Define users and roles with simple authentication
Protect URLs based on role
Hide/show content based on role
Store users, passwords and roles in DB (plain-text -> encrypted)

• Practical Results
Cover the most common Spring Security tasks that you will need on daily projects

• Spring Security Model
Spring Security defines a framework for security
Implemented using Servlet filters in the background
Two methods of securing an app: declarative and programmatic

• Spring Security with Servlet Filters
Servlet Filters are used to pre-process / post-process web requests
Servlet Filters can route web requests based on security logic
Spring provides a bulk of security functionality with servlet filters

• Spring Security Overview
We have a web browser on the left and then on the right we have this protected web resource like my top secret stuff.
The browser's attempting to access our top secret information and get the results. Now, this is where Spring Security
comes into play. These spring security filters will intercept those requests, pre-process them, and then see if the user
can actually access that protected resource. Spring Security will look at our application security configuration
and then it'll also look at the user's passwords and roles that are in our database to see if this user's authenticated
and also if they're authorized to access this web resource. And this all happens in the background, thanks to Spring Security.

Web      --> Spring Security  -->  Protected Web Resource [/mytopsecretstuff]	 
Browser      Filters
               |	<-->	my app security config	<-->  users passwords roles

• Security Concept
Authentication: Check user id and password with credentials stored in app / db
Authorization: Check to see if user has an authorized role

• Declarative Security
Define application’s security constraints in configuration: All Java config: @Configuration
It Provides separation of concerns between application code and security

• Programmatic Security
Spring Security provides an API for custom application coding
Provides greater customization for specific app requirements

• Enabling Spring Security
1. Edit pom.xml and add spring-boot-starter-security
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-security</artifactId>
</dependency>
2. This will automagically secure all endpoints for application
 
• Secured Endpoints
Now when you access your application
Spring Security will prompt for login

• Different Login Methods
1. HTTP Basic Authentication
2. Default login form: Spring Security provides a default login form
3. Custom login form: your own look-and-feel, HTML + CSS

• Spring MVC Security - Project Demo
Video: 176


-- Spring MVC Security - Project Set Up - Part 1
-- Spring MVC Security - Project Set Up - Part 2
• Development Process
1. Create project at Spring Initializr website: Add Maven dependencies for Spring MVC Web App, Security, Thymeleaf
File: pom.xml
<dependency>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-starter-web</artifactId>
</dependency>

<dependency>
<groupId>org.springframework.boot</groupid>
<artifactId>spring-boot-starter-thymeleaf</artifactId>
</dependency>

<dependency>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-starter-security</artifactId>
</dependency>

<dependency>
<groupId>org.thymeleaf.extras</groupId>
<artifactId>thymeleaf-extras-springsecurity6</artifactId>
</dependency>


2. Develop our Spring controller
File: DemoController.java
@Controller
public class DemoController {
  @GetMapping("/")
  public String showHome() {
  return "home";		// src/main/resources/template/home.html
  }
}
   
3. Develop our Thymeleaf view page
File: src/main/resources/template/home.html
<html>
<body>
Welcome to the Home Page!
</body>
</html>


-- Spring MVC Security - Dev Testing with Private/Incognito Windows
• During Development and Testing
When we run our application and login for the first time, we notice that whenever we make any changes into our code while the application is still running,
the user stays logged in and changes we made get reflect on the page. This is not an ideal way, the page must let the user login again. The reason behind it
is that the login is happening in a web browser session and the user will stay logged in if the same web browser session is going on.
But this issue can only happen during developing and testing the application.
Once we create the whole project and deploy it on a server, such thing will not happen.

Solution:
1. Start a new Web Browser Session: This is not an Ideal Solution as we always have to start a new Web Browser for it. 
2. Quit the Browser(Not just close the window) and start again
3. Start a new incognito window


-- Spring MVC Security - Basic Configuration - Overview
• Our Users
User ID		Password	Roles
john 		test123 	EMPLOYEE
mary 		test123 	EMPLOYEE, MANAGER
susan 		test123 	EMPLOYEE, MANAGER, ADMIN

• Spring Security Password Storage
In Spring Security, passwords are stored using a specific format: {id}encodedPassword
ID	Description
noop	Plain text passwords
bcrypt	BCrypt password hasings

• Password Example
{noop}test123 -- the encoding algorithm id is 'noop'. As we have used noop, the password is going to be a plain text 'test123' 

• Development Process
1, Create Spring Security Configuration (@Configuration)
File: DemoSecurityConfig.java
@Configuration
public class DemoSecurityConfig {
  // add our security configurations here ..
}

2. Add users, passwords and roles
File: DemoSecurityConfig.java
import org.springframework.context.annotation.Configuration;
@configuration
public class DemoSecurityConfig {
    @Bean
    public InMemoryUserDetailsManager userDetailsManager() {
        UserDetails john = User.builder()
                .username("john")
		.password("{noop}test123")
		.roles("EMPLOYEE")
		.build();

	UserDetails mary = User.builder()
		.username("mary")
		.password("{noop}test123")
		.roles("EMPLOYEE", "MANAGER")
		.build();

	UserDetails susan = User.builder()
		.username("susan")
		.password("{noop}test123")
		.roles("EMPLOYEE", "MANAGER", "ADMIN")
		.build();

	return new InMemoryUserDetailsManager (john, mary, susan);
     }
}

-- Spring MVC Security - Basic Configuration - Coding
Example: Creating a Basic Configuration for 3 users having different roles.
Project: 01-spring-boot-spring-security-default


-- Spring MVC Security - Custom Login Form - Overview - Part 1
-- Spring MVC Security - Custom Login Form - Overview - Part 2
• Development Process
1. Modify Spring Security Configuration to reference custom login form
File: DemoSecurityConfig.java
@Configuration
public class DemoSecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.authorizeHttpRequests(configurer ->
                        configurer.
                                anyRequest().authenticated()
                )
                .formLogin(form ->
                        form
                                .loginPage("/showMyLoginPage")
                                .loginProcessingUrl("/authenticateTheUser")
                                .permitAll()
                );
        return http.build();
    }
}

2. Develop a Controller to show the custom login form
File: LoginController.java
@Controller
public class LoginController {
    @GetMapping("/showMyLoginPage") 	// this URL must match the DemoSecurityConfig's loginPage URL
    public String showMyLoginPage() {
        return "plain-login";		// src/main/resources/templates/plain-login.html
    }
}

3. Create custom login form: HTML (CSS optional)
• Spring Security defines default names for login form fields that means Spring Security Filters will read the form data and authenticate the user only if below names match
User name field: username
Password field: password

File: // src/main/resources/templates/plain-login.html
<form action="#" th:action="@{/authenticateTheUser}" method="POST"> <!-- the URL must match the DemoSecurityConfig's loginProcessingUrl URL and the method must be POST -->
  <p>User name: <input type="text" name="username" /></p>
  <p>Password: <input type="password" name="password" /></p>
  <input type="submit" value="Login" />
</form>  


-- Spring MVC Security - Custom Login Form - Coding - Part 1
-- Spring MVC Security - Custom Login Form - Coding - Part 2
-- Spring MVC Security - Custom Login Form - Coding - Part 3
Example: Creating our own Custom Login Form, Configuring to let spring use our custom login form and authenticate the user to enter the home page 
Project: 04-thymeleaf-demo-employees-delete


-- Spring MVC Security - Login Form Error Message - Overview
• Failed Login
When the user tries to login with bad credentials(username and passoword), the spring will keep the user on the same login page and 
the spring will append '?error' to the current URL.

• Development Process
1. Modify custom login form by: 
   check the error paramter in the current URL after user clicks submit button
   if '?error' exists, show an error message
File: src/main/resources/templates/plain-login.html
<form action="#" th:action="@{/authenticateTheUser}" method="POST">
  <div th:if="${param.error}"> <!-- this line means if there is an error parameter in our current URL than only show this whole line. -->
    <i>Sorry! You entered invalid username/password.</i>
  </div>
  <p>User name: <input type="text" name="username" /></p>
  <p>Password: <input type="password" name="password" /></p>
  <input type="submit" value="Login" />
</form>   


-- Spring MVC Security - Login Form Error Message - Coding
Example: Showing an error message to the user, if they try to login with bad credentials
Project: 04-spring-boot-spring-mvc-security-custom-login-form-show-error-message


-- Spring MVC Security - Custom Login Form with Bootstrap - Overview
• Development Process
1. Modify form to point to our login processing URL
2. Verify form fields for username and password
3. Change our controller to use our new Bootstrap login form


-- Spring MVC Security - Custom Login Form with Bootstrap - Coding
Example: Adding and showing a whole new custom login form styled with bootstrap
Project: 05-spring-boot-spring-mvc-security-custom-login-form-with-bootstrap


-- Spring MVC Security - Logout - Overview
• Logout Process
When a logout is processed, by default Spring Security will ...
Invalidate user’s HTTP session and remove session cookies, etc
Send user back to your login page
Append a logout parameter: ?logout

• Development Process
1. Add logout support to Spring Security Configuration
File: DemoSecurityConfig.java
@Configuration
public class DemoSecurityConfig {
    ...
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.authorizeHttpRequests(configurer ->
                        configurer.
                                anyRequest().authenticated()
                )
                .formLogin(form ->
                        form
                                .loginPage("/showMyLoginPage")
                                .loginProcessingUrl("/authenticateTheUser")
                                .permitAll()
                )
                .logout(logout -> logout.permitAll()	
                );
        return http.build();
    }
}

2. Add logout button to home page
We must make use of form tag with th:action="" to have a working logout button
And we must use POST method as an attribute in the form tag
File: src/main/resources/templates/home.html
<form action="#" th:action="@{/logout}" method="POST">
    <input type="submit" value="Logout" />  
</form>

3. Update login form to display “logged out” message
<form action="#" th:action="@{/authenticateTheUser}" method="POST">
  <div th:if="${param.logout}"> <!-- this line means if there is a logout parameter in our current URL than only show this whole line. -->
    <i>You have been logged out!</i>
  </div>
  <p>User name: <input type="text" name="username" /></p>
  <p>Password: <input type="password" name="password" /></p>
  <input type="submit" value="Login" />
</form>   


-- Spring MVC Security - Logout - Coding
Example: adding a working logout button and showing a logout message to the user, after they automatically redirect to login page
Project: 06-spring-boot-spring-mvc-security-logout


-- Spring MVC Security - Display User ID and Roles - Overview
• Spring Security
Spring Security provides support for accessing user id and roles

• Development Process
1. Display User ID
File: home.html
User: <span sec:authentication="principal.username"></span>

2. Display User Roles
Role(s): <span sec:authentication="principal.authorities"></span>


-- Spring MVC Security - Display User ID and Roles - Coding
Example: Displaying Username and Role(s) on the home page
Project: 07-spring-boot-spring-mvc-security-display-user-name-and-roles

 
-- Spring MVC Security - Restrict URLs Based on Roles - Overview
• Our Example
The user will login normally and as all users have a role as 'Employee', any user can be redirected to Home Page '/'. 
Now if the user has a role of 'Manager', they only can access a new page Leadership Retreat Page '/leaders'.   
If the user has a role of 'Admin', they only can access a new page 'Admin Holiday Cruise' '/systems'.

• Syntax to restrict access based on roles
requestMatchers(<<add path to match on>>).hasRole(<<only one authorized role>>) 			// this is the syntax to give authorization of a specific URL to only one role.
requestMatchers(<<add path to match on>>).hasAnyRole(<<list of authorized role with comma-delimited>>) 	// this is the syntax to give authorization of a specific URL to multiple roles.

• Development Process
1. Create supporting controller code and view pages
See files: home.html, leaders.html and systems.html

2. Restrict Access based on Roles
File: DemoSecurityConfig.java
@Configuration
public class DemoSecurityConfig {
    ...
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.authorizeHttpRequests(configurer ->
                        configurer
				.requestMatchers("/").hasRole("EMPLOYEE") // this means that any user can have access to root '/' path as all of our users have 'EMPLOYEE' as their role.
                                .requestMatchers("/leaders/**").hasRole("MANAGER") // this means that only user with role as 'MANAGER' can have access to '/leaders' and its sub-directories.
                                .requestMatchers("/systems/**").hasRole("ADMIN")   // this means that only user with role as 'ADMIN' can have access to '/systems' and its sub-directories.
                                .anyRequest().authenticated()
                )
                .formLogin(form ->
                        form
                                .loginPage("/showMyLoginPage")
                                .loginProcessingUrl("/authenticateTheUser")
                                .permitAll()
                )
                .logout(logout -> logout.permitAll()	
                );
        return http.build();
    }
}


-- Spring MVC Security - Restrict URLs Based on Roles - Coding - Part 1
-- Spring MVC Security - Restrict URLs Based on Roles - Coding - Part 2
-- Spring MVC Security - Restrict URLs Based on Roles - Coding - Part 3
-- Spring MVC Security - Restrict URLs Based on Roles - Coding - Part 4
Example: Restricting access of URLS based on roles.
Project: 08-spring-boot-spring-mvc-security-user-roles-restrict-access


-- Spring MVC Security - Custom Access Denied Page - Overview
We will create our own Custom Access Denied Page to show to those users who have restriced access to resources

• Development Process
1. Configure custom page for access denied
File: DemoSecurityConfig.java
@Configuration
public class DemoSecurityConfig {
    ...
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.authorizeHttpRequests(configurer ->
                        configurer
				.requestMatchers("/").hasRole("EMPLOYEE") // this means that any user can have access to root '/' path as all of our users have 'EMPLOYEE' as their role.
                                .requestMatchers("/leaders/**").hasRole("MANAGER") // this means that only user with role as 'MANAGER' can have access to '/leaders' and its sub-directories.
                                .requestMatchers("/systems/**").hasRole("ADMIN")   // this means that only user with role as 'ADMIN' can have access to '/systems' and its sub-directories.
                                .anyRequest().authenticated()
                )
		.exceptionHandling(configurer ->
          		configurer
                                .accessDeniedPage("/access-denied")
                )
                .formLogin(form ->
                        form
                                .loginPage("/showMyLoginPage")
                                .loginProcessingUrl("/authenticateTheUser")
                                .permitAll()
                )
                .logout(logout -> logout.permitAll()	
                );
        return http.build();
    }
}

2. Create supporting controller code and view page
See files access-denied.html


-- Spring MVC Security - Custom Access Denied Page - Coding - Part 1
-- Spring MVC Security - Custom Access Denied Page - Coding - Part 2
Example: Creating a custom access denied page for those user have restricted access to resources.
Project: 09-spring-boot-spring-mvc-security-custom-access-denied-page


-- Spring MVC Security - Display Content Based on Roles - Overview
Here we will write code for displaying content based on roles.

• Development Process
1. Add Spring Security Tag to the links
File: home.html
<div sec:authorize="hasRole('MANAGER')">	<!-- with the help of this tag, we will be able to show this link only to users with 'MANAGER' as their role -->
  <p>
      <a th:href="@{/leaders}">Leadership Meeting</a>
      (Only for Manager Peeps)
  </p>
</div> 

<div sec:authorize="hasRole('ADMIN')">		<!-- with the help of this tag, we will be able to show this link only to users with 'ADMIN' as their role -->
  <p>
      <a th:href="@{/systems}">IT Systems Meeting</a>
      (Only for Admin Peeps)
  </p>
</div>


-- Spring MVC Security - Display Content Based on Roles - Coding - Part 1
-- Spring MVC Security - Display Content Based on Roles - Coding - Part 2
Example: Writing code for displaying content based on roles
Project: 10-spring-boot-spring-mvc-security-display-content-based-on-user-roles


-- Spring MVC Security - JDBC Authentication - Plain Text - Overview
here, we will make use of Spring Security with user accounts stored in the database.

• Database Access
So far, our user accounts were hard coded in Java source code
Now we will be adding those user accounts into a database and will have that database access
This is an advanced feature of the spring security

• Database Support in Spring Security
Spring Security can read user information from the database.
By default, we have to follow Spring Security's predefined table schemas.
But the nice thing about it is that by following their schemas, Spring Security includes
all of the JDBC Code to actually read information from the database.
there's very little Java code we have to write, as far as JDBC Code for reading information from the database.
All we have to do is simply set up the configuration, create the appropriate tables,
and Spring Security will do all the heavy lifting for us in the background.

• Customize Database Access with Spring Security
We can also customize the table schemas
It is useful if we have custom tables specific to our project/custom
We will be responsible for developing the code to access the data which is to write in JDBC, JPA/Hibernate etc...

• Developement Process
1. Develop SQL Script to set up database tables
CREATE TABLE `users` (
  `username` varchar(50) NOT NULL,
  `password` varchar(50) NOT NULL,
  `enabled` tinyint NOT NULL,

  PRIMARY KEY (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO `users`
VALUES
('john', '{noop}test123', 1),
('mary', '{noop}test123', 1),
('susan', '{noop}test123', 1); 

CREATE TABLE `authorities` (
  `username` varchar(50) NOT NULL,
  `authority` varchar(50) NOT NULL,
  
  UNIQUE KEY `authorities_idx_1` (`username`, `authority`),
  
  CONSTRAINT `authorities_ibfk_1`
  FOREIGN KEY (`username`) 
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO `authorities`
VALUES
('john', 'ROLE_EMPLOYEE'),
('mary', 'ROLE_EMPLOYEE'),
('mary', 'ROLE_MANAGER'),
('susan', 'ROLE_EMPLOYEE'),
('susan', 'ROLE_MANAGER'),
('susan', 'ROLE_ADMIN');
  
2. Add database support to Maven РОМ file
File: pom.xml
<!-- MYSQL JDBC Driver-->
<dependency>
  <groupId>com.mysql</groupId>
  <artifactId>mysql-connector-j</artifactId> 
  <scope>runtime</scope>
</dependency>

<!-- Spring Boot Data JPA for database access-->
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>


3.Create JDBC properties file
File: application.properties
# JDBC connection properties
spring.datasource.url=jdbc:mysql://localhost:3306/employee_directory
spring.datasource.username=springstudent
spring.datasource.password=springstudent

4. Update Spring Security Configuration to use JDBC
File: DemoSecurityConfig.java
@Configuration
public class DemoSecurityConfig {
    // In below code we are telling spring security to use JDBC authentication, 
    // so with just below lines of code, spring security has auto-magically using the user accounts from the database 	
    @Bean 
    public UserDetailsManager userDetailsManager (DataSource dataSource) {  // here we have injected data source which is auto configured by Spring Boot  
        return new JdbcUserDetailsManager (dataSource); // here exactly we are telling spring security to use JDBC authentication with our data source
    }
...
}


-- Spring MVC Security - JDBC Authentication - Plain Text - Coding - Part 1
-- Spring MVC Security - JDBC Authentication - Plain Text - Coding - Part 2
-- Spring MVC Security - JDBC Authentication - Plain Text - Coding - Part 3
-- Spring MVC Security - JDBC Authentication - Plain Text - Coding - Part 4
Example: setting up database table, adding database support to pom.xml file, adding jdbc connection properties into application.properties file 
         and updating DemoSecurityConfig to use JDBC
Project: 11-spring-boot-spring-mvc-security-jdbc-plain-text


-- Spring MVC Security - JDBC Authentication - BCrypt Encryption - Overview Part 1
-- Spring MVC Security - JDBC Authentication - BCrypt Encryption - Overview Part 2
• Password Storage - Best Practice
The best practice is store passwords in an encrypted format

• Spring Security Team Recommendation
Spring Security recommends using the popular bcrypt algorithm
bcrypt
 Performs one-way encrypted hashing
 Adds a random salt to the password for additional protection
 Includes support to defeat brute force attacks

• How to Get a Bcrypt password
We have a plain text password and we can encrypt it by using below two methods
option 1: Use a website utility to perform the encryption
option 2: Write a Java code to perform the encryption

• Spring Security Login Process
1. Retrieve password from db for the user
2. Read the encoding algorithm id (bcrypt etc)
3. For case of bcrypt, encrypt plaintext password which has been entered by user in login form with the help of using same salt that is used to bcrypt the password in db.  
4. Compare that password that we encrypted with the encrypted password from db (notice here in this process the password from db is never decrypted as bcrypt is one-way encryption algorithm)
5. If there is a match, login successful
6. If no match, login NOT successful

• Development Process
1. Run SQL Script that contains encrypted passwords
   Modify DDL for password field, length should be 68
CREATE TABLE `users` (
  `username` varchar(50) NOT NULL,
  `password` char(68) NOT NULL,
  `enabled` tinyint NOT NULL,
  PRIMARY KEY (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO `users` 
VALUES 
('john','{bcrypt}$2a$10$qeS0HEh7urweMojsnwNAR.vcXJeXR1UcMRZ2WcGQl9YeuspUdgF.q',1),
('mary','{bcrypt}$2a$10$qeS0HEh7urweMojsnwNAR.vcXJeXR1UcMRZ2WcGQl9YeuspUdgF.q',1),
('susan','{bcrypt}$2a$10$qeS0HEh7urweMojsnwNAR.vcXJeXR1UcMRZ2WcGQl9YeuspUdgF.q',1);


-- Spring MVC Security - JDBC Authentication - BCrypt Encryption - Coding  
Example: Making use of Bcrypt algorithm to encrypt user passwords in the database.
Project: 12-spring-boot-spring-mvc-security-jdbc-bcrypt


-- Spring MVC Security - JDBC Authentication - Custom Tables - Overview
To make use of custom tables with custom table names and column names, we need to tell spring about how it can find users from the database.
We can do that by providing spring with queries for how to find user by username and how to find roles by username

• For Security Schema Customization
Tell Spring how to query your custom tables
Provide query to find user by user name
Provide query to find authorities/roles by user name

•  Development Process                                  
1. Create our custom tables with SQL
2. Update Spring Security Configuration
    Provide query to find user by user name
    Provide query to find authorities/roles by user name
@Configuration
public class DemoSecurityConfig {
    @Bean
    public UserDetailsManager userDetailsManager (DataSource dataSource) {
        JdbcUserDetailsManager theUserDetailsManager = new JdbcUserDetailsManager (dataSource);
        
        theUserDetailsManager // the '?' in the query is a parameter placeholder where the parameter value will be the username entered by user into the login form
           .setUsersByUsernameQuery ("select user_id, pw, active from members where user_id=?"); 

        theUserDetailsManager // the '?' in the query is a parameter placeholder where the parameter value will be the username entered by user into the login form
           .setAuthoritiesByUsernameQuery("select user_id, role from roles where user_id=?");

        return theUserDetailsManager;
    }
...
}


-- Spring MVC Security - JDBC Authentication - Custom Tables - Coding - Part 1
-- Spring MVC Security - JDBC Authentication - Custom Tables - Coding - Part 2
Example: Creating our our custom database table and updating DemoSecurityConfig file by providing find user by username and find roles by username queries for spring. 
Project: 13-spring-boot-spring-mvc-security-jdbc-bcrypt-custom-tables


------------------------------------------------------------------------------------------- Section 9 ---------------------------------------------------------------------------------------
-- JPA / Hibernate Advanced Mappings Overview - Part 1
• Advanced Mappings
In the database, we most likely will have multiple tables and we will also have relationships between tables.
And we need to model this with Hibernate.
In this section we will look at 3 types of advanced mappings:
1. One-to-One
2. One-to-Many, Many-to-One
3. Many-to-Many

• One-to-One
taking an example here of an 'instructor' which can have an 'instructor_detail' entity.
instructor	----> 	instructor_detail
id               	id
first_name       	youtube_channel
last_name        	hobby  
email
instructor_detail

• One-to-Many
Now the same 'instructor' can have many 'course'
but we are assuming here that one 'course' has only one 'instructor'. So that we can make it one to many.
course	 ---->  instructor  <----  course
                   |
                course

• Many-to-One
for this type of mapping, we can just inverse the above scenario.
So we can say that many 'course' can have one 'instructor'  

• Many-to-Many
A 'course' can have many 'student'
A 'student' can have many 'course'


-- JPA / Hibernate Advanced Mappings Overview - Part 2
• Primary key and foreign key: Important Database Concepts
Primary key is an identifier which identifies a unique row in a table.
Foreign key links tables together. It is a field in one table that refers to primary key in another table.
Foreign key's main purpose is to preserve the relationship between the tables.
And we may hear this buzzword, "Referential Integrity." This helps prevent operations that would destroy
the relationship between those tables. And also it ensures that only valid data is inserted into the foreign key column.
So that foreign key column can only contain valid reference to a primary key in another table.
If not, the database will actually throw some errors and it'll tell you about it.

For Instance:
instructor table: id = primary key, instructor_detail_id = foreign key
id   first_name   last_name   instructor_detail_id
1    aum          Soni        100   
2    Shivang      Soni        200

instructor_detail table: id = primary key
id   youtube_channel   hobby
100  URL1              football 
200  URL2              cricket

the 'instructor_detail_id' of 'instructor' table is the foreign key which is linked to 'id' of 'instructor_detail' table
which is a primary key of that table.

• Cascade: Important Database Concepts
We can cascade operations. Cascading means applying the same operation to related entities automatically.
For instance if we perform the 'save' operation on the 'instructor' entity, the same 'save' operation will be performed to 'instructor_detail' entity.
Now if we delete an instructor, we should also delete their instructor_detail. This is also known as Cascade Delete
This Cascade Delete depends on the use case. For instance we cannot use Cascase Delete in Many-to-Many mapping scenario

• Fetch Types: Eager vs Lazy Loading: Important Database Concepts
When should we fetch/retrieve data? Should we retrieve everything at a time?
For instance, if i want to retrieve an instructor, should i retrieve all courses that are related to instructor at that time?
For such cases we can two types of Fetch:
1. Eager will retrieve everything
2. Lazy will retrieve on request

• Uni-Directional(one-way) Relationship  
We start with the instructor object, we load the instructor, and then from there,
we can access the instructor detail. So it's really a one way relationship. So that is why it is called uni-directional.

• Bi-Directional (two-way) Relationship
We also have the idea of bidirectional. So here we have the instructor which have its relationship with the instructor detail,
So to access instructor detail, we need to go through instructor. But then we can also go the other way, that is we can actually 
load the instructor detail and have a reference to the given instructor. So that is called as bidirectional.


-- @OneToOne Mapping Overview - Part 1
-- @OneToOne Mapping Overview - Part 2
-- @OneToOne Mapping Overview - Part 3
As we mentioned above, the 'instructor' can have an 'instructo detail' entity.
Now this example here is going to be uni-directional. We start wil the 'instructor' and then we have one-way relationship with the 
'instructor detail'.

• Entity Lifecycle
Operations	Description
Detach		If entity is detached, it is not associated with a Hibernate session
Merge		If instance is detached from session, then merge will reattach to session                   
Persist         Transitions new instances to managed state. Next flush / commit will save in db.          
Remove          Transitions managed entity to be removed. Next flush / commit will delete from db.
Refresh         Reload/sync object with data from db. Prevents stale data         

• @OneToOne - Cascade Types
Cascade Type	Description
PERSIST         If entity is persisted / saved, related entity will also be persisted            
REMOVE 		If entity is removed/deleted, related entity will also be deleted
REFRESH         If entity is refreshed, related entity will also be refreshed             
DETACH 		If entity is detached (not associated w/ session), then related entity will also be detached
MERGE   	If entity is merged, then related entity will also be merged                   
ALL		All of above cascade types 
               
• Development Process: One-to-One
1. Prep Work - Define database tables
CREATE TABLE `instructor_detail` (
  `id` int NOT NULL AUTO_INCREMENT,
  `youtube_channel` varchar(128) DEFAULT NULL,
  `hobby` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

CREATE TABLE `instructor` (
  `id` int NOT NULL AUTO_INCREMENT,
  `first_name` varchar(45) DEFAULT NULL,
  `last_name` varchar(45) DEFAULT NULL,
  `email` varchar(45) DEFAULT NULL,
  `instructor_detail_id` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `FK_DETAIL_idx` (`instructor_detail_id`),
  CONSTRAINT `FK_DETAIL` FOREIGN KEY (`instructor_detail_id`) REFERENCES `instructor_detail` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION 
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

2. Create InstructorDetail class
File: InstructorDetail.java
@Entity
@Table(name="instructor_detail")
public class InstructorDetail {
  @Id
  @GeneratedValue(strategy=GenerationType.IDENTITY)
  @Column(name="id")
  private int id;
 
  @Column(name="youtube_channel")
  private String youtubeChannel;
 
  @Column(name="hobby")
  private String hobby;

  // constructors

  // getters/setters
 
}
3. Create Instructor class
File: Instructor.java
@Entity
@Table(name="instructor")
public class Instructor {
  @Id
  @GeneratedValue(strategy=GenerationType.IDENTITY)
  @Column(name="id")
  private int id;
 
  @Column(name="first_name")
  private String firstName;
 
  @Column(name="last_name")
  private String lastName;

  @Column(name="email")
  private String email;

  // This is how we can map our Instructor class to InstructorDetail class
  // here we are letting spring know that there is going to be one-to-one relationship between this class and some other class
  // here we are saying that all operations that we apply to 'instructor' entity, should also be applied to 'instructor_detail' entity
  // Configure Multiple Cascade Types: @OneToOne(cascade={CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST})
  @OneToOne(cascade=CascadeType.ALL) // It is important to know that by default,  no operation is cascaded.     
  @JoinColumn(name="instructor_detail_id") // here we are telling spring to use 'instructor_detail_id' column as foreign key and link it to the primary key of below mentioned class
  private InstructorDetail instructorDetail; // it is mandatory to mention the class name as a type so that the Hibernate can automatically links both classes.

  // constructors

  // getters/setters
 
}

4. Create Main App
We will create a Spring Boot-Command Line App
This will allow us to focus on JPA / Hibernate
Leverage our DAO pattern as in previous videos
File: AppDAO.java
public interface AppDAO {
    void save (Instructor theInstructor);
}

File: AppDAOImpl.java
@Repository
public class AppDAOImpl implements AppDAO { 
    // define field for entity manager
    private EntityManager entityManager;
     
    // inject entity manager using constructor injection
    @Autowired
    public AppDAOImpl (EntityManager entityManager) {
        this.entityManager = entityManager;
    }

    @Override
    @Transactional
    public void save (Instructor theInstructor) {
        entityManager.persist (theInstructor);		// here we are saving the new instructor object and it will also save the instructor detail object.  
    }
}

File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(CruddemoApplication.class, args);
    }

    // This CommandLineRunner is from the spring boot application and below snippet of code will be
    // executed after the Spring Beans have been loaded.
    @Bean
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            createInstructor(appDAO);
        };
    }

    private void createInstructor(AppDAO appDAO) {
        // creating a new instructor
        Instructor tempInstructor = new Instructor("Aum", "Soni", "aumsoni2002@gmail.com");

        // creating a new instructor detail
        InstructorDetail tempInstructorDetail = new InstructorDetail("URL1", "Playing football");

        // setting the new instructor detail object to our tempInstructor object
        tempInstructor.setInstructorDetail(tempInstructorDetail);

        // saving the new instructor object into our database
        // by saving the instructor, it will also save the instructor detail because of that CascadeType.ALL
        System.out.println("Saving instructor: " + tempInstructor);
        appDAO.save(tempInstructor);
        System.out.println("Done!!");

    }
}

-- @OneToOne Mapping - Database Setup
Video 247: Run the 'create-db.sql' script in the workbench 


-- @OneToOne Mapping - Set up Spring Boot Project - Part 1
-- @OneToOne Mapping - Set up Spring Boot Project - Part 2
Video 248, 249: editing the CruddemoApplication.java file by putting the CommandLineRunner.


-- @OneToOneMapping - Coding - Create InstructorDetail entity
Video 250: Creating InstructorDetail.java class under entity package and putting fileds/columns, constructors, getters, setters and toString() method in it


-- @OneToOneMapping - Coding - Create Instructor entity
Video 251: Creating Instructor.java class under entity package and putting fileds/columns, constructors, getters, setters and toString() method in it.


-- @OneToOneMapping - Coding - Create the DAO
Video 252: creating AppDAO.java interface and AppDAOImpl.java class under dao package and putting the code to save a new instrcutor in it.


-- @OneToOneMapping - Coding - Develop the Main App
Video 253: updating the CruddemoApplication.java file by creating 'createInstructor' method which instanciates a new instructor and instructor detail object and saves in the database.  


-- @OneToOneMapping - Find Instructor by ID
• Development Process
1. Add method in DAO Interface
File: AppDAO.java
public interface AppDAO {
    ...
    Instructor findInstructorById(int theId);
}

2. Define the method in DAO Implementation
File: AppDAOImpl.java
@Repository
public class AppDAOImpl implements AppDAO {
  ...
  @Override
  public Instructor findInstructorById(int theId) {
     // now this will also return the associated entity. In our case it will return both instructor and instructor details because by default the fetch type is eager.
     return entityManager.find(Instructor.class, theId); 
  }
}

3. Update Main App by adding method for finding instructor by id 
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            findInstructorById(appDAO);
        };
    }
    ...
    private void findInstructorById(AppDAO appDAO) {
        int theId = 1;
        System.out.println("Finding Instructor with id: " + theId);
        Instructor tempInstructor = appDAO.findInstructorById(theId);
        System.out.println("tempInstructor: " + tempInstructor);
        System.out.println("the associated instructor detail: " + tempInstructor.getInstructorDetail());
    }
}

Example: Updating DAO Interface and DAO Implementtion to add code for finding instructor by id.
Project: 02-jpa-one-to-one-uni-find-instructor


-- @OneToOneMapping - Delete Instructor by ID
• Development Process
1. Add method in DAO Interface
File: AppDAO.java
public interface AppDAO {
    ...
    void deleteInstructorById(int theId);
}

2. Define the method in DAO Implementation
File: AppDAOImpl.java
@Repository
public class AppDAOImpl implements AppDAO {
  ...
  @Override
  @Transactional
  public void deleteInstructorById(int theId) {
     // retrieve the instructor
     Instructor tempInstructor = entityManager.find(Instructor.class, theId); 

     // delete the instructor
     entityManager.remove(tempInstructor); // this will also remove the instructor detail object because we have put CascadeType.ALL
  }
}

3. Update Main App by adding method for delete instructor by id 
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            deleteInstructorById(appDAO);
        };
    }
    ...
    private void deleteInstructorById(AppDAO appDAO) {
        int theId = 3;
        System.out.println("Delete Instructor with id: " + theId);
        appDAO.deleteInstructorById(theId);
        System.out.println("Done!");
    }
}


-- @OneToOneMapping - Bi-Directional - Overview
Now a new scenario, we want to load an InstructorDetail first and then we want to load the associcated Instructor entity.
Because we have uni-directional(one-way) relationship, we cannot perform above scenario.
But this can be solved with B-directional(two-way) relationship.
With this type of relationship, we can actually start by loading the InstructorDetail first and make it back to the Instructor.
To use Bi-Directional, we can keep the existing database schema. No changes required to database.

• mappedBy
The mappedBy tells Hibernate to look at the instructorDetail property in the Instructor class.
So Hibernate can actually use the information from the Instructor class's JoinColumn
to figure out how to find the associated instructor. All right, so we are basically telling Hibernate,
"Hey, this field Instructor in InstructorDetail, it's mapped by instructorDetail."
Hibernate will go figure that out, look at the foreign key relationship, and match everything up.
So effectively Hibernate can use this information to find out how these two items are linked up, and also finding
the appropriate Instructor for this given InstructorDetail.

• Development Process: One-to-One (Bi-Directional)
1. Make updates to InstructorDetail class:
 1. Add new field to reference Instructor
 2. Add getter/setter methods for Instructor
 3. Add @OneToOne annotation
    File: InstructorDetail.java
    ...
    @OneToOne(mappedBy="instructorDetail", cascade=CascadeType.ALL) // this here refers to 'instructorDetail' property in 'Instructor' class
    private Instructor instructor; // so this means that this instructor property is mapped by the instructorDetail property in 'Instructor' class

    public Instructor getInstructor() {
      return instructor;
    }

    public void setInstructor(Instructor instructor) {
      this.instructor = instructor;
    }

2. Define DAO interface and DAO Implementation
File: AppDAO.java
public interface AppDAO {
    InstructorDetail findInstructorDetailById(int theId);
}

File: AppDAOImpl.java
@Repository
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    public InstructorDetail findInstructorDetailById(int theId) {
        return entityManager.find(InstructorDetail.class, theId); // here we are retrieving the instructorDetail object and it will also retrieve the associated instructor object
    }
} 

3. Create Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            findInstructorDetailById(appDAO);
        };
    }
    ...
    private void findInstructorDetailById(AppDAO appDAO) {
        int theId = 1;
        System.out.println("Finding Instructor Detail with id: " + theId);
        InstructorDetail tempInstructorDetail = appDAO.findInstructorDetailById(theId);
        System.out.println("tempInstructorDetail: " + tempInstructorDetail);
        System.out.println("the associated instructor: " + tempInstructorDetail.getInstructor());
    }
}


-- @OneToOneMapping - Bi-Directional - Coding - Part 1
-- @OneToOneMapping - Bi-Directional - Coding - Part 2
Example: Updating application to add Bi-Directional relationship so that we can load an InstructorDetail first and then the associcated Instructor entity will be loaded.
Project: 04-jpa-one-to-one-bi-find-instructor-detail


-- @OneToOneMapping - Bi-Directional - Cascade Delete - Coding
Now we are going to delete an instructor detail through cascade delete so the associated instructor will also get deleted automatically.   

• Development Process
1. Define DAO interface and DAO Implementation
File: AppDAO.java
public interface AppDAO {
    ...
    void deleteInstructorDetailById(int theId);
}

File: AppDAOImpl.java
@Repository
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    @Transactional
    public void deleteInstructorDetailById(int theId) {
        // retrieve instructor detail
        InstructorDetail tempInstructorDetail = entityManager.find(InstructorDetail.class, theId); 
 
        // delete instructor detail
        entityManager.remove(tempInstructorDetail); // here we are removing the instructor detail which will also remove the associated instructor
    }
}  

2. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            deleteInstructorDetailById(appDAO);
        };
    }
    ...
    private void deleteInstructorDetailById(AppDAO appDAO) {
        int theId = 2;
        System.out.println("Delete Instructor detail with id: " + theId);
        appDAO.deleteInstructorDetailById(theId);
        System.out.println("Done!");
    }
}

Example: Deleting instructor detail with cascade delete so its associated instructor will also gets deleted
Project: 05-jpa-one-to-one-bi-delete-instructor-detail-and-instructor


-- @OneToOneMapping - Bi-Directional - Only Delete Instructor Details - Coding
In this scenario, we only want to delete the instructor detail but not its associated instructor.
We can do this by doing two modification. First is we need to put remove the cascade type 'REMOVE' from the list.
Second is we need to remove the asscociated object reference so that the bi-directional link breaks and this can be done 
by setting the instructor_detail_id of the Instructor to null. 

• Development Process
1. Update InstructorDetail entity
File: InstructorDetail.java
@Entity
@Table(name = "instructor_detail")
public class InstructorDetail {
    ...
    // As we can see in below code, we have put all cascade types other than REMOVE, now when we remove the instructor detail, its associated instructor will not get deleted
    @OneToOne(mappedBy = "instructorDetail", cascade = {CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST, CascadeType.REFRESH})
    // this here refers to 'instructorDetail' property in 'Instructor' class
    private Instructor instructor; // so this means that this instructor property is mapped by the instructorDetail property in 'Instructor' class

} 

2. Update DAO Implementation
File: AppDAOImpl.java
@Repository
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    @Transactional
    public void deleteInstructorDetailById(int theId) {
        // retrieve instructor detail
        InstructorDetail tempInstructorDetail = entityManager.find(InstructorDetail.class, theId); 

        // remove the associated object reference so it breaks the bi-directional link
        tempInstructorDetail.getInstructor().setInstructorDetail(null);
 
        // delete instructor detail
        entityManager.remove(tempInstructorDetail); // here we are removing the instructor detail which will also remove the associated instructor
    }
}  

Example: Deleting instructor detail without deleting its assicated instructor
Project: 06-jpa-one-to-one-bi-delete-instructor-detail-only


-- @OneToMany - Overview - Part 1
-- @OneToMany - Overview - Part 2
• One-to-Many Mapping
So we'll make use of this one-to-many mappings where an instructor can have many courses.
this will be bidirectional. So we can start with instructor, go to a course through it
or we can start with a course and go to an instructor through it.

• Many-to-One Mapping
Many courses can have one instructor.
This is just inverse/opposite of One-to-Many.
But as we already know that we are assuming that one course can only have one instructor. 

• Real-World Project Requirement
If you delete an instructor, DO NOT delete the courses.
If you delete a course, DO NOT delete the instructor.
Which means we must not make use of cascade type 'REMOVE' in this situation.

• mappedBy 
mappedBy tells Hibernate:
 Look at the instructor property in the Course class
 Use information from the Course class @JoinColumn
 To help find associated courses for instructor

• Development Process: One-to-Many
1. Prep Work-Define database tables
The 'instructor_id' of the course table is going to be foreign key which will reference to the 'id' of the instructor table to create a link between these two tables
File: Practice Projects\09-spring-boot-jpa-advanced-mappings\00-jpa-advanced-mappings-database-scripts\hb-03-one-to-many\creat-db.sql

2. Create Course class
File: Course.java
@Entity
@Table(name="course")
public class Course {
    @Id
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    @Column(name="id")
    private int id;

    @Column(name="title")
    private String title;

    // this annotation means that there can be many courses mapped to one instructor
    @ManyToOne(cascade={CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST, CascadeType.REFRESH}) 	
    @JoinColumn(name="instructor_id") // this 'instructor_id' is going to be linked to the 'id' of the instructor class
    private Instructor instructor;

    // constructors, getters, setters
}

3. Update Instructor class: reference courses
File: Instructor.java
@Entity
@Table(name = "instructor")
public class Instructor {
    ...
    // this annotation means that there can only be one instructor mapped to many courses 
    @OneToMany(mappedBy="instructor", cascade={CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST, CascadeType.REFRESH}) 
    private List<Course> courses;
    
    // getters, setters

    // add convenience methods for bi-directional relationship
    public void add(Course tempCourse) {
        if(courses == null){
         courses = new ArrayList<>();
        }
        
        courses.add(tempCourse);
        tempCourse.setInstructor(this); // this will basically set up the two-way link between the instructor and Course so that we can have access to them through both ways
    }
}

4. Create Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            createInstructorWithCourses(appDAO);
        };
    }
    ...
    private void createInstructorWithCourses(AppDAO appDAO) {
        // creating a new instructor
        Instructor tempInstructor = new Instructor("Shivang", "Soni", "shivngsoni1998@gmail.com");

        // creating a new instructor detail
        InstructorDetail tempInstructorDetail = new InstructorDetail("URL2", "Playing Guitar");

        // setting the new instructor detail object to our tempInstructor object
        tempInstructor.setInstructorDetail(tempInstructorDetail);

        // create some courses
        Course tempCourse1 = new Course("Introduction to Web Development");
        Course tempCourse2 = new Course("Data Structures and Algorithm");

        // add courses to instructor
        tempInstructor.add(tempCourse1);
        tempInstructor.add(tempCourse2);

        // save the instructor into the database
        // NOTE: this will ALSO save the courses because of CascadeType.PERSIST
        System.out.println("Saving instructor: " + tempInstructor);
        System.out.println("The Courses: " + tempInstructor.getCourses());
        appDAO.save(tempInstructor);
        System.out.println("Done!!");
    }
}

-- @OneToMany - Coding - Set Up Database Tables
-- @OneToMany - Coding - Create Course entity
-- @OneToMany - Coding - Annotate Course entity
-- @OneToMany - Coding - Annotate Instructor entity
-- @OneToMany - Coding - Create Main App
-- @OneToMany - Coding - Finish Main App and Run It!
Example: Updating our application by adding One-to-Many and Many-to-One relationship between instructor and courses
Project: 07-jpa-one-to-many-create-instructor-with-courses


-- @OneToMany - Fetch Types: Eager vs Lazy - Overview - Part 1
-- @OneToMany - Fetch Types: Eager vs Lazy - Overview - Part 2
• Fetch Types: Eager VS Lazy Loading
When we fetch / retrieve data, should we retrieve EVERYTHING?
 Eager will retrieve everything
 Lazy will retrieve on request

• Eager Loading
Eager loading will load all dependent entities
It will load instructor and all of their courses at once
Using this type of loading can have bad impact on the performance of our application.

• Lazy Loading
Lazy loading will load the main entity first and will load all other dependent entites on demand.
So prefer Lazy Loading instead of Eager Loading
However, this requires an open Hibernate session that is it needs an connection to database to retrieve data
If the Hibernate session is closed And you attempt to retrieve lazy data, Hibernate will throw an exception
 
• Default Fetch Type
Mapping		Default Fetch Type
@OneToOne	FetchType.EAGER
@OneToMany	FetchType.LAZY
@ManyToOne	FetchType.EAGER
@ManyToMany	FetchType.LAZY

• Development Process
The scenario here is that we want to fetch/find the instructors and courses linked to it. In the below 'findInstructorWithCourses()' method, we have called a function
'appDAO.findInstructorById(theId)' which looks for the instructor and all its courses. But the issue here is that the instructor has OneToMany relation with the courses
and the default fetch type for OneToMany relationship is LAZY, so the courses have not been loaded yet. Now if we try to print the courses with default Fetch Type, it will
throw an error. That is why to load and print the courses, we need to change the Fetch Type to EAGER.    
1. Update Instructor Entity
@Entity
@Table(name = "instructor")
public class Instructor {
    ...
    @OneToMany(fetch=FetchType.EAGER, mappedBy = "instructor", cascade = {CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST, CascadeType.REFRESH})
    private List<Course> courses;
}

2. Update Main app
File: : CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            findInstructorWithCourses(appDAO);
        };
    }
    ...
    private void findInstructorWithCourses(AppDAO appDAO){
        int theId = 1;
        System.out.println("Finding instructor with id: " + theId);
        Instructor tempInstructor = appDAO.findInstructorById(theId);
        System.out.println("tempInstructor: " + tempInstructor);
        System.out.println("the associated courses: " + tempInstructor.getCourses());
    }
}

-- @OneToMany: Fetch Types - Eager vs Lazy - Coding
Example: Fetching Instructor and Courses linked to it with Fetch Type EAGER
Project: 08-jpa-one-to-many-eager-find-instructor-with-courses


-- @OneToMany: Lazy Find Courses - Overview
In this scenario, we want to fetch the instructor and courses linked to it through Lazy Fetch Type.
We do not want all courses to load at one time. But we want to have an option to load courses as needed. 

• Development Process
1. Update Instructor entity
File: Instructor.java
@Entity
@Table(name = "instructor")
public class Instructor {
    ...
    @OneToMany(fetch = FetchType.LAZY, // Now here we have set it back from EAGER to LAZY which is a default Fetch Type and we actully do not need to write it, But we have. 
            mappedBy = "instructor",
            cascade = {CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST, CascadeType.REFRESH}
    )
    private List<Course> courses;
}

2. Update AppDAO and AppDAOImpl
File: AppDAO.java
public interface AppDAO {
    ...
    List<Course> findCoursesByInstructorId(int theId);
}

File: AppDAOImpl.java
@Repository 
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    public List<Course> findCoursesByInstructorId(int theId) {
        // create query to retrieve courses from database
        TypedQuery<Course> query = entityManager.createQuery("from Course where instructor.id = :data", Course.class);
        query.setParameter("data", theId);

        // execute query
        List<Course> courses = query.getResultList();

        return courses;
    }
}

3. Update Main App
File: : CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            findCoursesForInstructor(appDAO);
        };
    }
    ...
    public void findCoursesForInstructor(AppDAO appDAO){
        int theId = 1;
        System.out.println("Finding instructor with id: " + theId);
        Instructor tempInstructor = appDAO.findInstructorById(theId);
        System.out.println("tempInstructor: " + tempInstructor);

        // As we are using Fetch Type Lazy, we need to find courses for instructor
        System.out.println("Finding courses for instructor with id: " + theId);

        // finding courses of the same above tempInstructor that we found
        List<Course> courses = appDAO.findCoursesByInstructorId(theId);

        // we need to set the courses (associate the object) that we found for our tempInstructor
        tempInstructor.setCourses(courses);

        System.out.println("the associated courses: " + tempInstructor.getCourses());
    }
}



-- @OneToMany: Lazy Find Courses - Coding - Part 1
-- @OneToMany: Lazy Find Courses - Coding - Part 2
Example: Fetching the instructor and courses linked to it through Lazy Fetch Type.
Project: 09-jpa-one-to-many-lazy-find-courses-for-instructor


-- @OneToMany - JOIN FETCH Courses - Overview
Here we want to update our last piece code where we have to get the instructor first and then get its courses, but instead we want to get
the instructor and courses in a single query and also keeping the Fetch Type to LAZY. 

• Development Process
1. Update AppDAO and AppDAOImpl
File: AppDAO.java
public interface AppDAO {
    ...
    Instructor findInstructorByIdJoinFetch(int theId);
}

File: AppDAOImpl.java
@Repository 
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    public Instructor findInstructorByIdJoinFetch(int theId) {
        // create query to retrieve instructor and courses from database, The Join Fetch here is similar to Eager Loading.
        TypedQuery<Instructor> query = entityManager.createQuery("select i from Instructor i " + "JOIN Fetch i.courses " + "where i.id = :data", Instructor.class);
        query.setParameter("data", theId);

        // execute query
        Instructor instructor = query.getSingleResult();

        return instructor; 
    }
}

3. Update the Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            findInstructorWithCoursesJoinFetch(appDAO);
        };
    }
    ...
    public void findInstructorWithCoursesJoinFetch(AppDAO appDAO){
        int theId = 1;
        System.out.println("Finding instructor with id: " + theId);
        Instructor tempInstructor = appDAO.findInstructorByIdJoinFetch(theId);
        System.out.println("tempInstructor: " + tempInstructor);
        System.out.println("the associated courses: " + tempInstructor.getCourses());
    }
}


-- @OneToMany - JOIN FETCH Courses - Coding - Part 1
-- @OneToMany - JOIN FETCH Courses - Coding - Part 2
Example: Fetching the instructor, instructorDetail and courses linked to it through Lazy Fetch Type and making use of Join Fetch in the query. 
Project: 10-jpa-one-to-many-lazy-find-instructor-with-courses-join-fetch


-- @OneToMany - Update Instructor
• Update Instructor
Find an instructor by ID
Change the instructor's data by calling setter method(s)
Update the instructor using the DAO

• Development Process
1. Update AppDAO and AppDAOImpl
File: AppDAO.java
public interface AppDAO {
    ...
    void update(Instructor tempInstructor);
}

File: AppDAOImpl.java
@Repository     
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    @Transactional
    public void update(Instructor tempInstructor) {
        entityManager.merge(tempInstructor); // the merge() method will update the existing entity
    } 
}

2. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            updateInstructor(appDAO);
        };
    }
    ...
    public void updateInstructor(AppDAO appDAO){
        int theId = 1;
        System.out.println("Finding instructor with id: " + theId);
        Instructor tempInstructor = appDAO.findInstructorById(theId);
        System.out.println("Updating instructor's last name to 'Tester'");
        tempInstructor.setLastName("Tester");
        appDAO.update(tempInstructor);
    }
}

Example: Updating an existing Instructor entity's last name
Project: 11-jpa-one-to-many-update-instructor


-- @OneToMany - Update Course
• Update Course
Find a course by Id
Change the course's data by calling setter method(s)
Update the course using the DAO

• Development Process
1. Update AppDAO and AppDAOImpl
File: AppDAO.java
public interface AppDAO {
    ...
    Course findCourseById(int theId);
    void update(Course tempCourse);
}

File: AppDAOImpl.java
@Repository     
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    public Course findCourseById(int theId) {
        return entityManager.find(Course.class, theId); // this will find the course by its own id.[Note: it will not find it by instructor's id as we did in above one of the section]
    }
  
    @Override
    @Transactional
    public void update(Course tempCourse) {
        entityManager.merge(tempCourse); // the merge() method will update the existing entity
    } 
}

2. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            updateCourse(appDAO);
        };
    }
    ...
    public void updateCourse(AppDAO appDAO){
        int theId = 10;
        System.out.println("Finding course with id: " + theId);
        Instructor tempCourse = appDAO.findCourseByInstructorId(theId);
        System.out.println("Updating course's title to 'C++ Programming'");
        tempCourse.setTitle("C++ Programming");
        appDAO.update(tempCourse);
    }
}

Example: Updating an existing course entity's title
Project: 12-jpa-one-to-many-update-course


-- @OneToMany - Delete Instructor
• Delete instructor
Find an instructor by ID
Break association of all instructor's courses
Delete the instructor

• Development Process
1. Update AppDAO and AppDAOImpl
File: AppDAO.java
public interface AppDAO {
    ...
    void deleteInstructorWithoutCoursesById(int theId);
} 

File: AppDAOImpl.java
@Repository     
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    @Transactional
    public void deleteInstructorWithoutCoursesById(int theId) {
        // finding the instructor
        Instructor tempInstructor = entityManager.find(Instructor.class, theId);
  		
        // retrieving all courses that are associated to this tempInstructor
        List<Course> courses = tempInstructor.getCourses();

        // Now that we have courses, we need to set the instructor of all these courses to null to break the association or we will not be able to remove the instructor  
        for(Course tempCourse: courses){
           tempCourse.setInstructor(null);
        }

        // Now that we have break the association, we can remove the instructor from the database
        entityManager.remove(tempInstructor);
    } 
}

2. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            deleteInstructorWithoutCourses(appDAO);
        };
    }
    ...
    public void deleteInstructorWithoutCourses(AppDAO appDAO){
        int theId = 1;
        System.out.println("deleting instructor with id: " + theId);
        appDAO.deleteInstructorWithoutCoursesById(theId);
    }
}

Example: deleting an existing instructor entity without deleting its associated courses
Project: 13-jpa-one-to-many-delete-instructor


-- @OneToMany - Delete Course
• Delete course
Delete the course by Id.

• Development Process
1. Update AppDAO and AppDAOImpl
File: AppDAO.java
public interface AppDAO {
    ...
    void deleteCourseById(int theId);
} 

File: AppDAOImpl.java
@Repository     
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    @Transactional
    public void deleteCourseById(int theId) {
        // retrieving the course from database
        Course tempCourse = entityManager.find(Course.class, theId);
  
        // removing the course from database
        entityManager.remove(tempCourse);
    } 
}

2. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            deleteCourseById(appDAO);
        };
    }
    ...
    public void deleteCourseById(AppDAO appDAO){
        int theId = 10;
        System.out.println("deleting course with id: " + theId);
        appDAO.deleteCourseById(theId);
    }
}

Example: deleting an existing course entity without deleting its associated instructor
Project: 14-jpa-one-to-many-delete-course


-- @OneToMany - Uni-Directional - Overview
• One-to-Many Mapping: Uni-Directional
For this kind of mapping we will have a course that can have many reviews and it is going to be Uni-Directional(one-way mapping)
So we will start with course and we will go one way to the actual review(s).
It does make sense when we delete a course, we also have to delete its review(s). Review(s) without a course does not make sense. 
That is why we will make use of Cascade Type 'DELETE'.

• @JoinColumn
In this scenario, @JoinColumn tells Hibernate
 Look at the course_id column in the review table
 Use this information to help find associated reviews for a course
Here we are suppose to put the JoinColumn annotation in the course entity, not in the review entity which is a different case from all above mappings.
Usually we put the JoinColumn in that entity where the foreign key is, but this OneToMany mapping is uni-directional, we have to put the JoinColumn in course entity.
Remember one thing that the name in JoinColumn annotation will always be the one which is foreign key.

• Development Processs: One-to-Many
1. Prep Work-Define database tables
File: Practice Projects\09-spring-boot-jpa-advanced-mappings\00-jpa-advanced-mappings-database-scripts\hb-04-one-to-many-uni\create-db.sql
Run above sql query in workbench

2. Create Review class
File: Review.java
@Entity
@Table(name="review")
public class Review
    @Id
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    @Column(name="id")
    private int id;
    
    @Column(name="comment")
    private String comment;
 
    // constructors, getters, setters

3. Update Course class
File: Course.java
@Entity
@Table(name = "course")
public class Course {
    ...
    @OneToMany(fetch=FetchType.LAZY, cascade=CascadeType.ALL)
    @JoinColumn(name="course_id")	// this name here refers to the 'course_id' in the 'review' table
    private List <Review> reviews;

    // add convenience methods for adding reviews
    public void addReview(Review tempReview) {
        if(reviews == null) {
          reviews = new ArrayList<>();
        }
        reviews.add(tempReview);
    } 
}

4. Update AppDAO and AppDAOImpl
File: AppDAO.java
public interface AppDAO {
    ...
    void save(Course theCourse);
} 

File: AppDAOImpl.java
@Repository     
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    @Transactional
    public void save(Course theCourse) {
        // save the course and its associated reviews
        entityManager.persist(theCourse); 	// this will save the course and its associated reviews because we have put cascase type 'ALL'
    } 
}

5. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            createCourseAndReviews(appDAO);
        };
    }
    ...
    public void createCourseAndReviews(AppDAO appDAO){
        // create a course
        Course tempCourse = new Course("Object Oriented Programming with Java");

        // add reviews to course
        tempCourse.addReview(new Review ("The course is good!"));
        tempCourse.addReview(new Review ("Awesome Course!!!!!"));
        tempCourse.addReview(new Review ("Amazing Content!!!!!!!!!!!"));

        // save the course to database
        appDAO.save(tempCourse);   
    }
}

-- @OneToMany - Uni-Directional - Coding - Database Set Up
-- @OneToMany - Uni-Directional - Coding - Create Review Entity
-- @OneToMany - Uni-Directional - Coding - Refactor Course Entity
-- @OneToMany - Uni-Directional - Coding - Update DAO and Main App
Example: Creating One-to-Many Uni-Directional relationship between course and review(s). Saving a new course object with its associated review(s) object
Project: 15-jpa-one-to-many-uni-create-course-and-reviews


-- @OneToMany - Uni-Directional - Coding - Retrieve Course and Reviews
Now we are going to retrieve course entity and its associated reviews by course's id

• Development Process
1. Update AppDAO and AppDAOImpl
public interface AppDAO {
    ...
    Course findCourseAndReviewsByCourseId(int theId);
} 

File: AppDAOImpl.java
@Repository     
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    public Course findCourseAndReviewsByCourseId(int theId) {
        // create a query to find course and its reviews
        TypedQuery<Course> query = entityManager.createQuery("select c from Course c " + "JOIN FETCH c.reviews " + "where c.id = :data", Course.class);
        query.setParameter("data", theId);

        // execute query 
        Course course = query.getSingleResult();

        return course; 
    } 
}

2. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            retrieveCourseAndReviews(appDAO);
        };
    }
    ...
    public void retrieveCourseAndReviews(AppDAO appDAO){
        // get the course and reviews
        int theId = 10;  
        Course tempCourse = appDAO.findCourseAndReviewsByCourseId(theId);
 
        // print the course
        System.out.println(tempCourse);
 
        // print the reviews   
        System.out.println(tempCourse.getReviews());
    }
}

Example: Retrieving Course entity and its associated reviews
Project: 16-jpa-one-to-many-uni-retrieve-course-and-reviews


-- @OneToMany - Uni-Directional - Coding - Delete Course and Reviews
Now we are going to delete course entity and its associated reviews by course's id

• Development Process
1. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            deleteCourseAndReviews(appDAO);
        };
    }
    ...
    public void deleteCourseAndReviews(AppDAO appDAO){
        // get the course and reviews
        int theId = 10;  
        System.out.println("Deleting course with id: " + theId);
        appDAO.deleteCourseById(theId);
    }
}

Example: Deleting Course entity and its associated reviews
Project: 17-jpa-one-to-many-uni-delete-course-and-reviews


-- @ManyToMany - Overview - Part 1
-- @ManyToMany - Overview - Part 2
• Many-to-Many Mapping
A course can have many students
A student can have many courses

• Keep track of relationships
We need to keep tracko of which student is in which course and vice-versa.
For that what we can do is actually we can make use of a join table.
So this join table is a special table that will maintain relationships between a course and students.
If we delete a course, we do not want to delete its associated student.
And if we delete a student, we do not want to delete its associated course.
That is why, we must not use Cascade Type 'REMOVE' in this type of mapping.

• Join Table
A table that provides a mapping between two tables.
It has foreign keys for each table to define the mapping relationship.
course table		course_student table		student table
id 			course_id			id
title			student_id			first_name 
instructor_id						last_name
							email

First we need to look at the 'id' of the student table and match that 'id' to the 'student_id' of the course_student table.
Now we need to look at what the 'course_id' is for the same 'student_id' that we matched. Than simply we need to match that
'course_id' of course_student table to the 'id' of the 'course' table 

• @JoinTable Annotation
@JoinTable in Course entity tells Hibernate
 Look at the course_id column in the course_student table
 For other side (inverse), look at the student_id column in the course_student table
 Use this information to find relationship between course and students

@JoinTable in Student entity tells Hibernate
 Look at the student_id column in the course_student table
 For other side (inverse), look at the course_id column in the course_student table
 Use this information to find relationship between student and courses

• Development Process: Many-to-Many
1. Prep Work - Define database tables
File: Practice Projects\09-spring-boot-jpa-advanced-mappings\00-jpa-advanced-mappings-database-scripts\hb-05-many-to-many\create-db.sql

2. Update Course class
File: Course.java
@Entity
@Table(name="course")
public class Course {
    ...
    @ManyToMany
    @JoinTable(
      name="course_student",
      joinColumns=@JoinColumn(name="course_id"),
      inverseJoinColumns=@JoinColumn(name="student_id")
      )
    private List<Student> students;

    // getter / setters
    ...
}

3. Update Student class
File: Student.java
@Entity
@Table(name="student")
public class Student {
    ...
    @ManyToMany
    @JoinTable(
      name="course_student",
      joinColumns=@JoinColumn(name="student_id"),
      inverseJoinColumns=@JoinColumn(name="course_id")
      )
    private List<Course> courses;

    // getter / setters
    ...
}


-- @ManyToMany - Coding - Set up Database Tables
-- @ManyToMany - Coding - Set up Spring Boot Project
-- @ManyToMany - Coding - Create Student entity
-- @ManyToMany - Coding - Map Course to Student
-- @ManyToMany - Coding - Map Student to Course
-- @ManyToMany - Coding - Create Course and Students
Example: Adding a course and its associated student object to our database with ManyToMany Mapping relationship
Project: 18-jpa-many-to-many-create-course-and-students


-- @ManyToMany - Coding - Find Course and Students
• Development Process
1. Update AppDAO and AppDAOImpl
File: AppDAO.java
public interface AppDAO {
    ...
    Course findCourseAndStudentsByCourseId(int theId);
} 

File: AppDAOImpl.java
@Repository     
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    public Course findCourseAndStudentsByCourseId(int theId) {
        // create a query to find course and its students
        TypedQuery<Course> query = entityManager.createQuery("select c from Course c " + "JOIN FETCH c.students " + "where c.id = :data", Course.class);
        query.setParameter("data", theId);

        // execute query 
        Course course = query.getSingleResult();

        return course; 
    } 
}

2. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            findCourseAndStudents(appDAO);
        };
    }
    ...
    public void findCourseAndStudents(AppDAO appDAO){
        // get the course and students
        int theId = 10;  
        Course tempCourse = appDAO.findCourseAndStudentsByCourseId(theId);
 
        // print the course
        System.out.println(tempCourse);
 
        // print the students   
        System.out.println(tempCourse.getStudents());
    }
}

Example: Finding a course and its associated student object from our database with ManyToMany Mapping relationship
Project: 19-jpa-many-to-many-find-course-and-students


-- @ManyToMany - Coding - Find Student and Courses
• Development Process
1. Update AppDAO and AppDAOImpl
File: AppDAO.java
public interface AppDAO {
    ...
    Student findStudentAndCoursesByStudentId(int theId);
} 

File: AppDAOImpl.java
@Repository     
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    public Student findStudentAndCoursesByStudentId(int theId) {
        // create a query to find student and its courses
        TypedQuery<Student> query = entityManager.createQuery("select s from Student s " + "JOIN FETCH s.courses " + "where s.id = :data", Student.class);
        query.setParameter("data", theId);

        // execute query 
        Student student = query.getSingleResult();

        return student;
    } 
}

2. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            findStudentAndCourses(appDAO);
        };
    }
    ...
    public void findStudentAndCourses(AppDAO appDAO){
        // get the student and courses
        int theId = 1;  
        Student tempStudent = appDAO.findStudentAndCoursesByStudentId(theId);
 
        // print the student
        System.out.println(tempStudent);
 
        // print the courses   
        System.out.println(tempStudent.getCourses());
    }
}

Example: Finding a student and its associated courses object from our database with ManyToMany Mapping relationship
Project: 20-jpa-many-to-many-find-student-and-courses


-- @ManyToMany - Coding - Add More Courses to Students
• Development Process
1. Update AppDAO and AppDAOImpl
File: AppDAO.java
public interface AppDAO {
    ...
    void update(Student tempStudent);
} 

File: AppDAOImpl.java
@Repository     
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    @Transactional
    public void update(Student tempStudent) {
        entityManager.merge(tempStudent);
    } 
}

2. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            addMoreCoursesForStudent(appDAO);
        };
    }
    ...
    public void addMoreCoursesForStudent(AppDAO appDAO){
        int theId = 2;
        Student tempStudent = appDAO.findStudentAndCoursesByStudentId(theId);
     
        // create more courses
        Course tempCourse1 = new Course("Rubik's Cube - How to Speed Cube");
        Course tempCourse2 = new Course("Atari 2600 - Game Development");

	// add courses to student
        tempStudent.addCourse(tempCourse1);
        tempStudent.addCourse(tempCourse2);

        // update the existing the student table in database by adding more course
        appDAO.update(tempStudent);
    }
}

Example: Adding more courses to a student object in the database 
Project: 21-jpa-many-to-many-add-more-courses-for-student


-- @ManyToMany - Coding - Delete Course
Example: deleting a course from the database 
Project: 22-jpa-many-to-many-delete-course


-- @ManyToMany - Coding - Delete Student
• Development Process
1. Update AppDAO and AppDAOImpl
File: AppDAO.java
public interface AppDAO {
    ...
    void deleteStudentById(int theId);
} 

File: AppDAOImpl.java
@Repository     
public class AppDAOImpl implements AppDAO {
    ...
    @Override
    @Transactional
    public void deleteStudentById(int theId) {
        // retrieving the student from database
        Student tempStudent = entityManager.find(Student.class, theId);

        // removing the student from database
        entityManager.remove(tempStudent);
    } 
}

2. Update Main App
File: CruddemoApplication.java
@SpringBootApplication
public class CruddemoApplication {
    ...
    public CommandLineRunner commandLineRunner(AppDAO appDAO) {
        return runner -> {
            ...
            deleteStudentById(appDAO);
        };
    }
    ...
    public void deleteStudentById(AppDAO appDAO){
        int theId = 1;
        System.out.println("Deleting student with id: " + theId);
        appDAO.deleteStudentById(theId);
    }
}

Example: deleting a student from the database 
Project: 23-jpa-many-to-many-delete-student










